import{u as e,o as a,r,j as t,e as s,B as o,S as i,m as l}from"./index-efa3a32c.js";import{C as n}from"./index-0373e759.js";import{F as c}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{I as u}from"./index-06b8a89d.js";/* empty css              *//* empty css              */import{u as m}from"./user-66ba9e41.js";import{t as p}from"./teacher-ae538df4.js";import{u as h}from"./useLocation-f9597f4e.js";import{S as j}from"./index-1c1deade.js";import{U as x}from"./index-dff1ae8b.js";import{U as v}from"./UploadOutlined-030aecab.js";import"./index-0a1440ec.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./CheckOutlined-f0d55485.js";import"./useForceUpdate-9ad39bdf.js";import"./DeleteOutlined-6b999003.js";function g(){const g=h(),f=e(),{model:w}=g.state;document.title="add"===w?"新增教练":"编辑教练";const[b]=c.useForm(),[y]=c.useForm();let[I,S]=a();const C=I.get("teacher"),[F,L]=r.useState([]),N=e=>new Promise(((a,r)=>{const t=new FileReader;t.onload=e=>{const t=new Image;t.onload=function(){const{width:e,height:r}=this;a(e/r==3/4)},t.onerror=r,t.src=e.target.result},t.onerror=r,t.readAsDataURL(e)})),[O,T]=r.useState([]),[D,U]=r.useState([]),k=async e=>{const a=(await m.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));U(a)};r.useEffect((()=>{(async()=>{const e=(await m.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));T(e)})(),(async()=>{const e=await p.getTeacherDetails({coachuuid:C});if(e&&200===e.code){const a=null==e?void 0:e.data;await k(null==a?void 0:a.provideruuid);const r=a.coachpic.split(",").map((e=>({uid:Date.now(),name:"image.png",status:"done",url:e})));L(r);const t={proxy:a.provideruuid,storeuuid:a.storeuuid,teacherName:null==a?void 0:a.coachname,StoreImg:null==a?void 0:a.coachpic,teacherPrice:null==a?void 0:a.coachprice,teacherDesc:a.coachintro,teacherTime:a.workingday.split(",")};b.setFieldsValue(t)}else l.error((null==e?void 0:e.msg)??"获取失败")})()}),[]);const[q,P]=r.useState();return t.jsx("div",{className:"field-edit-box",children:t.jsxs(c,{labelCol:{span:4},wrapperCol:{span:16},form:b,name:"control-hooks",onFinish:e=>{},style:{maxWidth:600},children:[t.jsx(c.Item,{name:"proxy",label:"所属代理",rules:[{required:!0}],children:t.jsx(j,{placeholder:"请选择代理",allowClear:!0,onChange:k,options:O})}),t.jsx(c.Item,{name:"storeuuid",label:"所属门店",rules:[{required:!0}],children:t.jsx(j,{placeholder:"请选择门店",onChange:async e=>{},options:D,allowClear:!0})}),t.jsx(c.Item,{name:"teacherName",label:"教练名称",rules:[{required:!0}],children:t.jsx(d,{maxLength:5,placeholder:"请输入"})}),t.jsx(c.Item,{name:"StoreImg",label:"教练图片",rules:[{required:!0}],children:t.jsx(x,{action:`${s}/service_api/file_upload`,accept:"image/*",fileList:F,maxCount:1,beforeUpload:async e=>{if(e.size>5242880)return l.error("图片不符合要求，请重新上传"),x.LIST_IGNORE;const a=await N(e);a||l.error("图片尺寸不符合要求，请重新上传");const r="image/png"===e.type||"image/jpg"===e.type;return a||x.LIST_IGNORE||r},onChange:({file:e,fileList:a})=>{if("uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");y.setFieldsValue({imageShow:e})}L(a)},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const r=new FileReader;r.readAsDataURL(e.originFileObj),r.onload=()=>a(r.result)})));const r=new Image;r.src=a;const t=window.open(a);null==t||t.document.write(r.outerHTML)},children:t.jsxs("div",{className:"uploadBox",children:[t.jsx(o,{icon:t.jsx(v,{}),children:"上传照片"}),t.jsx("span",{className:"tips",children:"最多可上传1份，大小不超过5M，尺寸竖版3：4，格式：jpg/png"})]})})}),t.jsx(c.Item,{name:"teacherPrice",label:"教练价格",rules:[{required:!0}],children:t.jsx(u,{style:{width:"100%"},placeholder:"请输入",addonAfter:"元/小时",min:0,value:q,onChange:e=>{P(e)},formatter:e=>/^(\-)*(\d+)\.(\d).*$/.test(e.toString())?parseFloat(e).toFixed(1):e,parser:e=>parseFloat(e)})}),t.jsx(c.Item,{name:"teacherDesc",label:"教练介绍",rules:[{required:!0}],children:t.jsx(d,{maxLength:30,placeholder:"请输入"})}),t.jsx(c.Item,{name:"teacherTime",label:"工作时间",rules:[{required:!0}],children:t.jsx(n.Group,{options:[{label:"周一",value:"1"},{label:"周二",value:"2"},{label:"周三",value:"3"},{label:"周四",value:"4"},{label:"周五",value:"5"},{label:"周六",value:"6"},{label:"周日",value:"7"}],onChange:()=>{}})}),t.jsxs(i,{className:"bottom-btn",children:[t.jsx(o,{type:"primary",className:"submit",onClick:async()=>{try{const e=await b.validateFields(),a={provideruuid:e.proxy,coachuuid:C,storeuuid:e.storeuuid,coachname:e.teacherName,coachintro:e.teacherDesc,coachpic:null==F?void 0:F.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(","),coachprice:e.teacherPrice,workingday:e.teacherTime.join(",")},r=await p.editTeacher(a);r&&200===r.code?(l.success("修改成功"),f("/store/teacher/list")):l.error((null==r?void 0:r.message)??"操作失败")}catch(e){}},children:"提交"}),t.jsx(o,{htmlType:"button",onClick:()=>{f(-1)},children:"返回"})]})]})})}export{g as default};
