import{r as e,A as s,_ as a,a as t,u as r,t as o,m as n,b as i,j as l,B as c}from"./index-efa3a32c.js";import{u as d}from"./user-66ba9e41.js";import{F as m}from"./index-ae2d5997.js";import{I as u}from"./index-8c8b720f.js";import{C as p}from"./index-0373e759.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";const g={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};var f=function(t,r){return e.createElement(s,a({},t,{ref:r,icon:g}))};const h=e.forwardRef(f);const x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};var w=function(t,r){return e.createElement(s,a({},t,{ref:r,icon:x}))};const j=e.forwardRef(w);function v(){const s=t(),a=r(),[g]=m.useForm(),[f,x]=e.useState(!1),[w,v]=e.useState(!1);e.useState("00000");const[y,S]=e.useState(!1);e.useEffect((()=>{var e,s;document.title="登录HADO";const a=localStorage.getItem("userLoginInfo");if(a){const e=JSON.parse(a);v(!0),g.setFieldsValue({username:e.username,password:o.uncompile(e.password)})}a?null==(s=document.getElementById("vcode"))||s.focus():null==(e=document.getElementById("username"))||e.focus(),S(!0)}),[g]);const I=e.useCallback((async(e,a)=>{var t,r,o,l;let c=null,m=[],u=[],p=[];try{const g=await d.login({login:e,passwd:a});if(-1===g.code)return n.error(g.msg),g;localStorage.setItem("token",g.data.token),localStorage.setItem("ip",g.data.ip);const f=await d.getDetail();if(-1===f.code)return n.error(f.msg),f;c=f.data;const h=await d.getAgents();if(-1===h.code)return n.error(h.msg),h;{const e=h.data.map((e=>({label:e.providername,value:e.uuid})));s.app.reducerAgentOpts(e)}m=[{id:1,username:"admin",password:"123456",phone:"13600000000",email:"admin@react.com",desc:"超级管理员",conditions:1,menuAndPowers:(null==(l=null==(o=null==(r=null==(t=f.data)?void 0:t.rolelist)?void 0:r.roledetail)?void 0:o.powerlist)?void 0:l.menuAndPowers)||[]}];const x=m.reduce(((e,s)=>[...e,...s.menuAndPowers]),[]),w=i.getMenusById({id:Array.from(new Set(x.map((e=>e.menuId))))});if(!w||200!==w.status)return w;u=w.data.filter((e=>1===e.conditions));const j=i.getPowerById({id:Array.from(new Set(x.reduce(((e,s)=>[...e,...s.powers]),[])))});return j&&200===j.status?(p=j.data.filter((e=>1===e.conditions)),{status:200,data:{userBasicInfo:c,roles:m,menus:u,powers:p}}):j}catch(g){}}),[s.sys,s.app]),b=async()=>{try{const e=await g.validateFields();x(!0);const t=await I(e.username,e.password);t&&200===t.status?(n.success("登录成功"),w?localStorage.setItem("userLoginInfo",JSON.stringify({username:e.username,password:o.compile(e.password)})):localStorage.removeItem("userLoginInfo"),s.app.reducerUserInfo(t.data),a("/")):(n.error((null==t?void 0:t.message)??"登录失败"),x(!1))}catch(e){x(!1)}};return l.jsxs("div",{className:"page-login",children:[l.jsx("div",{className:"title",children:l.jsx("span",{children:"HADO - Meleap管理系统CRM-核心端"})}),l.jsx("div",{className:y?"loginBox show":"loginBox",children:l.jsx(m,{form:g,children:l.jsxs("div",{children:[l.jsx(m.Item,{label:l.jsx("label",{style:{color:"white"},children:"账号"}),name:"username",rules:[{max:12,message:"最大长度为12位字符"},{required:!0,whitespace:!0,message:"请输入用户名"}],children:l.jsx(u,{prefix:l.jsx(j,{style:{fontSize:13}}),size:"large",id:"username",placeholder:"请输入用户名",onPressEnter:b})}),l.jsx(m.Item,{label:l.jsx("label",{style:{color:"white"},children:"密码"}),name:"password",rules:[{required:!0,message:"请输入密码"},{max:18,message:"最大长度18个字符"}],children:l.jsx(u.Password,{prefix:l.jsx(h,{style:{fontSize:13}}),size:"large",type:"password",placeholder:"请输入密码",onPressEnter:b})}),l.jsxs("div",{style:{lineHeight:"40px"},children:[l.jsx(p,{className:"remember",checked:w,onChange:e=>{v(e.target.checked)},children:"记住密码"}),l.jsx(c,{className:"submit-btn",size:"large",type:"primary",loading:f,onClick:b,children:f?"请稍后":"登录"})]})]})})})]})}export{v as default};
