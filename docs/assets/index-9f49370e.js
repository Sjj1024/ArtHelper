import{u as e,d as t,r as s,j as a,B as l,m as i,e as n,T as o}from"./index-efa3a32c.js";import{F as r}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as c}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import{R as p}from"./index-9b8a3313.js";import{D as u}from"./index-65748fb5.js";/* empty css              */import{P as m}from"./index-94ed3db3.js";import{I as j}from"./index-9bf69a37.js";import{h as x}from"./hado-a6960cf0.js";import{u as h}from"./useSetState-78ffd672.js";import{S as g}from"./index-1c1deade.js";import{M as w}from"./index-46e73bcd.js";import{U as v}from"./index-dff1ae8b.js";import{S as y}from"./SearchOutlined-24304577.js";import{P as f}from"./PlusCircleOutlined-176a31dc.js";import{E as S}from"./EditOutlined-e081177a.js";import{D as b}from"./DeleteOutlined-866c7b58.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";import"./DeleteOutlined-6b999003.js";function k(){document.title="新闻",e();const k=t((e=>e.app.powersCode)),[N]=r.useForm(),[T,C]=s.useState([]),[I,z]=s.useState(!1),[L,F]=h({pageNum:1,pageSize:10,total:0}),[O,D]=h({newslocate:void 0,status:void 0}),E=async e=>{const t={page:e.pageNum,limit:e.pageSize,newslocate:O.newslocate,status:O.status};z(!0);try{const s=await x.newsList(t);s&&200===s.code?(C(s.data),F({pageNum:e.pageNum,pageSize:e.pageSize,total:s.cont})):i.error((null==s?void 0:s.message)??"数据获取失败")}finally{z(!1)}};s.useState();s.useState();const[q,B]=s.useState([]),[P,M]=h({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[U,V]=s.useState(0),$=(e,t)=>{if(M({modalShow:!0,nowData:e,operateType:t}),e){const t={uid:Date.now(),name:"image.png",status:"done",url:e.picurl};J([t]),N.setFieldsValue({newsTitle:e.newsTitle,position:e.location,tag:e.label,cover:e.cover,link:e.connect,status:K(e.status)})}else N.setFieldsValue({...A})},A={newsTitle:"",position:"",tag:"",cover:"",link:"",status:0},_=()=>{M({modalShow:!1}),N.setFieldsValue({...A}),J([])},[G,J]=s.useState([]),Q={accept:".jpg,.png,",action:`${n}/service_api/file_upload`,beforeUpload:e=>{const t=e.size/1024/1024<5;return t||i.error("图片大小不能超过5MB！"),t},onChange({file:e,fileList:t}){e.status,J(t)},fileList:G,maxCount:1},R=[{title:"编号",dataIndex:"serial",key:"serial"},{title:"新闻标题",dataIndex:"newsTitle",key:"newsTitle",width:200,render:(e,t)=>a.jsx(a.Fragment,{children:a.jsx(o,{placement:"top",title:t.newsTitle,children:a.jsx("span",{className:"title",children:t.newsTitle})})})},{title:"发布位置",dataIndex:"location",key:"location"},{title:"标签",dataIndex:"label",key:"label"},{title:"封面",dataIndex:"cover",key:"cover",render:(e,t)=>a.jsx("span",{className:"control-btn blue",onClick:()=>te(t),children:"点击查看"},"1")},{title:"链接",dataIndex:"connect",key:"connect",width:300,render:(e,t)=>a.jsx(a.Fragment,{children:a.jsx(o,{placement:"top",title:t.connect,children:a.jsx("span",{className:"link",children:t.connect})})})},{title:"状态",dataIndex:"status",key:"status"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"control",width:150,render:(e,t)=>{const s=[];k.includes("applet:edit")&&s.push(a.jsx("span",{className:"control-btn blue",onClick:()=>$(t,"edit"),children:a.jsx(o,{placement:"top",title:"详情",children:a.jsx(S,{})})},"1")),k.includes("applet:del")&&s.push(a.jsx(m,{title:"是否删除该新闻?",onConfirm:()=>(async e=>{try{const t={id:e.key},s=await x.deleteNews(t);s&&200===s.code?(i.success("删除成功"),1===T.length&&L.pageNum>1?E({pageNum:L.pageNum-1,pageSize:L.pageSize}):E(L)):i.error((null==s?void 0:s.message)??"操作失败")}finally{z(!1)}})(t),okText:"确定",cancelText:"取消",children:a.jsx("span",{className:"control-btn red",children:a.jsx(o,{placement:"top",title:"删除",children:a.jsx(b,{})})})},"field:del"));const l=[];return s.forEach(((e,t)=>{t&&l.push(a.jsx(u,{type:"vertical"},`line${t}`)),l.push(e)})),l}}],H={0:"上架",1:"下架",2:"删除"},K=e=>{switch(e){case"上架":default:return 0;case"下架":return 1;case"删除":return 2}},W=s.useMemo((()=>T.map(((e,t)=>({key:e.id,serial:e.id,newsTitle:e.newstitle,location:e.newslocatename,label:e.newstag,cover:e.picurl,connect:e.contenturl,status:H[e.status],updateTime:e.updated})))),[L,T]),[X,Y]=s.useState(!1),[Z,ee]=s.useState(""),te=e=>{Y(!0),ee(e.cover)};return s.useEffect((()=>{E(L),(async()=>{const e=(await x.newsPosition({uuid:""})).data.map((e=>({value:e.type,label:e.name})));B(e)})()}),[]),a.jsxs("div",{className:"gameList",children:[k.includes("applet:add")?a.jsxs("div",{className:"btnBox",children:[a.jsxs("div",{className:"btnBoxItem",children:[a.jsxs("div",{children:[a.jsxs("span",{className:"item-lable",style:{width:"60px"},children:["发布位置:"," "]}),a.jsx(g,{placeholder:"请选择",style:{width:150},allowClear:!0,options:q,onChange:e=>{D({newslocate:e})}})]}),a.jsxs("div",{style:{marginLeft:30},children:[a.jsxs("span",{className:"item-lable",style:{width:"60px"},children:["选择状态:"," "]}),a.jsx(g,{placeholder:"请选择状态",style:{width:"150px"},onChange:e=>{D({status:e})},allowClear:!0,options:[{value:0,label:"上架"},{value:1,label:"下架"}]})]})]}),a.jsxs("div",{children:[k.includes("applet:search")&&a.jsx(l,{type:"primary",icon:a.jsx(y,{}),onClick:()=>{E(L)},className:"btn",children:"搜索"}),a.jsxs(l,{type:"primary",className:"btn",onClick:()=>$(null,"add"),children:[a.jsx(f,{}),"新增新闻"]})]})]}):a.jsx(a.Fragment,{}),a.jsx("div",{className:"diy-table",children:a.jsx(c,{columns:R,loading:I,dataSource:W,pagination:{total:L.total,current:L.pageNum,pageSize:L.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>((e,t)=>{E({pageNum:e,pageSize:t||L.pageSize})})(e,t)}})}),a.jsx(w,{title:{add:"新增新闻",edit:"编辑新闻"}[P.operateType],open:P.modalShow,onOk:async()=>{var e,t,s,a,l,n,o,r,d;try{const p=await N.validateFields();if(M({modalLoading:!0}),"add"===P.operateType)try{const a={newstitle:p.newsTitle,newstag:p.tag,newslocate:null==p?void 0:p.position,picurl:null==(s=null==(t=null==(e=p.cover)?void 0:e.file)?void 0:t.response)?void 0:s.data[0],contenturl:p.link?p.link:"",status:p.status},l=await x.addNews(a);l&&200===l.code?(i.success("添加成功"),E(L),_()):i.error((null==l?void 0:l.message)??"操作失败")}finally{M({modalLoading:!1})}else try{const e=q.find((e=>e.value===p.position||e.label===p.position)),t=null==e?void 0:e.value,s={id:P.nowData.key,newstitle:p.newsTitle,newstag:p.tag,newslocate:t,picurl:(null==(n=null==(l=null==(a=p.cover)?void 0:a.file)?void 0:l.response)?void 0:n.data[0])?null==(d=null==(r=null==(o=p.cover)?void 0:o.file)?void 0:r.response)?void 0:d.data[0]:p.cover,contenturl:p.link?p.link:"",status:p.status},c=await x.editNews(s);200===(null==c?void 0:c.code)?(i.success("修改成功"),_()):i.error((null==c?void 0:c.message)??"修改失败")}catch(c){}finally{M({modalLoading:!1})}E(L)}catch{}},onCancel:_,okText:"上传",children:a.jsxs(r,{labelCol:{span:4},wrapperCol:{span:16},form:N,children:[a.jsx(r.Item,{name:"newsTitle",label:"新闻标题",rules:[{required:!0,message:"请输入新闻标题"}],children:a.jsx(d,{placeholder:"请输入"})}),a.jsx(r.Item,{name:"position",label:"发布位置",rules:[{required:!0,message:"请选择发布位置"}],children:a.jsx(g,{placeholder:"请选择",style:{width:120},allowClear:!0,options:q})}),a.jsx(r.Item,{name:"tag",label:"标签",rules:[{required:!0,message:"请输入标签"}],children:a.jsx(d,{placeholder:"请输入（最多4个字）",maxLength:4})}),a.jsx(r.Item,{name:"cover",label:"封面",rules:[{required:!0,message:"请上传封面文件"}],children:a.jsxs(v,{...Q,children:[a.jsx(l,{children:"上传文件"}),a.jsx("span",{style:{marginLeft:10},children:"jpg/png，大小不超过5M"})]})}),a.jsx(r.Item,{name:"link",label:"链接",children:a.jsx(d,{placeholder:"请输入"})}),a.jsx(r.Item,{name:"status",label:"上架",rules:[{required:!0}],children:a.jsxs(p.Group,{onChange:e=>{V(e.target.value)},value:U,children:[a.jsx(p,{value:0,children:"上架"}),a.jsx(p,{value:1,children:"下架"})]})})]})}),a.jsx(j,{style:{display:"none"},src:Z,preview:{visible:X,onVisibleChange:e=>{Y(e)}}})]})}export{k as default};
