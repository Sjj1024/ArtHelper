import{u as e,d as t,r as a,o as i,j as s,B as r,m as o}from"./index-efa3a32c.js";import{F as d}from"./index-ae2d5997.js";import{a as l}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as n}from"./index-65748fb5.js";import{P as u}from"./index-94ed3db3.js";import{a as p}from"./app-4adb5e72.js";import{u as c}from"./useSetState-78ffd672.js";import{M as m}from"./index-46e73bcd.js";import{S as x}from"./index-1c1deade.js";import{P as j}from"./PlusCircleOutlined-176a31dc.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";function y(){document.title="卡券管理";const y=e(),g=t((e=>e.app.powersCode)),[f]=d.useForm(),[h,S]=a.useState([]),[k,v]=a.useState(!1),[w,C]=c({pageNum:1,pageSize:10,total:0}),[T,z]=c({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),I={selectCard:void 0},L=()=>{f.setFieldsValue({...I}),z({modalShow:!1})},[N,b]=i(),F=async e=>{const t={page:e.pageNum,limit:e.pageSize,status:null,useruuid:N.get("uuid")};v(!0);try{const a=await p.userCard(t);a&&200===a.code?(S(a.data),C({total:a.count,pageNum:e.pageNum,pageSize:e.pageSize})):o.error((null==a?void 0:a.message)??"获取失败")}finally{v(!1)}},V=[{title:"卡券名称",dataIndex:"cardName",key:"cardName"},{title:"卡券类型",dataIndex:"cardType",key:"cardType",render:e=>1===e?"满减券":""},{title:"满额限制",dataIndex:"fullLimit",key:"fullLimit"},{title:"卡券价值",dataIndex:"cardValue",key:"cardValue"},{title:"适用门店",dataIndex:"store",key:"store",width:350},{title:"适用类型",dataIndex:"type",key:"type"},{title:"有效期",dataIndex:"lifespan",key:"lifespan"},{title:"领取时间",dataIndex:"getTime",key:"getTime"},{title:"使用状态",dataIndex:"status",key:"status",render:e=>0===e?"未使用":1===e?"已使用":"已失效"},{title:"操作",key:"control",render:(e,t)=>{const a=[];g.includes("share:edit")&&a.push(s.jsx(u,{title:"是否删除该卡券？",onConfirm:()=>{(async e=>{const t={useruuid:e.uuid,courtesyuuid:e.courtesyuuid},a=await p.userDelCard(t);a&&200===a.code?(o.success("删除成功"),F(w)):o.error((null==a?void 0:a.message)??"删除失败")})(t)},okText:"确定",cancelText:"取消",children:s.jsx("span",{style:{color:" rgb( 191, 58, 45)",cursor:"pointer"},children:"删除"},"1")},"2"));const i=[];return a.forEach(((e,t)=>{t&&i.push(s.jsx(n,{type:"vertical"},`line${t}`)),i.push(e)})),i}}],[D,O]=a.useState([]),E=a.useMemo((()=>h.map(((e,t)=>({uuid:e.useruuid,serial:t+1+(w.pageNum-1)*w.pageSize,id:e.id,courtesyuuid:e.courtesyuuid,cardName:e.courtesyname,cardType:e.property,fullLimit:e.usagelimitation,cardValue:e.courtesyprice,store:e.providerlist_name,storeId:e.provideruuidlist,type:e.usagerole_name,typeId:e.usagerole,lifespan:e.exptime,getTime:e.addtime,status:e.status})))),[w,h]);return a.useEffect((()=>{F(w),(async()=>{const e=await p.cardSelect();if(!e||200!==e.code)return o.error((null==e?void 0:e.message)??"获取失败"),[];O(e.data.map((e=>({label:e.courtesyname,value:e.uuid}))))})()}),[]),s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("div",{style:{position:"absolute",fontSize:"28px",fontWeight:"bold"},children:"查看卡券"}),s.jsxs("ul",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-end",paddingTop:"20px"},children:[g.includes("share:add")&&s.jsx("li",{children:s.jsx(r,{type:"primary",icon:s.jsx(j,{}),disabled:!g.includes("share:add"),onClick:()=>{return z({operateType:"add",nowData:e=null,modalShow:!0,modalLoading:!1}),void(e?f.setFieldsValue({selectCard:e.courtesyuuid}):f.setFieldsValue({...I}));var e},children:"添加卡券"})}),s.jsx("li",{style:{marginLeft:"20px"},children:s.jsx(r,{onClick:()=>y(-1),children:"返回"})})]})]}),s.jsx("div",{children:s.jsx(l,{columns:V,loading:k,dataSource:E,pagination:{total:w.total,current:w.pageNum,pageSize:w.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>((e,t)=>{F({pageNum:e,pageSize:t||w.pageSize})})(e,t)}})}),s.jsx(m,{title:{add:"添加卡券"}[T.operateType],open:T.modalShow,cancelText:"取消",okText:"确认",onOk:async e=>{z({modalLoading:!0});try{const e=await f.validateFields();if("add"===T.operateType){const t={useruuid:N.get("uuid"),courtesyuuid:e.selectCard},a=await p.userAddCard(t);a&&200===a.code?(o.success("添加成功"),L(),F(w)):o.error((null==a?void 0:a.message)??"添加失败")}}finally{z({modalLoading:!1})}},onCancel:()=>L(),confirmLoading:T.modalLoading,children:s.jsx(d,{form:f,initialValues:{formConditions:1},labelCol:{span:6},children:s.jsx(d.Item,{name:"selectCard",label:"选择卡券",rules:[{required:!0,message:"请选择卡券"}],children:s.jsx(x,{style:{width:"300px"},placeholder:"请选择",allowClear:!0,options:D})})})})]})}export{y as default};
