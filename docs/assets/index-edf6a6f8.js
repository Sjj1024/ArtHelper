import{u as e,r,o as s,j as t,m as n,B as a}from"./index-efa3a32c.js";import{F as i}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as o}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{o as l}from"./order-4f5746de.js";import{p as c}from"./pay-d2007870.js";import{M as p}from"./index-46e73bcd.js";import{S as m}from"./index-1c1deade.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";function u(){document.title="订单详情";const u=e(),j=()=>{u(-1)};i.useForm();const[x,h]=r.useState({});let[y,f]=s();const g=y.get("order"),v=r.useMemo((()=>x.orderpool?x.orderpool.map(((e,r)=>({type:e.propertyname,name:x.prodname,time:e.showtime,totalPrice:e.price*e.ordernum,ordernum:e.ordernum,price:e.price,sum:e.total}))):[]),[x]),[k,b]=r.useState(!1),[w,C]=r.useState(0),I=e=>{C(e.target.value)},S=async()=>{b(!0);const e=await c.refundAmount({orderuuid:g});e&&200===e.code?C(e.refundmount/100):n.error((null==e?void 0:e.msg)??"获取失败")},[F,N]=r.useState(""),[O,T]=r.useState("原路退款"),A=e=>{T(e)},P=[{title:"支付方式",dataIndex:"payType",key:"payType"},{title:"退款金额",dataIndex:"refund",key:"refund",render:(e,r)=>t.jsxs(t.Fragment,{children:["￥",t.jsx(d,{type:"text",onChange:I,style:{width:60,border:"none",padding:2},value:w})]})},{title:"退款方式",dataIndex:"refundType",key:"refundType",render:()=>t.jsx("div",{children:t.jsx(m,{defaultValue:"原路退款",style:{width:120},bordered:!1,onChange:A,options:[{value:"原路退款",label:"原路退款"}]})})}];r.useEffect((()=>{(async()=>{const e=await l.OrderDetail({orderuuid:g});if(e&&200===e.code){const r=null==e?void 0:e.data;h(r)}else n.error((null==e?void 0:e.msg)??"获取失败")})()}),[]);const R=async e=>{if(1===e)try{const e={orderuuid:g},r=await l.OrderLeave(e);r&&200===r.code?h((e=>({...e,status:2}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(r){}else if(0===e)try{const e={orderuuid:g},r=await l.cancelOrder(e);r&&200===r.code?(n.success("创建成功"),h((e=>({...e,status:3})))):n.error((null==r?void 0:r.message)??"操作失败")}catch(r){}},B=[{value:0,label:"支付宝"},{value:1,label:"微信"},{value:2,label:"现金"},{value:3,label:"银联"},{value:4,label:"其他支付方式"}],E=e=>{const r=B.find((r=>r.value===e));return r?r.label:""},M=r.useMemo((()=>[{payType:E(x?x.paymenttype:"")}]),[x]);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"order",children:[t.jsx("h1",{children:"订单详情"}),t.jsxs("div",{className:"order-content1",children:[t.jsx("h3",{children:"订单信息"}),t.jsxs("p",{children:[t.jsx("span",{children:"订单状态:"})," ",function(e){switch(e){case 0:return"待付款";case 1:return"已支付";case 2:return"已完成";case 3:return"已取消";case 4:return"已退款";default:return"未知状态"}}(x?x.status:""),x?3===x.status&&t.jsx("span",{style:{color:"red",width:"90px"},children:"(订单未支付)"}):t.jsx(t.Fragment,{})]}),t.jsxs("p",{children:[t.jsx("span",{children:"订单编号:"})," ",g]}),t.jsxs("p",{children:[t.jsx("span",{children:"创建时间:"})," ",x?x.addtime:""]}),t.jsxs("p",{children:[t.jsx("span",{children:"门店:"})," ",x?x.storename:""]}),t.jsxs("p",{children:[t.jsx("span",{children:"支付方式:"})," ",E(x?x.paymenttype:"")]}),t.jsxs("p",{children:[t.jsx("span",{children:"顾客:"})," ",x?x.username:""]}),t.jsxs("p",{children:[t.jsx("span",{style:{width:"85px"},children:"顾客手机号:"})," ",x?x.usermob:""]}),t.jsxs("p",{children:[t.jsx("span",{children:"订单备注:"})," ",x?x.comments:""]})]}),t.jsxs("div",{className:"order-content2",children:[t.jsx("h3",{children:"消费信息"}),t.jsx(o,{dataSource:v,columns:[{title:"类型",dataIndex:"type",key:"type"},{title:"收费项目",dataIndex:"name",key:"name"},{title:"时间",dataIndex:"time",key:"time"},{title:"价格/数量",dataIndex:"totalPrice",key:"totalPrice",render:(e,r)=>` ￥${r.price} × ${r.ordernum}`},{title:"小计",dataIndex:"sum",key:"sum"}],bordered:!0,className:"table",pagination:!1}),t.jsxs("p",{children:[t.jsx("span",{children:"优惠："})," ￥",x?x.courtesyprice:"",x.courtesyprice?`(${x.courtesyname})`:""]}),t.jsxs("p",{children:[t.jsx("span",{children:"订单合计："})," ￥",x?x.actualmount:""]}),t.jsx("div",{className:"btn",children:($=x?x.status:"",0===$?t.jsxs(t.Fragment,{children:[t.jsx(a,{type:"primary",className:"cancel",onClick:()=>{R($)},children:"取消订单"}),t.jsx(a,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):1===$?t.jsxs(t.Fragment,{children:[t.jsx(a,{type:"primary",onClick:()=>{R($)},children:"确认核销"}),t.jsx(a,{type:"primary",className:"cancel",onClick:()=>{S()},children:"取消订单"}),t.jsx(a,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):2===$?t.jsxs(t.Fragment,{children:[t.jsx(a,{type:"primary",className:"cancel",onClick:()=>{S()},children:"取消订单"}),t.jsx(a,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):t.jsx(t.Fragment,{children:t.jsx(a,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})}))})]}),t.jsx(p,{title:"退款",open:k,onOk:async()=>{if("原路退款"===O){try{const e={refund_amount:100*w,orderuuid:g,refund_reason:F},r=await c.refund(e);r&&200===r.code?h((e=>({...e,status:4}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(e){}b(!1)}else{try{const e={refundpic:w,orderuuid:g,remarks:F},r=await c.payXRefund(e);r&&200===r.code?h((e=>({...e,status:4}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(e){}b(!1)}},onCancel:()=>{b(!1)},okText:"确认退款",children:t.jsxs(i,{children:[t.jsxs(i.Item,{label:"退款结算",children:[t.jsx(o,{dataSource:M,columns:P,bordered:!0,pagination:!1,className:"tabRefund"}),t.jsxs("p",{style:{margin:0},children:[t.jsx("span",{style:{color:"red"},children:"*"}),"最大退款金额为：",x?x.actualmount:""]})]}),t.jsx(i.Item,{label:"退款说明",children:t.jsx(d.TextArea,{name:"refundReason",rows:3,maxLength:30,placeholder:"可备注退款原因",onChange:e=>{N(e.target.value)}})})]})})]})});var $}export{u as default};
