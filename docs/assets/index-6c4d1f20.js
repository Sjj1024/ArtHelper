import{u as e,d as s,r as a,j as l,B as t,m as i,a_ as r,h as n}from"./index-efa3a32c.js";import{F as o}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as u}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as p}from"./index-65748fb5.js";import{D as m}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{I as c}from"./index-06b8a89d.js";import{h}from"./hado-a6960cf0.js";import{s as x}from"./store-7211fed8.js";import{a as j}from"./app-4adb5e72.js";import{u as v}from"./useSetState-78ffd672.js";import{S as g}from"./index-1c1deade.js";import{M as y}from"./index-46e73bcd.js";import{S}from"./SearchOutlined-24304577.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./CalendarOutlined-8ff6678f.js";import"./CheckOutlined-f0d55485.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";function b(){document.title="用户管理";const b=e(),w=s((e=>e.app.powersCode)),[f]=o.useForm(),[k]=o.useForm(),[C]=o.useForm(),[N,T]=a.useState([]),[I,z]=a.useState(!1),[F,O]=v({pageNum:1,pageSize:10,total:0}),[D,V]=v({username:void 0,id:void 0,mobile:void 0,zoneuuid:void 0,userlevel:void 0,isvip:void 0}),B=async e=>{const s={page:e.pageNum,limit:e.pageSize,username:D.username,id:D.id,mobile:D.mobile,zoneuuid:D.zoneuuid,userlevel:D.userlevel,isvip:D.isvip};z(!0);try{const a=await h.miniUserList(s);a&&200===a.code?(T(a.data),O({pageNum:e.pageNum,pageSize:e.pageSize,total:a.count})):i.error((null==a?void 0:a.message)??"数据获取失败")}finally{z(!1)}},[Y,q]=a.useState({}),[A,L]=a.useState(!1),[E,H]=a.useState({}),[M,$]=a.useState(!1),P=[{key:"1",label:w.includes("users:editUserType")?l.jsx("span",{style:{color:"#1890ff"},children:"修改用户类型"}):null},{key:"2",label:w.includes("users:seeCard")?l.jsx("span",{style:{color:"#1890ff"},children:"查看卡券"}):null}],[U,_]=a.useState([]),G=[{title:"用户昵称",dataIndex:"userName",key:"userName"},{title:"id",dataIndex:"usershowid",key:"usershowid"},{title:"手机号",dataIndex:"phone",key:"phone",render:e=>(e=>{const s=e.match(/^(\d{3})(\d{4})(\d{4})$/);return s?`${s[1]}****${s[3]}`:e})(e)},{title:"赛区",dataIndex:"zone",key:"zone"},{title:"用户类型",dataIndex:"userType",key:"userType",render:e=>52==e?"教练":"普通玩家"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"最后游玩时间",dataIndex:"endTime",key:"endTime"},{title:"累计充值",dataIndex:"recharge",key:"recharge"},{title:"HADO钻石",dataIndex:"diamonds",key:"diamonds"},{title:"HADO金币",dataIndex:"gold",key:"gold"},{title:"通行证状态",dataIndex:"passportStatus",key:"passportStatus"},{title:"特权到期时间",dataIndex:"dueTime",key:"dueTime"},{title:"操作",key:"control",fixed:"right",width:330,render:(e,s)=>{const a=[];w.includes("users:passActive")&&a.push(l.jsxs("span",{children:["未激活"==s.passportStatus&&l.jsx("span",{onClick:()=>{return e=s,C.setFieldsValue({passportStatus:e.passportStatus,endTime:n()}),L(!0),void q(e);var e},className:"controlBtn",children:"激活通行证"}),"激活"==s.passportStatus&&l.jsx("span",{onClick:()=>{return e=s,$(!0),void H(e);var e},className:"pass",children:"注销通行证"})]},"1")),w.includes("users:heroActive")&&a.push(l.jsx("span",{className:"controlBtn",onClick:()=>J(s),children:l.jsx("span",{children:"激活英雄"})},"2")),w.includes("users:exchange")&&a.push(l.jsx("span",{onClick:()=>ae(s),className:"controlBtn",children:l.jsx("span",{children:"金币钻石兑换"})},"3")),w.includes("users:more")&&a.push(l.jsx(r,{menu:{items:P,onClick:({key:e})=>{"1"===e?W(s):"2"===e&&b("/applet/users/cardsee?uuid="+s.uuid)}},className:"controlBtn",children:l.jsx("span",{children:"更多"})},"4"));const t=[];return a.forEach(((e,s)=>{s&&t.push(l.jsx(p,{type:"vertical"},`line${s}`)),t.push(e)})),t}}],J=e=>{b("/applet/users/heroactive?uuid="+e.uuid)},Q=a.useMemo((()=>N.map(((e,s)=>({key:s,uuid:e.uuid,userName:e.username,usershowid:e.usershowid,phone:e.mob,zone:e.zonename,userType:e.userlevel,createTime:e.addtime,endTime:e.lasttime,recharge:e.recharge,diamonds:e.diamondnum,gold:e.goldcoinnum,passportStatus:e.passportstatus,dueTime:e.passportendtime})))),[F,N]),[K,R]=a.useState({}),W=e=>{k.setFieldsValue({userType:e.userType}),R(e),ie(!0)},[X,Z]=a.useState(!1),[ee,se]=a.useState({}),ae=e=>{Z(!0),se(e)},le=()=>{f.setFieldsValue({propNames:null,propNum:null}),de(!1),Z(!1)},[te,ie]=a.useState(!1),[re,ne]=a.useState([]),[oe,de]=a.useState(!1),[ue,pe]=a.useState(),me=async()=>{const e=await j.userDiamond({useruuid:ee.uuid,propuuid:f.getFieldValue("propNames")});e&&200===e.code&&pe(e.data)};return a.useEffect((()=>{B(F),(async()=>{const e=await x.getProvince();if(e&&200===e.code){const s=e.data.map((e=>({label:e.provincename,value:e.uuid})));ne(s)}})(),(async()=>{const e=await j.propSelect();e&&200===e.code&&_(e.data.map((e=>({label:e.name,value:e.uuid}))))})()}),[]),l.jsxs("div",{className:"gameList",children:[l.jsxs("div",{className:"btnBox",children:[l.jsxs("div",{className:"btnBoxItem",children:[l.jsxs("div",{children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"用户昵称："}),l.jsx(d,{placeholder:"请输入",style:{width:"150px"},allowClear:!0,value:D.username,onChange:e=>{V({username:e.target.value})}})]}),l.jsxs("div",{style:{marginLeft:30},children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"id："}),l.jsx(d,{placeholder:"请输入",style:{width:"150px"},allowClear:!0,value:D.id,onChange:e=>{V({id:e.target.value})}})]}),l.jsxs("div",{style:{marginLeft:30},children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"手机："}),l.jsx(d,{placeholder:"请输入",style:{width:"150px"},allowClear:!0,value:D.mobile,onChange:e=>{V({mobile:e.target.value})}})]}),l.jsxs("div",{style:{marginLeft:30},children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"赛区："}),l.jsx(g,{placeholder:"请选择",style:{width:"150px"},onChange:e=>{V({zoneuuid:e})},value:D.zoneuuid,allowClear:!0,options:re})]}),l.jsxs("div",{style:{marginLeft:30},children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"用户类型："}),l.jsx(g,{placeholder:"请选择",style:{width:"150px"},onChange:e=>{V({userlevel:e})},value:D.userlevel,allowClear:!0,options:[{value:77,label:"普通玩家"},{value:52,label:"教练"}]})]}),l.jsxs("div",{style:{marginLeft:30},children:[l.jsx("span",{className:"item-lable",style:{width:"60px"},children:"通行证状态："}),l.jsx(g,{placeholder:"请选择",style:{width:"150px"},onChange:e=>{V({isvip:e})},value:D.isvip,allowClear:!0,options:[{value:0,label:"未激活"},{value:1,label:"激活"}]})]})]}),l.jsx("div",{children:w.includes("users:search")&&l.jsx(t,{type:"primary",icon:l.jsx(S,{}),onClick:()=>{B(F)},className:"btn",children:"搜索"})})]}),l.jsx("div",{className:"diy-table",children:l.jsx(u,{columns:G,loading:I,dataSource:Q,scroll:{x:"max-content"},pagination:{total:F.total,current:F.pageNum,pageSize:F.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{B({pageNum:e,pageSize:s||F.pageSize})})(e,s)}})}),l.jsx(y,{title:"修改用户类型",open:te,onOk:()=>{h.userTypeEdit({useruuid:K.uuid,userlevel:k.getFieldValue("userType")}).then((e=>{e&&200===e.code?(i.success("修改成功"),ie(!1),B(F)):i.error((null==e?void 0:e.message)??"修改失败")}))},onCancel:()=>{ie(!1)},okText:"确定",cancelText:"取消",children:l.jsx(o,{labelCol:{span:8},form:k,children:l.jsx(o.Item,{name:"userType",label:"用户类型",rules:[{required:!0,message:"请选择用户类型"}],children:l.jsx(g,{placeholder:"请选择",style:{width:200},allowClear:!0,options:[{value:77,label:"普通玩家"},{value:52,label:"教练"}]})})})}),l.jsx(y,{title:"激活通行证",open:A,onOk:async()=>{h.activePass({useruuid:Y.uuid,status:C.getFieldValue("passportStatus"),endtime:C.getFieldValue("endTime").format("YYYY-MM-DD HH:mm:ss")}).then((e=>{e&&200===e.code?(i.success("操作成功"),L(!1),B(F)):i.error((null==e?void 0:e.message)??"操作失败")}))},onCancel:()=>{L(!1)},okText:"确定",cancelText:"取消",children:l.jsxs(o,{labelCol:{span:8},form:C,children:[l.jsx(o.Item,{name:"passportStatus",label:"通行证状态",rules:[{required:!0,message:"请选择通行证状态"}],children:l.jsx(g,{placeholder:"请选择",style:{width:200},allowClear:!0,options:[{value:1,label:"激活"},{value:0,label:"未激活"}]})}),l.jsx(o.Item,{name:"endTime",label:"特权到期时间",rules:[{required:!0,message:"请选择特权到期时间"}],children:l.jsx(m,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss"})})]})}),l.jsx(y,{title:"注销通行证",open:M,onOk:async()=>{h.cancelPass({useruuid:E.uuid}).then((e=>{e&&200===e.code?(i.success("注销成功"),$(!1),B(F)):i.error((null==e?void 0:e.message)??"注销失败")}))},onCancel:()=>{$(!1)},okText:"确定",cancelText:"取消",children:l.jsx("div",{style:{textAlign:"center"},children:"是否确认注销该用户的赛季通行证，注销后用户的特权将失效，黄金通行证奖励将不再可领取。"})}),l.jsx(y,{title:"金币钻石兑换",open:X,onOk:()=>{j.propDeduct({useruuid:ee.uuid,propuuid:f.getFieldValue("propNames"),num:f.getFieldValue("propNum")}).then((e=>{e&&200===e.code?(i.success("修改成功"),Z(!1),B(F),le()):i.error((null==e?void 0:e.message)??"修改失败")}))},onCancel:le,okText:"确定",cancelText:"取消",children:l.jsxs(o,{labelCol:{span:8},form:f,children:[l.jsx(o.Item,{name:"reason",label:"修改原因",rules:[{required:!0}],children:l.jsx("span",{children:"线下兑换"})}),l.jsxs(o.Item,{name:"propNames",label:"道具名称",rules:[{required:!0,message:"请选择道具"}],children:[l.jsx(g,{placeholder:"请选择",style:{width:200},allowClear:!0,value:f.getFieldValue("propNames"),options:U,onChange:e=>{f.setFieldsValue({propNames:e}),me(),de(!0)}}),oe?l.jsxs("span",{style:{color:"rgb(172,172,172)",fontSize:"12px"},children:["（剩余：",l.jsx("span",{style:{color:"rgb(203, 96, 86)"},children:ue}),"）"]}):null]}),l.jsx(o.Item,{name:"propNum",label:"抵扣数量",rules:[{required:!0,message:"请输入抵扣数量"}],children:l.jsx(c,{placeholder:"请输入",style:{width:200},min:1,precision:0,step:1})})]})})]})}export{b as default};
