import{r as e,g as s,p as a,q as l,s as i,f as t,K as n,C as d,v as o,D as r,W as c,_ as u,L as m,o as p,j as x,B as h,h as v,m as j}from"./index-efa3a32c.js";import{C as f}from"./index-b686cec5.js";import{C as b}from"./index-0373e759.js";import{D as C}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{F as y}from"./index-ae2d5997.js";import{I as g}from"./index-06b8a89d.js";/* empty css              */import{a as N}from"./index-639ffc53.js";import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{s as k}from"./store-7211fed8.js";import{M as w}from"./index-46e73bcd.js";import{S}from"./index-1c1deade.js";import"./index-0a1440ec.js";import"./context-cb88fb1e.js";import"./CalendarOutlined-8ff6678f.js";import"./statusUtils-b010cbea.js";import"./responsiveObserve-b13564d4.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-177532f7.js";import"./EyeOutlined-319494bf.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";var Y=e.forwardRef((function(d,o){var r,c=d.prefixCls,u=void 0===c?"rc-switch":c,m=d.className,p=d.checked,x=d.defaultChecked,h=d.disabled,v=d.loadingIcon,j=d.checkedChildren,f=d.unCheckedChildren,b=d.onClick,C=d.onChange,y=d.onKeyDown,g=s(d,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),N=a(!1,{value:p,defaultValue:x}),k=l(N,2),w=k[0],S=k[1];function Y(e,s){var a=w;return h||(S(a=e),null==C||C(a,s)),a}var I=i(u,m,(t(r={},"".concat(u,"-checked"),w),t(r,"".concat(u,"-disabled"),h),r));return e.createElement("button",Object.assign({},g,{type:"button",role:"switch","aria-checked":w,disabled:h,className:I,ref:o,onKeyDown:function(e){e.which===n.LEFT?Y(!1,e):e.which===n.RIGHT&&Y(!0,e),null==y||y(e)},onClick:function(e){var s=Y(!w,e);null==b||b(s,e)}}),v,e.createElement("span",{className:"".concat(u,"-inner")},w?j:f))}));Y.displayName="Switch";var I=globalThis&&globalThis.__rest||function(e,s){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&s.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)s.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(a[l[i]]=e[l[i]])}return a},D=e.forwardRef((function(s,a){var l=s.prefixCls,n=s.size,p=s.disabled,x=s.loading,h=s.className,v=void 0===h?"":h,j=I(s,["prefixCls","size","disabled","loading","className"]),f=e.useContext(d),b=f.getPrefixCls,C=f.direction,y=e.useContext(o),g=e.useContext(r),N=(null!=p?p:g)||x,k=b("switch",l),w=e.createElement("div",{className:"".concat(k,"-handle")},x&&e.createElement(m,{className:"".concat(k,"-loading-icon")})),S=i(t(t(t({},"".concat(k,"-small"),"small"===(n||y)),"".concat(k,"-loading"),x),"".concat(k,"-rtl"),"rtl"===C),v);return e.createElement(c,{insertExtraNode:!0},e.createElement(Y,u({},j,{prefixCls:k,className:S,disabled:N,ref:a,loadingIcon:w})))}));D.__ANT_SWITCH=!0;const O=D;function M(){var s,a,l,i,t,n;document.title="编辑序列号";let[d,o]=p();const r=d.get("license"),c={labelCol:{span:4},wrapperCol:{span:16}},[u]=y.useForm(),[m]=y.useForm(),[Y,I]=e.useState(),D=async()=>{var e,s,a;const l=await k.getLicenseDetail({uuid:r});if(l&&200===l.code){I(l.data);const i=l.data.version.map((e=>({key:e.puuid,...e})));if(B(i),Q(i.map((e=>e.prodname)).join(",")),W(i.map((e=>e.puuid))),null==(e=null==Y?void 0:Y.codetoprovider)?void 0:e.expiredate){const e=v(null==(a=null==(s=l.data)?void 0:s.codetoprovider)?void 0:a.expiredate,"YYYY-MM-DD");U(e)}}else j.error((null==l?void 0:l.msg)??"获取失败")},[M,F]=e.useState([]),[E,_]=e.useState(),[P,V]=e.useState(),[L,A]=e.useState(),[T,B]=e.useState([]),[K,W]=e.useState([]),[z,G]=e.useState(0),[H,R]=e.useState(!1),[q,U]=e.useState(),[J,Q]=e.useState(""),[X,Z]=e.useState(!0),[$,ee]=e.useState(!1),[se,ae]=e.useState([]),[le,ie]=e.useState([]),te=async()=>{const e=await k.getProduct();if(e&&200===e.code){const s=e.data.map((e=>({key:e.uuid,...e})));ie(s)}else j.error(e.msg||"产品列表获取失败")},ne=[{title:"产品",dataIndex:"prodname",key:"prodname"},{title:"当前版本",dataIndex:"version",key:"version"},{title:"最新版本",dataIndex:"versioncode",key:"versioncode"},{title:"状态",dataIndex:"status_main",key:"status_main"},{title:"状态详情",dataIndex:"status_details",key:"status_details"},{title:"操作",dataIndex:"action",key:"action",render:(e,s)=>x.jsx(h,{type:"primary",style:{marginLeft:"20px"},onClick:()=>ue(s),children:"变更"})}],[de,oe]=e.useState(!1),[re,ce]=e.useState(),ue=e=>{oe(!0),ce(e),m.setFieldsValue({status:e.status}),V(e.status),0===e.status&&A(v(null==e?void 0:e.validationdate,"YYYY-MM-DD"))};return e.useEffect((()=>{(async()=>{const e=await k.getCharge();if(e&&200===e.code){const s=e.data.map((e=>({label:e.name,value:e.id})));F(s)}else j.error((null==e?void 0:e.msg)??"获取失败")})(),D(),te()}),[]),x.jsxs("div",{className:"license-box",children:[x.jsx(f,{title:"序列号基本信息",bordered:!0,children:x.jsxs("div",{className:"store-info-box",children:[x.jsxs("div",{className:"info-box-line",children:[x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"所属代理："}),x.jsx("span",{children:null==Y?void 0:Y.agentinname})]}),x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"所属门店："}),x.jsx("span",{children:null==Y?void 0:Y.providername})]})]}),x.jsxs("div",{className:"info-box-line",children:[x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"场地名称："}),x.jsx("span",{children:null==Y?void 0:Y.stationname})]}),x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"产品序列号："}),x.jsx("span",{children:null==(s=null==Y?void 0:Y.codetoprovider)?void 0:s.regcode})]})]}),x.jsxs("div",{className:"info-box-line",children:[x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"激活状态："}),x.jsx("span",{children:0===(null==Y?void 0:Y.status)?"待激活":1===(null==Y?void 0:Y.status)?"激活":"冻结"}),x.jsx(h,{type:"primary",style:{marginLeft:"20px"},onClick:()=>{var e,s,a;R(!0),u.setFieldValue("method",null==(e=null==Y?void 0:Y.codetoprovider)?void 0:e.regproperty),_(null==(s=null==Y?void 0:Y.codetoprovider)?void 0:s.regproperty);const l=1===(null==Y?void 0:Y.status);Z(l),u.setFieldValue("status",l),U(v(null==(a=null==Y?void 0:Y.codetoprovider)?void 0:a.expiredate,"YYYY-MM-DD"))},children:"变更"})]}),x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"状态详情："}),x.jsx("span",{children:null==(l=null==(a=null==Y?void 0:Y.codetoprovider)?void 0:a.statusreamk)?void 0:l.split(" ")[0]})]})]}),x.jsxs("div",{className:"info-box-line",children:[x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"产品内容："}),x.jsx("span",{children:J||"未添加"}),x.jsx(h,{type:"primary",style:{marginLeft:"20px"},onClick:()=>{const e=null==Y?void 0:Y.version,s=null==e?void 0:e.map((e=>e.puuid));ae(s),ee(!0)},children:"变更"})]}),x.jsxs("div",{className:"line-item",children:[x.jsx("span",{className:"line-label",children:"使用限制："}),x.jsx("span",{children:"主机限制"})]})]})]})}),x.jsx(N,{className:"productBox",dataSource:T,columns:ne,pagination:{position:[]}},"puuid"),x.jsx(w,{title:"序列号激活",open:H,onOk:async()=>{const e=await u.validateFields();let s="";try{s=v(null==e?void 0:e.time).format("YYYY-MM-DD")}catch(i){}const a={reguuid:null==Y?void 0:Y.reguuid,regproperty:null==e?void 0:e.method,status:!0===(null==e?void 0:e.status)?1:2,expiredate:s,volnum:z},l=await k.updateLicense(a);l&&200===l.code?(j.success("更新成功"),R(!1),D()):j.error((null==l?void 0:l.msg)??"更新失败")},onCancel:()=>{u.resetFields(),R(!1)},children:x.jsx("div",{className:"active-box",children:x.jsxs(y,{...c,form:u,name:"control-hooks",style:{maxWidth:600},children:[x.jsx(y.Item,{name:"method",label:"计费方式",children:x.jsx(S,{placeholder:"请选择计费方式",onChange:e=>{_(e),0!==e&&3!==e||U(v())},options:M,style:{width:"200px"},allowClear:!0})}),1===E?x.jsxs("div",{children:[x.jsx(y.Item,{name:"time",label:"充值次数",children:x.jsx(g,{style:{width:"200px"},addonAfter:"次",onChange:e=>{G(e)}})}),x.jsx(y.Item,{name:"time",label:"使用期限",children:x.jsxs("span",{children:["剩余",parseInt((null==(i=null==Y?void 0:Y.codetoprovider)?void 0:i.volumne.toString())||"0")+z,"次"]})})]}):2===E?x.jsx(y.Item,{name:"time",label:"有效期至",children:x.jsx("span",{children:"永久有效"})}):x.jsx(y.Item,{name:"time",label:"有效期至",initialValue:q,children:x.jsx(C,{placeholder:"请选择有效期",format:"YYYY-MM-DD",value:q})}),x.jsx(y.Item,{name:"status",label:"服务状态",valuePropName:"checked",children:x.jsx(O,{checkedChildren:"运行",unCheckedChildren:"关闭",checked:X,onChange:e=>{u.setFieldValue("status",e)}})})]})})},"license"),x.jsx(w,{title:"产品内容",open:$,onOk:async()=>{const e=se.join(","),s=await k.updateProduct({stationuuid:Y.stationuuid,puuids:e});s&&200===s.code?(j.success("更新成功"),D(),ee(!1)):j.error((null==s?void 0:s.msg)??"更新失败")},onCancel:()=>{ee(!1)},children:x.jsx("div",{className:"product-box",children:x.jsx(b.Group,{style:{width:"100%"},onChange:e=>{ae(e)},defaultValue:K,children:le.map((e=>x.jsx(b,{value:e.uuid,disabled:"HADO Server"===e.prodname,children:e.prodname},e.uuid)))})})},"product"),x.jsx(w,{title:"产品激活",open:de,onOk:async()=>{const e=await m.validateFields();let s="";e.validationdate&&0===e.status&&(s=v(null==e?void 0:e.validationdate).format("YYYY-MM-DD"));const a={stationuuid:Y.stationuuid,puuid:re.puuid,status:e.status,validationdate:s};200===(await k.updateProductStatus(a)).code?j.success("操作成功"):j.error("操作失败"),oe(!1),D(),te()},onCancel:()=>{oe(!1)},children:x.jsx("div",{className:"active-box",children:x.jsxs(y,{...c,form:m,name:"control-hooks",style:{maxWidth:600},children:[x.jsx("div",{className:"licenseCenter",children:x.jsx("span",{children:null==(n=null==(t=null==Y?void 0:Y.codetoprovider)?void 0:t.statusreamk)?void 0:n.split(" ")[0]})}),x.jsx(y.Item,{name:"status",label:"激活方式",children:x.jsx(S,{placeholder:"请选择激活方式",onChange:e=>{V(e)},options:[{label:"买断",value:1},{label:"按月",value:0},{label:"冻结",value:2}],style:{width:"200px"},allowClear:!0})}),0===P?x.jsx(y.Item,{name:"validationdate",label:"有效期至",children:x.jsx(C,{placeholder:"请选择有效期",format:"YYYY-MM-DD",defaultValue:L,value:L})}):1===P?x.jsx(y.Item,{name:"time",label:"有效期至",children:x.jsx("span",{children:"永久有效"})}):x.jsx(y.Item,{name:"time",label:"有效期至",children:x.jsx("span",{children:"-"})})]})})},"productActive")]})}export{M as default};
