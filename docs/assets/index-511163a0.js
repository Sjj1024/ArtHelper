import{o as e,u as a,r as t,j as l,h as r,e as s,B as n,m,bK as i,bL as c}from"./index-efa3a32c.js";import{D as u}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{F as o}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{I as h}from"./index-06b8a89d.js";/* empty css              *//* empty css              */import{R as p}from"./index-8053d899.js";/* empty css                   */import{I as g}from"./antd-img-crop.esm-33921adc.js";import{a as j}from"./v1api-f78cc73a.js";import{u as x}from"./useSetState-78ffd672.js";import{S as v}from"./index-1c1deade.js";import{U as f}from"./index-dff1ae8b.js";import"./CalendarOutlined-8ff6678f.js";import"./context-cb88fb1e.js";import"./statusUtils-b010cbea.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./isEqual-8ee5b3ce.js";import"./index-46e73bcd.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./getScrollBarSize-c6833c2b.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./CheckOutlined-f0d55485.js";import"./useForceUpdate-9ad39bdf.js";import"./DeleteOutlined-6b999003.js";function Y(){document.title="编辑比赛";let[Y,b]=e();const H=Y.get("id"),D=Y.get("model"),[M,w]=x(JSON.parse(localStorage.getItem("creatInfo")||"{}")),[C]=o.useForm(),I=a();document.title="1"===D?"新建比赛":"编辑比赛";const[S,F]=x({id:8,uuid:"",matchname:"",leagueuuid:null,level:null,matchintro:"",matchaddr:"",matchvolume:0,matchreg:null,matchregend:null,matchstart:null,matchpicurl:"",matchintrodetail:"",matchchampionurl:"",matchrunnerupurl:"",matchsecondrunnerupurl:"",matchstatus:0,status:0,addtime:"",updated:"",alreadymatchvolume:0}),y=e=>{C.setFieldsValue({matchname:e.matchname,leagueuuid:e.leagueuuid,level:e.level,matchintro:e.matchintro,matchaddr:e.matchaddr,matchvolume:e.matchvolume,matchreg:e.matchreg?r(e.matchreg,"YYYY-MM-DD HH:mm:ss"):null,matchregend:e.matchregend?r(e.matchregend,"YYYY-MM-DD HH:mm:ss"):null,matchstart:e.matchstart?r(e.matchstart,"YYYY-MM-DD HH:mm:ss"):null,matchpicurl:e.matchpicurl,matchintrodetail:e.matchintrodetail,matchchampionurl:e.matchchampionurl,matchrunnerupurl:e.matchrunnerupurl,matchsecondrunnerupurl:e.matchsecondrunnerupurl}),_([{uid:"1",name:e.matchpicurl,status:"done",url:e.matchpicurl}]),A([{uid:"1",name:e.matchchampionurl,status:"done",url:e.matchchampionurl}]),$([{uid:"1",name:e.matchrunnerupurl,status:"done",url:e.matchrunnerupurl}]),G([{uid:"1",name:e.matchsecondrunnerupurl,status:"done",url:e.matchsecondrunnerupurl}])},N=t.useMemo((()=>({toolbar:{container:[[{header:[1,2,3,4,5,!1]}],["bold","italic","underline","strike","blockquote","image"],[{list:"ordered"},{list:"bullet"},{color:[]},{background:[]},{align:[]}]]}})),[]),[q,L]=t.useState(""),B=t.useRef(null),[P,V]=t.useState(""),[k,T]=t.useState(0);t.useEffect((()=>{var e;const a=null==(e=null==B?void 0:B.current)?void 0:e.getEditor();a&&"api"===P&&0!==k&&a.setSelection(k+1)}),[q]);const E=e=>{if(e.size>1048576)return m.error("图片尺寸不符合要求，请重新上传"),f.LIST_IGNORE;const a="image/png"===e.type||"image/jpeg"===e.type||"image/bmp"===e.type;return a||f.LIST_IGNORE},[O,_]=t.useState([]),[U,A]=t.useState([]),[R,$]=t.useState([]),[z,G]=t.useState([]),W=async e=>{let a=e.url;a||(a=await new Promise((a=>{const t=new FileReader;t.readAsDataURL(e.originFileObj),t.onload=()=>a(t.result)})));const t=new Image;t.src=a;const l=window.open(a);null==l||l.document.write(t.outerHTML)},[J,K]=t.useState([]),X=(e,a)=>e.length>a?e.slice(0,a):e;return t.useEffect((()=>{(async()=>{const e=await j.leagueSelectList();if(200===e.code){const a=e.data.map((e=>({value:e.uuid,label:e.leaguename})));K(a)}else m.error(e.msg)})(),H?(async()=>{const e={uuid:H},a=await j.matchInfo(e);200===a.code?(F(a.data),y(a.data)):m.error(a.msg)})():(F({matchname:"",leagueuuid:null,level:null,matchintro:"",matchaddr:"",matchvolume:0,matchreg:null,matchregend:null,matchstart:null,matchpicurl:"",matchintrodetail:"",matchchampionurl:"",matchrunnerupurl:"",matchsecondrunnerupurl:""}),C.setFieldsValue({matchname:"",leagueuuid:null,level:null,matchintro:"",matchaddr:"",matchvolume:0,matchreg:null,matchregend:null,matchstart:null,matchpicurl:"",matchintrodetail:"",matchchampionurl:"",matchrunnerupurl:"",matchsecondrunnerupurl:""}))}),[]),l.jsx("div",{className:"DetailBox",children:l.jsxs(o,{name:"competitionBase",form:C,labelCol:{span:3},wrapperCol:{span:18},style:{minWidth:600},initialValues:{ruleList:[{}]},onFinish:async e=>{try{const e=await C.validateFields();e.matchname,e.leagueuuid,e.level,e.matchintro,e.matchaddr,e.matchvolume,e.matchreg.format("YYYY-MM-DD HH:mm:ss"),e.matchregend.format("YYYY-MM-DD HH:mm:ss"),e.matchstart.format("YYYY-MM-DD HH:mm:ss"),e.matchpicurl,e.matchintrodetail,e.matchchampionurl,e.matchrunnerupurl,e.matchsecondrunnerupurl}catch(a){}},labelAlign:"right",onFinishFailed:e=>{},autoComplete:"off",children:[l.jsx(o.Item,{label:"比赛名称",name:"matchname",rules:[{required:!0,message:"请填写比赛名称"},{max:40,message:"比赛名称最多40个字"}],children:l.jsx(d,{placeholder:"请输入比赛名称"})}),l.jsx(o.Item,{label:"所属联赛",name:"leagueuuid",rules:[{required:!0,message:"请选择所属联赛"}],children:l.jsx(v,{style:{width:200},options:J,placeholder:"请选择所属联赛"})}),l.jsx(o.Item,{label:"比赛等级",name:"level",rules:[{required:!0,message:"请选择比赛等级"}],children:l.jsx(v,{style:{width:200},options:[{value:1,label:"1级"},{value:2,label:"2级"},{value:3,label:"3级"},{value:4,label:"4级"},{value:5,label:"5级"}],placeholder:"请选择比赛等级"})}),l.jsx(o.Item,{label:"比赛简介",name:"matchintro",rules:[{required:!0,message:"请填写比赛简介"},{max:40,message:"比赛简介最多40个字"}],children:l.jsx(d,{placeholder:"请输入比赛简介",onChange:e=>{const a=X(e.target.value,40);C.setFieldsValue({matchintro:a})}})}),l.jsx(o.Item,{label:"比赛地址",name:"matchaddr",rules:[{required:!0,message:"请填写比赛地址"},{max:40,message:"比赛地址最多40个字"}],children:l.jsx(d,{placeholder:"请输入比赛地址",onChange:e=>{const a=X(e.target.value,40);C.setFieldsValue({matchaddr:a})}})}),l.jsx(o.Item,{label:"报名数量",name:"matchvolume",rules:[{required:!0,message:"请填写报名数量"}],children:l.jsx(h,{min:0,max:999,placeholder:"请输入报名数量"})}),l.jsx(o.Item,{label:"报名开始时间",name:"matchreg",rules:[{required:!0,message:"请选择报名开始时间"}],children:l.jsx(u,{showTime:{defaultValue:r("00:00:00","HH:mm:ss")},format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择报名开始时间"})}),l.jsx(o.Item,{label:"报名截止时间",name:"matchregend",rules:[{required:!0,message:"请选择报名截止时间"},({getFieldValue:e})=>({validator:(a,t)=>!t||r(t).isAfter(e("matchreg"))?Promise.resolve():Promise.reject(new Error("报名截止时间必须大于报名开始时间"))})],children:l.jsx(u,{showTime:{defaultValue:r("00:00:00","HH:mm:ss")},format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择报名截止时间"})}),l.jsx(o.Item,{label:"比赛时间",name:"matchstart",rules:[{required:!0,message:"请选择比赛时间"},({getFieldValue:e})=>({validator:(a,t)=>!t||r(t).isAfter(e("matchregend"))?Promise.resolve():Promise.reject(new Error("比赛时间必须大于报名截止时间"))})],children:l.jsx(u,{showTime:{defaultValue:r("00:00:00","HH:mm:ss")},format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择比赛时间"})}),l.jsx(o.Item,{label:"banner图",name:"matchpicurl",rules:[{required:!0,message:"请上传封面图"}],children:l.jsx(g,{rotationSlider:!0,aspect:16/9,children:l.jsx(f,{action:`${s}/service_api/file_upload`,accept:"image/jpeg, image/png",fileList:O,maxCount:1,beforeUpload:E,onChange:({file:e,fileList:a})=>{if(_(a),"uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");C.setFieldsValue({matchpicurl:e})}},onPreview:W,children:l.jsxs("div",{className:"uploadBox",children:[l.jsx("span",{className:"uploadBtn",children:"点击上传"}),l.jsx("span",{className:"uploadTips",onClick:e=>{e.stopPropagation()},children:"最多可上传1份，大小不超过1mb，格式：jpg/png"})]})})})}),l.jsx(o.Item,{label:"图文详情",name:"matchintrodetail",rules:[{required:!0,message:"请输入图文详情"}],children:l.jsx(p,{theme:"snow",ref:B,value:q,modules:N,placeholder:"请输入图文详情",onChange:(e,a,t,l)=>{var r;let s=null==(r=null==B?void 0:B.current)?void 0:r.getEditor();s.focus();let n=a.ops,u=l.getContents();L(e);const o=s.getSelection();if(o)if(0==o.length&&0!==o.index)T(o.index);else{s.getText(o.index,o.length)}V(t),n&&n.length>0&&u.ops.map((e=>{if(e.insert){let a=e.insert.image;if(a&&(null==a?void 0:a.includes("data:image/"))){let t=i(a);if(t.size>5242880)return m.error("文件过大，上传失败"),e.insert.image="",void s.setContents(u);{let a=new FormData;a.append("file",t),c(a).then((a=>{e.insert.image=a.data[0],s.setContents(u)}))}}}}))}})}),l.jsx(o.Item,{label:"冠军图",name:"matchchampionurl",rules:[{required:!0,message:"请上传冠军图"}],children:l.jsx(g,{rotationSlider:!0,children:l.jsx(f,{action:`${s}/service_api/file_upload`,accept:"image/jpeg, image/png",fileList:U,maxCount:1,beforeUpload:E,onChange:({file:e,fileList:a})=>{if(A(a),"uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");C.setFieldsValue({matchchampionurl:e})}},onPreview:W,children:l.jsxs("div",{className:"uploadBox",children:[l.jsx("span",{className:"uploadBtn",children:"点击上传"}),l.jsx("span",{className:"uploadTips",onClick:e=>{e.stopPropagation()},children:"最多可上传1份，大小不超过1mb，格式：jpg/png"})]})})})}),l.jsx(o.Item,{label:"亚军图",name:"matchrunnerupurl",rules:[{required:!0,message:"请上传亚军图"}],children:l.jsx(g,{rotationSlider:!0,children:l.jsx(f,{action:`${s}/service_api/file_upload`,accept:"image/jpeg, image/png",fileList:R,maxCount:1,beforeUpload:E,onChange:({file:e,fileList:a})=>{if($(a),"uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");C.setFieldsValue({matchrunnerupurl:e})}},onPreview:W,children:l.jsxs("div",{className:"uploadBox",children:[l.jsx("span",{className:"uploadBtn",children:"点击上传"}),l.jsx("span",{className:"uploadTips",onClick:e=>{e.stopPropagation()},children:"最多可上传1份，大小不超过1mb，格式：jpg/png"})]})})})}),l.jsx(o.Item,{label:"季军图",name:"matchsecondrunnerupurl",rules:[{required:!0,message:"请上传季军图"}],children:l.jsx(g,{rotationSlider:!0,children:l.jsx(f,{action:`${s}/service_api/file_upload`,accept:"image/jpeg, image/png",fileList:z,maxCount:1,beforeUpload:E,onChange:({file:e,fileList:a})=>{if(G(a),"uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");C.setFieldsValue({matchsecondrunnerupurl:e})}},onPreview:W,children:l.jsxs("div",{className:"uploadBox",children:[l.jsx("span",{className:"uploadBtn",children:"点击上传"}),l.jsx("span",{className:"uploadTips",onClick:e=>{e.stopPropagation()},children:"最多可上传1份，大小不超过1mb，格式：jpg/png"})]})})})}),l.jsxs(o.Item,{wrapperCol:{offset:5,span:16},children:[l.jsx(n,{type:"primary",className:"submitBtn",onClick:async()=>{try{const e=await C.validateFields();"1"===D?(async e=>{const a={matchname:e.matchname,leagueuuid:e.leagueuuid,level:e.level,matchintro:e.matchintro,matchaddr:e.matchaddr,matchvolume:e.matchvolume,matchreg:e.matchreg.format("YYYY-MM-DD HH:mm:ss"),matchregend:e.matchregend.format("YYYY-MM-DD HH:mm:ss"),matchstart:e.matchstart.format("YYYY-MM-DD HH:mm:ss"),matchpicurl:e.matchpicurl,matchintrodetail:q||S.matchintrodetail,matchchampionurl:e.matchchampionurl,matchrunnerupurl:e.matchrunnerupurl,matchsecondrunnerupurl:e.matchsecondrunnerupurl},t=await j.addMatch(a);200===t.code?(m.success("创建成功"),I("/applet/matchs")):m.error(t.msg)})(e):"2"===D&&(async e=>{const a={uuid:H,matchname:e.matchname||S.matchname,leagueuuid:e.leagueuuid||S.leagueuuid,level:e.level||S.level,matchintro:e.matchintro||S.matchintro,matchaddr:e.matchaddr||S.matchaddr,matchvolume:e.matchvolume||S.matchvolume,matchreg:e.matchreg.format("YYYY-MM-DD HH:mm:ss"),matchregend:e.matchregend.format("YYYY-MM-DD HH:mm:ss"),matchstart:e.matchstart.format("YYYY-MM-DD HH:mm:ss"),matchpicurl:e.matchpicurl||S.matchpicurl,matchintrodetail:q||S.matchintrodetail,matchchampionurl:e.matchchampionurl||S.matchchampionurl,matchrunnerupurl:e.matchrunnerupurl||S.matchrunnerupurl,matchsecondrunnerupurl:e.matchsecondrunnerupurl||S.matchsecondrunnerupurl},t=await j.editMatch(a);200===t.code?(m.success("编辑成功"),I("/applet/matchs")):m.error(t.msg)})(e)}catch(e){}},children:"提交"}),l.jsx(n,{className:"callbackBtn",onClick:()=>I(-1),children:"返回"})]})]})})}export{Y as default};
