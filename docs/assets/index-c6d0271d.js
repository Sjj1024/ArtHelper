import{u as e,d as t,r as a,j as s,B as i,e as r,m as n,h as o}from"./index-efa3a32c.js";import{I as l}from"./index-8c8b720f.js";import{a as p}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as m}from"./index-65748fb5.js";import{D as c}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{a as d}from"./app-4adb5e72.js";import{u}from"./useSetState-78ffd672.js";import{S as j}from"./SearchOutlined-24304577.js";import"./context-cb88fb1e.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./index-1c1deade.js";import"./CheckOutlined-f0d55485.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./responsiveObserve-b13564d4.js";import"./CalendarOutlined-8ff6678f.js";const{RangePicker:x}=c;function h(){document.title="操作日志";const c=e(),h=t((e=>e.app.powersCode)),[g,S]=a.useState([]),[v,f]=a.useState(!1),[N,y]=u({pageNum:1,pageSize:10,total:0}),[k,T]=a.useState(""),[U,C]=u({startTime:"",endTime:"",name:"",content:""}),z=async e=>{const t={page:e.pageNum,limit:e.pageSize,optstartime:U.startTime,optendtime:U.endTime,username:U.name,linktext:U.content};f(!0),T(`${r}/service_api/operation_log_export?optstartime=${U.startTime}&optendtime=${U.endTime}&username=${U.name}&linktext=${U.content}`);try{const a=await d.logList(t);a&&200===a.code?(S(a.data),y({total:a.count,pageNum:e.pageNum,pageSize:e.pageSize})):n.error((null==a?void 0:a.message)??"获取失败")}finally{f(!1)}},[Y,$]=a.useState(""),[D,L]=a.useState(""),O=[{title:"操作时间",dataIndex:"createTime",key:"createTime"},{title:"操作人",dataIndex:"name",key:"name"},{title:"操作URL",dataIndex:"operateUrl",key:"operateUrl"},{title:"接口URL",dataIndex:"apiUrl",key:"apiUrl"},{title:"操作",key:"control",render:(e,t)=>{const a=[];h.includes("log:see")&&a.push(s.jsx("span",{className:"control-btn blue",onClick:()=>{var e;c(`/system/logpage/detail?operate=${null==(e=t)?void 0:e.uuid}`)},children:"查看详情"},"1"));const i=[];return a.forEach(((e,t)=>{t&&i.push(s.jsx(m,{type:"vertical"},`line${t}`)),i.push(e)})),i}}],b=a.useMemo((()=>g.map(((e,t)=>({key:e.id,uuid:e.uuid,userUuid:e.useruuid,createTime:e.opttime,name:e.username,operateUrl:e.opturl,apiUrl:e.opttargetapi,inputstring:e.inputstring,outputstring:e.outputstring})))),[N,g]);return a.useEffect((()=>{z(N)}),[]),s.jsxs("div",{children:[s.jsxs("div",{className:"searchBar",children:[s.jsxs("ul",{className:"searchUl",children:[s.jsxs("li",{className:"searchLi",children:[s.jsx("span",{className:"searchSpan",children:"操作人："}),s.jsx(l,{placeholder:"请输入",onChange:e=>{$(e.target.value),C({...U,name:e.target.value})},value:Y})]}),s.jsxs("li",{className:"searchLi",children:[s.jsx("span",{className:"searchSpan",children:"操作内容："}),s.jsx(l,{placeholder:"请输入",onChange:e=>{L(e.target.value),C({...U,content:e.target.value})},value:D})]}),s.jsxs("li",{className:"searchLi",children:[s.jsx("span",{className:"searchSpan",children:"操作时间："}),s.jsx(x,{onChange:e=>{C(e?{startTime:o(e[0]).format("YYYY-MM-DD"),endTime:o(e[1]).format("YYYY-MM-DD")}:{startTime:void 0,endTime:void 0})}})]})]}),s.jsxs("ul",{className:"searchUl",children:[h.includes("log:search")&&s.jsx("li",{children:s.jsx(i,{type:"primary",icon:s.jsx(j,{}),onClick:()=>{z(N)},children:"搜索"})}),h.includes("log:export")&&s.jsx("li",{style:{marginLeft:"20px"},children:s.jsx("a",{href:k,children:s.jsx(i,{children:"导出"})})})]})]}),s.jsx("div",{className:"diy-table",children:s.jsx(p,{columns:O,loading:v,dataSource:b,pagination:{total:N.total,current:N.pageNum,pageSize:N.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>((e,t)=>{z({pageNum:e,pageSize:t||N.pageSize})})(e,t)}})})]})}export{h as default};
