import{u as e,d as a,r as i,j as r,B as p,m as t,e as s,T as o}from"./index-efa3a32c.js";import{F as l}from"./index-ae2d5997.js";import{I as n}from"./index-8c8b720f.js";import{a as d}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as u}from"./index-65748fb5.js";/* empty css              */import{I as m}from"./index-06b8a89d.js";import{I as c}from"./index-9bf69a37.js";import{D as j}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{h as x}from"./hado-a6960cf0.js";import{u as h}from"./useSetState-78ffd672.js";import{M as g}from"./index-46e73bcd.js";import{S as f}from"./index-1c1deade.js";import{U as y}from"./index-dff1ae8b.js";import{E as v}from"./EditOutlined-e081177a.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./Portal-08554165.js";import"./CalendarOutlined-8ff6678f.js";import"./ActionButton-e012fb99.js";import"./CheckOutlined-f0d55485.js";import"./DeleteOutlined-6b999003.js";function S(){document.title="道具列表",e();const S=a((e=>e.app.powersCode)),[b]=l.useForm(),[w,P]=i.useState([]),[D,T]=i.useState(!1),[N,I]=h({pageNum:1,pageSize:10,total:0}),k=async e=>{const a={page:e.pageNum,limit:e.pageSize};T(!0);try{const i=await x.propList(a);i&&200===i.code?(P(i.data),I({pageNum:e.pageNum,pageSize:e.pageSize,total:i.count})):t.error((null==i?void 0:i.message)??"数据获取失败")}finally{T(!1)}},[C,L]=i.useState([]),[z,q]=h({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[F,O]=i.useState(0),E={propName:"",propType:"",propDescription:"",propPrices:"",propPictures:"",lifespan:0,lifespanDate:""},[A,B]=i.useState(),M=e=>{B(e),((e,a)=>{if(q({modalShow:!0,nowData:e,operateType:a}),e){const a={uid:Date.now(),name:"image.png",status:"done",url:e.picurl};$([a]),b.setFieldsValue({propName:e.propName,propType:e.propType,propDescription:e.propDescription,propPrices:e.propPrices,propPictures:e.propPictures,lifespan:X,lifespanDate:e.lifespanDate})}else b.setFieldsValue({...E})})(e,"edit")},U=()=>{q({modalShow:!1}),b.setFieldsValue({...E}),$([])},[V,$]=i.useState([]),_={accept:".jpg,.png,",action:`${s}/service_api/file_upload`,beforeUpload:e=>{const a=e.size/1024/1024<5;return a||t.error("图片大小不能超过5MB！"),a},onChange({file:e,fileList:a}){e.status,$(a)},fileList:V,maxCount:1},J=[{title:"ID",dataIndex:"id",key:"id"},{title:"道具名称",dataIndex:"propName",key:"propName"},{title:"道具类型",dataIndex:"propType",key:"propType",render:e=>{if(0==e)return"资源"}},{title:"道具描述",dataIndex:"propDescription",key:"propDescription"},{title:"道具价格（元）",dataIndex:"propPrices",key:"propPrices"},{title:"道具图片",dataIndex:"propPictures",key:"propPictures",render:(e,a)=>r.jsx("span",{className:"control-btn blue",onClick:()=>W(a),children:"点击查看"},"1")},{title:"到期时间",dataIndex:"dueTime",key:"dueTime",render:e=>null==e?"永久有效":e},{title:"创建时间",dataIndex:"createTime",key:"creatTime"},{title:"操作",key:"control",width:150,render:(e,a)=>{const i=[];S.includes("propList:edit")&&i.push(r.jsx("span",{className:"control-btn blue",onClick:()=>M(a),children:r.jsx(o,{placement:"top",title:"编辑",children:r.jsx(v,{})})},"1"));const p=[];return i.forEach(((e,a)=>{a&&p.push(r.jsx(u,{type:"vertical"},`line${a}`)),p.push(e)})),p}}],Q=i.useMemo((()=>w.map(((e,a)=>({key:e.id,id:e.id,uuid:e.uuid,propName:e.propname,propType:e.proptype,propDescription:e.propdetail,propPrices:e.propvalue,propPictures:e.propurl,dueTime:e.avaliabledate,createTime:e.addtime,status:e.status})))),[N,w]),[G,H]=i.useState(!1),[K,R]=i.useState(""),W=e=>{H(!0),R(e.propPictures)},[X,Y]=i.useState(0);return i.useEffect((()=>{k(N),(async()=>{const e=(await x.newsPosition({uuid:""})).data.map((e=>({value:e.type,label:e.name})));L(e)})()}),[]),r.jsxs("div",{className:"gameList",children:[r.jsx("div",{className:"diy-table",children:r.jsx(d,{columns:J,loading:D,dataSource:Q,pagination:{total:N.total,current:N.pageNum,pageSize:N.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,a)=>((e,a)=>{k({pageNum:e,pageSize:a||N.pageSize})})(e,a)}})}),r.jsx(g,{title:{add:"新增道具",edit:"编辑道具"}[z.operateType],open:z.modalShow,onOk:async()=>{var e,a,i,r,p,s,o,l,n;try{const u=await b.validateFields();if(q({modalLoading:!0}),"add"==z.operateType)try{const r={uuid:A.uuid,propname:u.propName,proptype:u.propType,propdetail:u.propDescription,propvalue:u.propPrices,propurl:null==(i=null==(a=null==(e=u.propPictures)?void 0:e.file)?void 0:a.response)?void 0:i.data[0],avaliabletype:u.lifespan,avaliabledate:u.lifespanDate},p=await x.addProp(r);p&&200===p.code?(t.success("添加成功"),k(N),U()):t.error((null==p?void 0:p.message)??"操作失败")}finally{q({modalLoading:!1})}else try{const e={uuid:A.uuid,propname:u.propName,proptype:u.propType,propdetail:u.propDescription,propvalue:u.propPrices,propurl:(null==(s=null==(p=null==(r=u.propPictures)?void 0:r.file)?void 0:p.response)?void 0:s.data[0])?null==(n=null==(l=null==(o=u.propPictures)?void 0:o.file)?void 0:l.response)?void 0:n.data[0]:u.propPictures,avaliabletype:u.lifespan,avaliabledate:u.lifespanDate},a=await x.editProp(e);200===(null==a?void 0:a.code)?(t.success("修改成功"),U()):t.error((null==a?void 0:a.message)??"修改失败")}catch(d){}finally{q({modalLoading:!1})}k(N)}catch{t.error("表单校验失败")}},onCancel:U,children:r.jsxs(l,{labelCol:{span:5},wrapperCol:{span:16},form:b,children:[r.jsx(l.Item,{name:"propName",label:"道具名称",rules:[{required:!0,message:"请输入道具名称"}],children:r.jsx(n,{placeholder:"请输入",maxLength:20})}),r.jsx(l.Item,{name:"propType",label:"道具类型",rules:[{required:!0,message:"请选择道具类型"}],children:r.jsx(f,{placeholder:"请选择",allowClear:!0,style:{width:220},options:[{value:0,label:"资源"}]})}),r.jsx(l.Item,{name:"propDescription",label:"道具描述",rules:[{required:!0,message:"请输入道具描述"}],children:r.jsx(n,{placeholder:"请输入",maxLength:200})}),r.jsx(l.Item,{name:"propPrices",label:"道具价格",rules:[{required:!0,message:"请输入道具价格"}],children:r.jsx(m,{placeholder:"请输入",addonAfter:"元"})}),r.jsx(l.Item,{name:"propPictures",label:"道具图片",rules:[{required:!0,message:"请上传道具图片"}],children:r.jsxs(y,{..._,children:[r.jsx(p,{children:"上传文件"}),r.jsx("span",{style:{marginLeft:10},children:"jpg/png，大小不超过5M"})]})}),r.jsx(l.Item,{name:"lifespan",label:"有效期",rules:[{required:!0,message:"请选择有效期"}],children:r.jsx(f,{placeholder:"请选择",allowClear:!0,style:{width:220},options:[{value:0,label:"永久有效"},{value:1,label:"时间有效"}],onChange:e=>Y(e)})}),1==X&&r.jsx(l.Item,{name:"lifespanDate",label:" ",rules:[{required:!0,message:"请选择时间"}],children:r.jsx(j,{onChange:e=>{O(e.target.value)},style:{width:220}})})]})}),r.jsx(c,{style:{display:"none"},src:K,preview:{visible:G,onVisibleChange:e=>{H(e)}}})]})}export{S as default};
