import{u as e,d as s,r as t,j as a,B as i,m as r,h as l,T as o,I as n}from"./index-efa3a32c.js";import{F as d}from"./index-ae2d5997.js";import{I as m}from"./index-8c8b720f.js";import{a as p}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{P as c}from"./index-94ed3db3.js";import{D as u}from"./index-65748fb5.js";import{I as x}from"./index-06b8a89d.js";import{D as j}from"./index-1acfbbfd.js";import{T as h}from"./index-47693ae2.js";import{u as y}from"./user-66ba9e41.js";import{s as g}from"./store-7211fed8.js";import{u as v}from"./useSetState-78ffd672.js";import{S as f}from"./index-1c1deade.js";import{M as S}from"./index-46e73bcd.js";import{D as T}from"./DisconnectOutlined-510bc31e.js";import{C as b}from"./CheckOutlined-4f8ce362.js";import{S as w}from"./SearchOutlined-24304577.js";import{P as C}from"./PlusCircleOutlined-176a31dc.js";import{E as N}from"./EyeOutlined-a014c032.js";import{E as k}from"./EditOutlined-e081177a.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./CalendarOutlined-8ff6678f.js";import"./CheckOutlined-f0d55485.js";import"./Portal-08554165.js";const{TextArea:I}=m,z={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},{RangePicker:O}=j;function D(){document.title="门店列表";const j=e(),D=s((e=>e.app.powersCode));s((e=>e.sys.powerTreeData));const[q]=d.useForm(),[E,P]=t.useState([]),[Y,L]=t.useState(!1),[M,A]=v({pageNum:1,pageSize:10,total:0}),[F,$]=v({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[B,R]=v({title:void 0,storeType:void 0,storeState:1,storeProxy:void 0,startTime:void 0,endTime:void 0});v({treeOnOkLoading:!1,powerTreeShow:!1,powerTreeDefault:{menus:[],powers:[]}});const U=async e=>{if(!D.includes("store:query"))return;const s={page:e.pageNum,limit:e.pageSize,providername:B.title,providerlevel:B.storeType,provideragentuuid:B.storeProxy,status:B.storeState,starttime:B.startTime,endtime:B.endTime};L(!0);try{const t=await g.getStoreList(s);t&&200===t.code?(P(t.data),A({total:t.cont,pageNum:e.pageNum,pageSize:e.pageSize})):r.error((null==t?void 0:t.message)??"获取失败")}finally{L(!1)}},V=(e,s)=>{j("add"===s?"/store/add?store=add":"edit"===s?`/store/edit?store=${null==e?void 0:e.uuid}`:`/store/detail?store=${null==e?void 0:e.uuid}`)},[G,H]=t.useState([]),J=[{label:"全部",value:""},{label:"激活",value:1},{label:"冻结",value:2}],[Q,_]=t.useState([]),[K,W]=t.useState([]),X=[{title:"门店名称",dataIndex:"title",key:"title"},{title:"门店类型",dataIndex:"storeType",key:"storeType"},{title:"门店状态",dataIndex:"storeState",key:"storeState"},{title:"所属代理",dataIndex:"proxy",key:"proxy"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"场地序号",dataIndex:"playId",key:"playId",render:(e,s)=>s.playId.map((e=>a.jsx(h,{color:"green",children:e.stationname},e.uuid)))},{title:"状态说明",dataIndex:"licenseStatus",key:"licenseStatus"},{title:"操作",key:"control",width:200,render:(e,s)=>{const t=[];D.includes("store:see")&&t.push(a.jsx("span",{className:"control-btn blue",onClick:()=>V(s,"see"),children:a.jsx(o,{placement:"top",title:"查看详情",children:a.jsx(N,{})})},"1")),D.includes("store:edit")&&t.push(a.jsx("span",{className:"control-btn blue",onClick:()=>V(s,"edit"),children:a.jsx(o,{placement:"top",title:"编辑",children:a.jsx(k,{})})},"2")),D.includes("store:freeze")&&t.push(a.jsx(c,{title:1===s.status?"确定冻结吗？":"确定启用吗？",onConfirm:()=>(async e=>{L(!0);try{let s=await g.freezeStore({uuid:e.uuid,status:1===e.status?2:1});s&&200===s.code?(r.success("操作成功"),U(M)):r.error((null==s?void 0:s.message)??"操作失败")}finally{L(!1)}})(s),okText:"确定",cancelText:"取消",children:a.jsx("span",{className:"control-btn red",children:a.jsx(o,{placement:"top",title:1===s.status?"冻结":"激活",children:1===s.status?a.jsx(T,{}):a.jsx(b,{style:{color:"green"}})})})},"3")),D.includes("store:up")&&t.push(a.jsx(c,{title:0===s.license?"确定上架吗？":"确定下架吗？",onConfirm:()=>(async e=>{L(!0),g.updateStatus({uuid:e.uuid,venuestatus:0==e.license?1:0}).then((e=>{e&&200===e.code?(r.success("操作成功"),U(M)):r.error((null==e?void 0:e.message)??"操作失败")})).finally((()=>{L(!1)}))})(s),okText:"确定",cancelText:"取消",children:a.jsx("span",{className:"control-btn red",children:a.jsxs(o,{placement:"top",title:"上下架",children:[" ",1==s.license?a.jsx(n,{type:"icon-xiajia"}):a.jsx(n,{type:"icon-a-shangjia2"})]})})},"4"));const i=[];return t.forEach(((e,s)=>{s&&i.push(a.jsx(u,{type:"vertical"},`line${s}`)),i.push(e)})),i}}],Z=t.useMemo((()=>E.map(((e,s)=>{var t,a;return{key:e.id,uuid:e.uuid,serial:s+1+(M.pageNum-1)*M.pageSize,title:e.providername,storeType:e.providerlevel_name,storeId:e.uuid,storeState:1===e.status?"激活":"冻结",proxy:e.agentinfor?null==(t=e.agentinfor)?void 0:t.providername:"-",proxyId:e.agentinfor?e.agentinfor.uuid:"-",createTime:e.addtime,playId:(null==(a=null==e?void 0:e.statuibe)?void 0:a.length)?null==e?void 0:e.statuibe:[],status:e.status,licenseStatus:1===e.venuestatus?"上架":"下架",license:e.venuestatus}}))),[M,E]);return t.useEffect((()=>{U(M),(async()=>{const e=(await g.getStoreType()).data.map((e=>({label:e.name,value:e.id})));H(e)})(),(async()=>{const e=(await y.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));_(e)})()}),[]),a.jsxs("div",{className:"store-list-box",children:[a.jsxs("div",{className:"g-search",children:[D.includes("store:query")?a.jsxs("ul",{className:"search-ul",children:[a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",children:"门店名称:"}),a.jsx(m,{placeholder:"请输门店名称",onChange:e=>{e.target.value.length<20&&R({title:e.target.value})},value:B.title})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",children:"门店类型:"}),a.jsx(f,{placeholder:"请选择类型",allowClear:!0,style:{width:"110px"},onChange:async e=>{R({storeType:e})},value:B.storeType,options:G})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",children:"门店状态:"}),a.jsx(f,{placeholder:"请选择状态",allowClear:!0,style:{width:"110px"},onChange:async e=>{const s=J.find((s=>s.value===e));R({storeState:s.value})},value:B.storeState,options:J})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",style:{width:"60px"},children:"代理:"}),a.jsx(f,{placeholder:"请选择代理",allowClear:!0,style:{width:"110px"},onChange:e=>{R({storeProxy:e})},value:B.storeProxy,options:Q})]}),a.jsxs("li",{className:"search-item",style:{marginLeft:"20px"},children:[a.jsx("span",{className:"item-lable",style:{width:"60px"},children:"创建时间:"}),a.jsx(O,{style:{width:"220px"},onChange:e=>{R(e?{startTime:l(e[0]).format("YYYY-MM-DD"),endTime:l(e[1]).format("YYYY-MM-DD")}:{startTime:void 0,endTime:void 0})}})]}),a.jsx("li",{style:{marginLeft:"20px"},children:a.jsx(i,{type:"primary",icon:a.jsx(w,{}),onClick:()=>{U(M)},children:"搜索"})})]}):a.jsx("div",{}),a.jsx("ul",{className:"search-func",children:D.includes("store:add")&&a.jsx("li",{children:a.jsx(i,{type:"primary",icon:a.jsx(C,{}),disabled:!D.includes("store:add"),onClick:()=>V(null,"add"),children:"新增门店"})})})]}),a.jsx("div",{className:"diy-table",children:a.jsx(p,{columns:X,loading:Y,dataSource:Z,pagination:{total:M.total,current:M.pageNum,pageSize:M.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{U({pageNum:e,pageSize:s||M.pageSize})})(e,s)}})}),a.jsx(S,{title:{add:"新增角色",edit:"编辑角色",see:"查看"}[F.operateType],open:F.modalShow,cancelText:"取消",okText:"确认",onCancel:()=>(q.setFieldsValue({rolename:"",proxy:"",store:"",desc:"",limit:""}),void $({modalShow:!1})),confirmLoading:F.modalLoading,children:a.jsxs(d,{form:q,initialValues:{formConditions:1},children:[a.jsx(d.Item,{label:"角色名称",name:"rolename",...z,rules:[{required:!0,whitespace:!0,message:"请输入角色名称"},{max:20,message:"最多输入20位字符"}],children:a.jsx(m,{placeholder:"请输入角色名",disabled:"see"===F.operateType})}),a.jsx(d.Item,{label:"所属代理",name:"proxy",...z,rules:[{required:!0,message:"请选择所属代理"}],children:a.jsx(f,{disabled:"see"===F.operateType,options:Q,onSelect:async e=>{const s=(await y.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));W(s)},placeholder:"请选择所属代理"})}),a.jsx(d.Item,{label:"所属门店",name:"store",...z,rules:[{required:!0,message:"请选择所属门店"}],children:a.jsx(f,{disabled:"see"===F.operateType,options:K,placeholder:"请选择所属门店"})}),a.jsx(d.Item,{label:"角色描述",name:"desc",...z,rules:[{max:200,message:"最多输入200个字符"},{required:!0,message:"请输入角色描述"}],children:a.jsx(I,{rows:4,disabled:"see"===F.operateType,autoSize:{minRows:2,maxRows:6}})}),a.jsx(d.Item,{label:"数量限制",name:"limit",...z,rules:[{required:!0,message:"请输入数量限制"}],children:a.jsx(x,{min:0,max:99,style:{width:"100%"},disabled:"see"===F.operateType})})]})})]})}export{D as default};
