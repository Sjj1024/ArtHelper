import{r as e,A as s,_ as a,u as t,d as i,j as r,B as n,m as l,T as o,I as d}from"./index-efa3a32c.js";import{a as c}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import{I as p}from"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as m}from"./index-65748fb5.js";import{P as u}from"./index-94ed3db3.js";import{u as h}from"./user-66ba9e41.js";import{s as x}from"./store-7211fed8.js";import{s as j}from"./server-30e87f5b.js";import{u as v}from"./useSetState-78ffd672.js";import{S as y}from"./index-1c1deade.js";import{S as g}from"./SearchOutlined-24304577.js";import{D as w}from"./DisconnectOutlined-510bc31e.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";import"./context-cb88fb1e.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./responsiveObserve-b13564d4.js";import"./ActionButton-e012fb99.js";import"./CheckOutlined-f0d55485.js";const f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};var N=function(t,i){return e.createElement(s,a({},t,{ref:i,icon:f}))};const S=e.forwardRef(N);const k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"};var b=function(t,i){return e.createElement(s,a({},t,{ref:i,icon:k}))};const C=e.forwardRef(b),{Option:z}=y;function I(){document.title="服务管理";const s=t(),a=i((e=>e.app.powersCode)),f=i((e=>e.app.agentOpts)),[N,k]=e.useState([]),[b,I]=e.useState(!1),[O,B]=v({pageNum:1,pageSize:10,total:0}),[E,T]=v({name:void 0,proxy:void 0,store:void 0,cate:void 0,type:void 0}),$=async e=>{const s={page:e.pageNum,limit:e.pageSize,prodname:E.name,provideruuid:E.proxy,storeuuid:E.store,property:E.cate,status:E.type};I(!0);try{const a=await j.getServeList(s);a&&200===a.code?(k(a.data),B({total:a.cont,pageNum:e.pageNum,pageSize:e.pageSize})):l.error((null==a?void 0:a.message)??"获取失败")}finally{I(!1)}},L=(e,a)=>{s("see"===a?`/store/run/server/detail?id=${e.uuid}`:`/store/run/server/edit?id=${e.uuid}&model=2`)},[M,A]=e.useState([]),[D,R]=e.useState([]),H={0:"拼场",2:"活动",3:"课程"},U=[{title:"编号",dataIndex:"key",key:"key"},{title:"分类",dataIndex:"property",key:"property",render:(e,s)=>r.jsx("span",{children:H[s.property]})},{title:"服务名称",dataIndex:"prodname",key:"prodname"},{title:"所属门店",dataIndex:"storename",key:"storename"},{title:"所属代理",dataIndex:"providername",key:"providername"},{title:"所属场地",dataIndex:"stationname",key:"stationname"},{title:"价格",dataIndex:"price",key:"price"},{title:"库存",dataIndex:"currentcap",key:"currentcap",render:(e,s)=>r.jsxs("span",{children:[s.currentcap,"/",s.capacity]})},{title:"状态",dataIndex:"status",key:"status",render:(e,s)=>r.jsx("span",{children:0===s.status?"上架":"下架"})},{title:"服务时间",dataIndex:"showtime",key:"showtime"},{title:"创建时间",dataIndex:"addtime",key:"addtime",render:(e,s)=>r.jsx("span",{children:s.addtime})},{title:"操作",key:"control",width:150,render:(e,s)=>{const t=[];a.includes("server:switch")&&t.push(r.jsx("span",{className:"control-btn blue",onClick:()=>(async(e,s)=>{const a={produuid:s.uuid,status:1===e?0:1},t=await j.switchServe(a);t&&200===t.code&&(l.success("操作成功"),$(O))})(s.status,s),children:r.jsxs(o,{placement:"top",title:"上下架",children:[" ",0===s.status?r.jsx(d,{type:"icon-xiajia"}):r.jsx(d,{type:"icon-a-shangjia2"})]})},"1")),a.includes("server:see")&&t.push(r.jsx("span",{className:"control-btn blue",onClick:()=>L(s,"see"),children:r.jsx(o,{placement:"top",title:"查看",children:r.jsx(C,{})})},"2")),a.includes("server:edit")&&t.push(r.jsx("span",{className:"control-btn blue",onClick:()=>L(s,"up"),children:r.jsx(o,{placement:"top",title:"编辑",children:r.jsx(S,{})})},"3")),a.includes("server:del")&&t.push(r.jsx(u,{title:"确定删除服务吗",onConfirm:()=>(async e=>{if(0===e.status)l.error("删除失败，请先下架服务");else{const s={produuid:e.uuid,status:2},a=await j.switchServe(s);a&&200===a.code?(l.success("操作成功"),$(O)):l.error((null==a?void 0:a.message)??"操作失败")}})(s),okText:"确定",cancelText:"取消",children:r.jsx("span",{className:"control-btn blue",children:r.jsx(w,{})},"4")},5));const i=[];return t.forEach(((e,s)=>{s&&i.push(r.jsx(m,{type:"vertical"},`line${s}`)),i.push(e)})),i}}],q=e.useMemo((()=>N.map(((e,s)=>({key:e.id,uuid:e.uuid,property:e.property,prodname:e.prodname,storename:e.storename,providername:null==e?void 0:e.providername,stationname:null==e?void 0:e.stationname,price:null==e?void 0:e.price,capacity:null==e?void 0:e.capacity,currentcap:null==e?void 0:e.currentcap,showtime:null==e?void 0:e.showtime,addtime:null==e?void 0:e.addtime,status:null==e?void 0:e.status})))),[O,N]);return e.useEffect((()=>{$(O),(async()=>{const e=(await x.getStoreType()).data.map((e=>({label:e.name,value:e.id})));R(e)})()}),[]),r.jsxs("div",{className:"role-box",children:[r.jsxs("div",{className:"g-search",children:[a.includes("server:search")&&r.jsxs("ul",{className:"search-ul",children:[r.jsxs("li",{className:"search-item",children:[r.jsx("span",{className:"item-lable",style:{width:"70px"},children:"服务名称:"}),r.jsx(p,{placeholder:"请输入服务名称",value:E.name,onChange:e=>T({name:e.target.value}),style:{width:"120px"}})]}),r.jsxs("li",{className:"search-item",children:[r.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择代理:"}),r.jsx(y,{placeholder:"请选择代理",allowClear:!0,style:{width:"120px"},onChange:async e=>{T({proxy:e,store:""});const s=(await h.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));A(s)},value:E.proxy,options:f})]}),r.jsxs("li",{className:"search-item",children:[r.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择门店:"}),r.jsx(y,{placeholder:"请选择门店",allowClear:!0,style:{width:"120px"},onChange:e=>{T({store:e})},value:E.store,options:M})]}),r.jsxs("li",{className:"search-item",children:[r.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择分类:"}),r.jsxs(y,{placeholder:"请选择分类",allowClear:!0,style:{width:"120px"},onChange:e=>{T({cate:e})},value:E.cate,children:[r.jsx(z,{value:0,children:"拼场"}),r.jsx(z,{value:2,children:"活动"}),r.jsx(z,{value:3,children:"课程"})]})]}),r.jsxs("li",{className:"search-item",children:[r.jsx("span",{className:"item-lable",style:{width:"70px"},children:"门店类型:"}),r.jsx(y,{placeholder:"请选择门店类型",allowClear:!0,style:{width:"120px"},onChange:async e=>{T({type:e})},options:D,value:E.type})]})]}),r.jsx("ul",{className:"search-func",children:a.includes("server:search")&&r.jsx("li",{children:r.jsx(n,{type:"primary",icon:r.jsx(g,{}),disabled:!a.includes("server:search"),onClick:()=>{$(O)},className:"searchBtn",children:"搜索"})})})]}),r.jsx("div",{className:"secondRow",children:a.includes("server:add")&&r.jsx(n,{type:"primary",disabled:!a.includes("server:add"),onClick:()=>{s("/store/run/server/add")},className:"addBtn",children:"新增服务"})}),r.jsx("div",{className:"diy-table",children:r.jsx(c,{columns:U,loading:b,dataSource:q,pagination:{total:O.total,current:O.pageNum,pageSize:O.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{$({pageNum:e,pageSize:s||O.pageSize})})(e,s)}})})]})}export{I as default};
