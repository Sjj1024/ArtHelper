import{j as e,r as s,u as t,d as a,B as i}from"./index-efa3a32c.js";import{F as r}from"./index-ae2d5997.js";/* empty css              */import{u as o}from"./user-66ba9e41.js";import{s as n}from"./server-30e87f5b.js";import{u as l}from"./useSetState-78ffd672.js";import{S as m}from"./index-1c1deade.js";import{M as p}from"./index-46e73bcd.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./pickAttrs-1cd23dfa.js";import"./statusUtils-b010cbea.js";import"./CheckOutlined-f0d55485.js";import"./SearchOutlined-03c63d28.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./getScrollBarSize-c6833c2b.js";function c(s){const{temp:t,current:a,onClick:i}=s;return e.jsxs("div",{className:a.id===t.id?"serverTemp active":"serverTemp",onClick:()=>{i&&i(s.temp)},children:[e.jsx("img",{src:t.image?t.image:"/assets/serveDef-b4e536de.jpg",alt:"活动图片",className:"tempImg"}),e.jsxs("div",{className:"tempText",children:[e.jsx("span",{className:"title",children:t.name}),e.jsx("span",{className:"time",children:t.time}),e.jsxs("span",{className:"price",children:["¥",t.price]})]})]})}const d=e=>{},u=e=>{};function x(){const[x,j]=s.useState(!1),g=t(),h=a((e=>e.app.agentOpts)),[v,f]=l({proxy:void 0,store:void 0,type:void 0}),[N]=r.useForm(),[y,S]=s.useState([]),[C,b]=l({pageNum:1,pageSize:6,total:0});s.useEffect((()=>{k()}),[C.pageNum]);const k=async()=>{const e=await n.getServeList({page:C.pageNum,limit:C.pageSize,provideruuid:v.proxy,storeuuid:v.store,property:v.type,status:0});if(200===e.code){const s=e.data.map((e=>({id:e.uuid,name:e.prodname,image:e.thumbpic,time:e.showtime,price:e.price})));O(s),b({total:e.cont})}},B=e=>{F(e)},[w,F]=s.useState({uuid:""}),[I,O]=s.useState([]);return e.jsxs("div",{className:"addServe",children:[e.jsxs(r,{name:"basic",form:N,wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},onFinish:d,onFinishFailed:u,autoComplete:"off",children:[e.jsx(r.Item,{label:"所属代理",name:"proxy",rules:[{required:!0,message:"请选择所属代理"}],children:e.jsx(m,{value:v.proxy,onChange:async e=>{f({proxy:e,store:""});const s=(await o.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));S(s)},options:h})}),e.jsx(r.Item,{label:"所属门店",name:"store",rules:[{required:!0,message:"请选择所属门店"}],children:e.jsx(m,{value:v.store,onChange:e=>{f({store:e});y.find((s=>{if(s.value===e)return s}))},options:y})}),e.jsx(r.Item,{label:"服务类型",name:"type",rules:[{required:!0,message:"请选择服务类型"}],children:e.jsx(m,{onChange:e=>{f({type:e})},value:v.type,options:[{value:0,label:"拼场"},{value:2,label:"活动"},{value:3,label:"课程"}]})}),e.jsxs(r.Item,{wrapperCol:{offset:5,span:16},children:[e.jsx(i,{type:"primary",className:"submitBtn",onClick:async()=>{await N.validateFields();k(),j(!0)},children:"一键生成"}),e.jsx(i,{type:"primary",className:"submitBtn",onClick:()=>{const e=h.find((e=>{if(e.value===v.proxy)return e})),s=y.find((e=>{if(e.value===v.store)return e}));localStorage.setItem("creatInfo",JSON.stringify({proxy:e,store:s,type:v.type})),v.proxy&&v.store&&void 0!==v.type&&g("/store/run/server/edit?model=1")},children:"新建"}),e.jsx(i,{className:"submitBtn",onClick:()=>g(-1),children:"返回"})]})]}),e.jsxs(p,{title:"一键生成",open:x,onOk:()=>{w.id&&(j(!1),g(`/store/run/server/edit?model=1&id=${w.id}`))},onCancel:()=>{j(!1)},width:600,children:[e.jsx("div",{className:"tempBox",children:I.map((s=>e.jsx(c,{temp:s,current:w,onClick:B},s.id)))}),e.jsxs("div",{className:"tempFooter",children:[e.jsx(i,{className:"preBtn",onClick:()=>{C.pageNum>1&&b({pageNum:C.pageNum-1})},children:"上一页"}),e.jsxs("div",{className:"pageBox",children:[e.jsx("span",{className:"curPage",children:C.pageNum}),"/",Math.ceil(C.total/C.pageSize)]}),e.jsx(i,{className:"nextBtn",onClick:()=>{C.pageNum<Math.ceil(C.total/C.pageSize)&&b({pageNum:C.pageNum+1})},children:"下一页"})]})]})]})}export{x as default};
