import{d as e,o as a,r as s,j as t,B as n,m as i,l as o}from"./index-efa3a32c.js";import{a as d}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{F as l}from"./index-ae2d5997.js";import{I as r}from"./index-06b8a89d.js";import{h as p}from"./hado-a6960cf0.js";import{u as m}from"./useSetState-78ffd672.js";import{M as u}from"./index-46e73bcd.js";import{S as c}from"./index-1c1deade.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";import"./context-cb88fb1e.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./responsiveObserve-b13564d4.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";function k(){document.title="任务配置";const[k]=l.useForm();e((e=>e.app.powersCode));const[x,h]=a(),[j,g]=s.useState(),[b,f]=s.useState(),[v,y]=s.useState(),[w,S]=s.useState(),[_,N]=s.useState(),[I,F]=s.useState(),[C,O]=s.useState(),[D,T]=s.useState(),A=[{title:"任务名称",dataIndex:"taskname",key:"taskname",render:(e,a)=>t.jsxs(t.Fragment,{children:[a.taskname,"c6d3bv41-v24f-23ef-567e-rfe50b2d6c2d"==a.taskuuid?t.jsxs("span",{children:["：",a.bossname]}):t.jsx(t.Fragment,{})]})},{title:"完成所需次数",dataIndex:"preissueparam",key:"preissueparam"},{title:"奖励道具",dataIndex:"propname",key:"propname"},{title:"奖励数量",dataIndex:"propnum",key:"propnum"},{title:"操作",dataIndex:"control",key:"control",render:(e,a,s)=>t.jsxs(t.Fragment,{children:[t.jsx(n,{type:"link",onClick:()=>L(a,"edit",a.tasktype,a.weekcount,s),children:"编辑"}),"完成全部每周任务"!=a.taskname?t.jsx(n,{type:"link",danger:!0,onClick:()=>M(a,s,a.weekcount),children:"删除"}):t.jsx(t.Fragment,{})]})}],[q,B]=m({operateType:"add",configName:0,nowData:null,modalShow:!1,modalLoading:!1,index:0,itemindex:0}),L=(e,a,s,t,n)=>{B({modalShow:!0,nowData:e,operateType:a,configName:s,index:t,itemindex:n}),e?(k.setFieldsValue({taskname:e.taskname,taskuuid:e.taskuuid,preissueparam:e.preissueparam,propname:e.propname,propuuid:e.propuuid,propnum:e.propnum,bossname:e.bossname,bossuuid:e.bossuuid,tasktype:e.tasktype,weekcount:e.weekcount}),"c6d3bv41-v24f-23ef-567e-rfe50b2d6c2d"==e.taskuuid?z(!0):z(!1)):k.setFieldsValue({...R})},R={taskname:"",taskuuid:"",preissueparam:"",propname:"",propuuid:"",propnum:"",bossname:"",bossuuid:"",tasktype:0,weekcount:0},[V,z]=s.useState(!1),[E,J]=s.useState(0),[P,U]=s.useState(0),M=(e,a,s)=>{if(0==e.tasktype)F(I.filter(((e,s)=>s!==a)));else if(1==e.tasktype){const a=o.cloneDeep(C);a[e.weekcount-1].week_task_data=a[e.weekcount-1].week_task_data.filter(((e,a)=>a!==q.itemindex)),O(a)}else 2==e.tasktype&&T(D.filter(((e,s)=>s!==a)))},G=()=>{B({modalShow:!1}),k.setFieldsValue({}),z(!1)},[H,K]=s.useState(0),[Q,W]=s.useState(0),[X,Y]=s.useState([]),[Z,$]=s.useState([]),[ee,ae]=s.useState([]);return s.useEffect((()=>{p.passTask({season_uuid:x.get("uuid")}).then((e=>{var a,s,t;e&&200===e.code?(g(e.data),f(e.data.taskconfig),y(null==(a=e.data.taskconfig[0])?void 0:a.preissueparam),S(null==(s=e.data.taskconfig[1])?void 0:s.preissueparam),N(null==(t=e.data.taskconfig[2])?void 0:t.preissueparam),F(e.data.season_task),O(e.data.week_task),T(e.data.day_task)):i.error((null==e?void 0:e.message)??"数据获取失败")})),p.taskList({}).then((e=>{if(e&&200===e.code){const a=e.data.map((e=>({label:e.taskname,value:e.uuid})));Y(a)}})),p.propSelect({}).then((e=>{if(e&&200===e.code){const a=e.data.map((e=>({label:e.propname,value:e.uuid})));$(a)}})),p.bossList({}).then((e=>{if(e&&200===e.code){const a=e.data.map((e=>({label:e.bossname,value:e.uuid})));ae(a)}}))}),[]),t.jsxs("div",{style:{width:"65%"},children:[t.jsx("h2",{className:"taskFont",children:"任务配置"}),t.jsxs("div",{className:"taskList",children:[t.jsxs("div",{style:{paddingRight:"30px"},children:[t.jsx("span",{style:{paddingRight:"10px"},children:"黄金通行证经验加成"}),t.jsx(r,{style:{width:"100px"},size:"small",min:0,max:100,step:1,onChange:e=>{if(Number.isInteger(e)){y(e);const a=b.map((a=>"c5c3b820-a252-11ef-9bc0-998b4a2c9b17"===a.taskuuid?{...a,preissueparam:e}:a));f(a)}},value:v,addonAfter:"%"})]}),t.jsxs("div",{style:{paddingRight:"30px"},children:[t.jsx("span",{style:{paddingRight:"10px"},children:"每级继承经验（每级）"}),t.jsx(r,{style:{width:"60px"},size:"small",min:0,max:100,step:1,onChange:e=>{if(Number.isInteger(e)){S(e);const a=b.map((a=>"c5c3b9c0-a252-11ef-8e38-35ba947143ce"===a.taskuuid?{...a,preissueparam:e}:a));f(a)}},value:w})]}),t.jsxs("div",{style:{paddingRight:"30px"},children:[t.jsx("span",{style:{paddingRight:"10px"},children:"特权继承经验（每天）"}),t.jsx(r,{style:{width:"60px"},size:"small",min:0,max:100,step:1,onChange:e=>{if(Number.isInteger(e)){N(e);const a=b.map((a=>"c5c3bb40-a252-11ef-857c-21d60b2d5c2c"==a.taskuuid?{...a,preissueparam:e}:a));f(a)}},value:_})]})]}),t.jsx("h3",{className:"taskFont",children:"赛季任务（最多添加6个）："}),t.jsxs("div",{style:{marginTop:"-30px",textAlign:"right"},children:[t.jsx(n,{type:"primary",onClick:()=>L(null,"add",0),disabled:(null==I?void 0:I.length)>=6,children:"添加任务"}),t.jsx(d,{dataSource:I,columns:A,pagination:!1})]}),t.jsx("h3",{className:"taskFont",children:"每周任务："}),C?C.map(((e,a)=>{var s;return t.jsxs("div",{style:{marginTop:"10px"},children:[t.jsxs("div",{className:"taskFont",children:["第",a+1,"周（最多添加5个） ",e.week_time]}),t.jsxs("div",{style:{marginTop:"-30px",textAlign:"right"},children:[t.jsx(n,{type:"primary",onClick:()=>L(null,"add",1,a),disabled:(null==(s=C[a].week_task_data)?void 0:s.length)>5,children:"添加任务"}),t.jsx(d,{dataSource:C[a].week_task_data,columns:A,pagination:!1})]})]},a)})):t.jsx(t.Fragment,{}),t.jsx("h3",{className:"taskFont",children:"日常任务："}),t.jsxs("div",{style:{marginTop:"-30px",textAlign:"right"},children:[t.jsx(n,{type:"primary",onClick:()=>L(null,"add",2),children:"添加任务"}),t.jsx(d,{dataSource:D,columns:A,pagination:!1})]}),t.jsxs("div",{className:"taskBtn",children:[t.jsx(n,{type:"primary",onClick:()=>{p.addAndEditPassTask({season_uuid:x.get("uuid"),taskconfig:JSON.stringify(b),season_task:JSON.stringify(I),week_task:JSON.stringify(C),day_task:JSON.stringify(D)}).then((e=>{e&&200===e.code?(i.success("保存成功"),window.history.go(-1)):i.error("保存失败")}))},children:"保存"}),t.jsx(n,{style:{marginLeft:"40px"},onClick:()=>{window.history.go(-1)},children:"返回"})]}),t.jsx(u,{title:{add:"添加任务",edit:"编辑任务"}[q.operateType],open:q.modalShow,onOk:async()=>{var e,a,s,t,n,i,d,l;try{const r=await k.validateFields();if(B({modalLoading:!0}),"add"===q.operateType){const n={taskname:r.taskname.label,taskuuid:r.taskname.value,preissueparam:r.preissueparam,propname:r.propname.label,propuuid:r.propname.value,propnum:r.propnum,bossname:(null==(e=r.bossname)?void 0:e.label)?null==(a=r.bossname)?void 0:a.label:"",bossuuid:(null==(s=r.bossname)?void 0:s.value)?null==(t=r.bossname)?void 0:t.value:"",tasktype:0,weekcount:0};if(0==q.configName)F([...I,n]),I.push(n),U(P+1);else if(1==q.configName){n.tasktype=1,n.weekcount=q.index+1;const e=o.cloneDeep(C);e[q.index].week_task_data.push(n),O(e),C[q.index].week_task_data.push(n),J(E+1)}else 2==q.configName&&(n.tasktype=2,n.weekcount=0,T([...D,n]),D.push(n));G()}else{const e={taskname:r.taskname.label?r.taskname.label:r.taskname,taskuuid:r.taskname.value?r.taskname.value:q.nowData.taskuuid,preissueparam:r.preissueparam,propname:r.propname.label?r.propname.label:r.propname,propuuid:r.propname.value?r.propname.value:q.nowData.propuuid,propnum:r.propnum,bossname:(null==(n=r.bossname)?void 0:n.label)?null==(i=r.bossname)?void 0:i.label:r.bossname,bossuuid:(null==(d=r.bossname)?void 0:d.value)?null==(l=r.bossname)?void 0:l.value:q.nowData.bossuuid,tasktype:0,weekcount:0};if(0==q.configName){const a=I.map(((a,s)=>s==q.itemindex?e:a));F(a)}else if(1==q.configName){e.tasktype=1,e.weekcount=q.nowData.weekcount;const a=C.map(((a,s)=>s+1==q.nowData.weekcount?{...a,week_task_data:a.week_task_data.map(((a,s)=>s==q.itemindex?e:a))}:a));O(a)}else if(2==q.configName){e.tasktype=2,e.weekcount=0;const a=D.map(((a,s)=>s==q.itemindex?e:a));T(a)}G()}}finally{"c6d3bv41-v24f-23ef-567e-rfe50b2d6c2d"==q.nowData.taskuuid?z(!0):z(!1)}},onCancel:G,children:t.jsxs(l,{form:k,labelCol:{span:8},children:[t.jsx(l.Item,{name:"taskname",label:"任务名称",rules:[{required:!0,message:"请选择任务名称"}],children:t.jsx(c,{labelInValue:!0,options:X,onChange:e=>{"c6d3bv41-v24f-23ef-567e-rfe50b2d6c2d"==e.value?z(!0):z(!1)}})}),V?t.jsx(l.Item,{name:"bossname",label:"BOSS名称",rules:[{required:!0,message:"请选择BOSS名称"}],children:t.jsx(c,{labelInValue:!0,options:ee})}):t.jsx(t.Fragment,{}),t.jsx(l.Item,{label:"完成所需次数",name:"preissueparam",rules:[{required:!0,message:"请输入完成所需次数"}],children:t.jsx(r,{onChange:e=>{Number.isInteger(e)&&K(e)},step:1,min:0,value:H})}),t.jsx(l.Item,{label:"任务奖励",name:"propname",rules:[{required:!0,message:"请选择任务奖励"}],children:t.jsx(c,{labelInValue:!0,options:Z})}),t.jsx(l.Item,{label:"奖励数量",name:"propnum",rules:[{required:!0,message:"请输入奖励数量"}],children:t.jsx(r,{onChange:e=>{Number.isInteger(e)&&W(e)},step:1,min:0,value:Q})})]})})]})}export{k as default};
