import{u as e,d as t,r as a,j as i,B as s,m as r,h as l,T as o}from"./index-efa3a32c.js";import{F as d}from"./index-ae2d5997.js";import{I as n}from"./index-8c8b720f.js";import{a as u}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as p}from"./index-65748fb5.js";import{D as m}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{u as c}from"./user-66ba9e41.js";import{o as x}from"./order-4f5746de.js";import{q as h}from"./qiang-81fb4cfe.js";import{u as y}from"./useSetState-78ffd672.js";import{S as j}from"./index-1c1deade.js";import{M as v}from"./index-46e73bcd.js";import{S as g}from"./SearchOutlined-24304577.js";import{E as S}from"./EyeOutlined-a014c032.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./CalendarOutlined-8ff6678f.js";import"./CheckOutlined-f0d55485.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";const{RangePicker:f}=m;function w(){document.title="订单列表";const m=e(),w=t((e=>e.app.powersCode)),[b]=d.useForm(),[T,k]=a.useState([]),[C,N]=a.useState(!1),[I,O]=y({pageNum:1,pageSize:10,total:0}),[z,L]=y({operateType:"apply",nowData:null,modalShow:!1,modalLoading:!1}),[Y,D]=y({title:void 0,provideruuid:void 0,storeuuid:void 0,storeType:void 0,storeState:void 0,storeProxy:void 0,startTime:void 0,endTime:void 0,ordersearch:void 0,actualmount:void 0}),E=async e=>{const t={page:e.pageNum,limit:e.pageSize,provideruuid:Y.provideruuid,storeuuid:Y.storeuuid,title:Y.title,property:Y.storeType,status:Y.storeState,starttime:Y.startTime,endtime:Y.endTime,ordersearch:Y.ordersearch,actualmount:Y.actualmount};N(!0);try{const a=await x.OrderList(t);a&&200===a.code?(k(a.data),O({total:a.cont,pageNum:e.pageNum,pageSize:e.pageSize})):r.error((null==a?void 0:a.message)??"获取失败")}finally{N(!1)}},P=[{value:0,label:"拼场"},{value:1,label:"整场"},{value:2,label:"活动"},{value:3,label:"课程"},{value:4,label:"通行证"}],M=e=>{const t=P.find((t=>t.value===e));return t?t.label:""},[F,q]=a.useState([]),[A,$]=a.useState([]),[B,V]=a.useState(""),R=()=>{b.setFieldsValue({rolename:"",proxy:"",store:"",desc:"",limit:"",activityOptions:"",orderStatusOptions:""}),L({modalShow:!1})},U=[{value:0,label:"待付款"},{value:1,label:"已支付"},{value:2,label:"已完成"},{value:3,label:"已取消"},{value:4,label:"已退款"}],H=e=>{const t=U.find((t=>t.value===e));return t?t.label:""},J=[{title:"订单编号",dataIndex:"uuid",key:"uuid"},{title:"类型",dataIndex:"storeType",key:"storeType"},{title:"门店名称",dataIndex:"title",key:"title"},{title:"所属代理",dataIndex:"proxy",key:"proxy"},{title:"项目名称",dataIndex:"name",key:"name"},{title:"时间",dataIndex:"time",key:"time"},{title:"顾客",dataIndex:"user",key:"user"},{title:"顾客手机号",dataIndex:"userTel",key:"userTel"},{title:"订单金额",dataIndex:"actualmount",key:"actualmount"},{title:"订单状态",dataIndex:"storeState",key:"storeState"},{title:"实收金额",dataIndex:"price",key:"price"},{title:"退款金额",dataIndex:"returnPrice",key:"returnPrice"},{title:"订单创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"control",render:(e,t)=>{const a=[];w.includes("order:detail")&&a.push(i.jsx("span",{className:"control-btn blue",onClick:()=>{return e=t,void("detail"==="detail"&&m(`/order/detail?order=${null==e?void 0:e.uuid}`));var e},children:i.jsx(o,{placement:"top",title:"详情",children:i.jsx(S,{})})},"1"));const s=[];return a.forEach(((e,t)=>{t&&s.push(i.jsx(p,{type:"vertical"},`line${t}`)),s.push(e)})),s}}],Q=a.useMemo((()=>T.map(((e,t)=>({key:e.id,uuid:e.uuid,serial:t+1+(I.pageNum-1)*I.pageSize,title:e.storename,storeType:M(e.property),name:e.prodname,time:e.orderpool[0].showtime,proxy:e.providername,createTime:e.addtime,user:e.username,userTel:e.usermob,storeState:H(e.status),price:e.actualmount,actualmount:e.ordermount,returnPrice:e.actualrefund,courtesyname:e.courtesyname,courtesyprice:e.courtesyprice})))),[I,T]),[G,K]=a.useState("");return a.useEffect((()=>{E(I),(async()=>{const e=(await c.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));q(e)})()}),[]),i.jsxs("div",{className:"store-list-box",children:[i.jsx("div",{className:"g-search",children:i.jsxs("ul",{className:"search-ul",children:[i.jsxs("li",{className:"search-item",children:[i.jsxs("span",{className:"item-lable",style:{width:"60px"},children:["选择代理:"," "]}),i.jsx(j,{placeholder:"请选择代理",allowClear:!0,style:{width:"100px"},onChange:async e=>{D({provideruuid:e,storeuuid:void 0});const t=(await c.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));$(t)},value:Y.storeProxy,options:F})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"65px"},children:"门店名称:"}),i.jsx(j,{placeholder:"请选择名称",allowClear:!0,style:{width:"100px"},onChange:e=>{D({storeuuid:e})},value:Y.storeuuid,options:A})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"65px"},children:"选择类型:"}),i.jsx(j,{placeholder:"请选择类型",allowClear:!0,style:{width:"100px"},onChange:e=>{D({storeType:e})},value:Y.storeType,options:P})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"65px"},children:"订单状态:"}),i.jsx(j,{placeholder:"请选择状态",allowClear:!0,style:{width:"90px"},onChange:e=>{D({storeState:e})},value:Y.storeState,options:U,defaultValue:void 0})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"50px"},children:"日期:"}),i.jsx(f,{style:{width:"190px"},onChange:e=>{D(e?{startTime:l(e[0]).format("YYYY-MM-DD"),endTime:l(e[1]).format("YYYY-MM-DD")}:{startTime:void 0,endTime:void 0})}})]}),i.jsx("li",{children:i.jsx(n,{placeholder:"请输入订单号/顾客手机号",onChange:e=>{V(e.target.value),D({...Y,ordersearch:e.target.value})},value:B,style:{width:"190px"}})}),w.includes("order:search")&&i.jsx("li",{children:i.jsx(s,{type:"primary",icon:i.jsx(g,{}),onClick:()=>{E(I)},children:"搜索"})}),w.includes("order:apply")&&i.jsx("li",{children:i.jsx(s,{type:"primary",disabled:!w.includes("order:apply"),onClick:()=>{L({modalShow:!0,nowData:null,operateType:"apply"})},children:"快速核销"})})]})}),i.jsx("div",{className:"diy-table",children:i.jsx(u,{columns:J,loading:C,dataSource:Q,pagination:{total:I.total,current:I.pageNum,pageSize:I.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>((e,t)=>{E({pageNum:e,pageSize:t||I.pageSize})})(e,t)}})}),i.jsxs(v,{open:z.modalShow,footer:null,onCancel:()=>R(),confirmLoading:z.modalLoading,children:[i.jsxs(d,{form:b,initialValues:{formConditions:1},style:{paddingTop:30,display:"flex"},children:[i.jsx(n,{placeholder:"请输入订单编号",onChange:e=>{K(e.target.value)},value:G}),i.jsx(s,{type:"primary",onClick:async()=>{const e={orderuuid:G};L({modalLoading:!0});try{const t=await x.OrderHave(e);if(t&&200===t.code){r.success("订单存在");try{const e={orderuuid:G},t=await x.OrderLeave(e);t&&200===t.code?(r.success("订单核销成功"),R()):r.error((null==t?void 0:t.message)??"订单核销不成功")}finally{L({modalLoading:!1})}}else r.error((null==t?void 0:t.message)??"订单不存在")}finally{L({modalLoading:!1})}},style:{marginLeft:10},children:"搜索"})]}),i.jsx("p",{style:{width:"120px",height:"300px",margin:"auto",padding:"50px 0"},children:i.jsx("img",{src:h,alt:"",style:{width:"100%",height:"100%"}})}),i.jsx("p",{style:{textAlign:"center"},children:"请顾客使用签到码，可使用扫码枪扫码识别"})]})]})}export{w as default};
