import{$ as e,u as s,d as a,r as t,h as i,j as l,B as d,a0 as r,m as n}from"./index-efa3a32c.js";import{D as c}from"./index-1acfbbfd.js";import"./index-47693ae2.js";/* empty css              */import{u as o}from"./user-66ba9e41.js";import{T as u}from"./TextArea-09a4b200.js";import{u as m}from"./useSetState-78ffd672.js";import{S as p}from"./index-1c1deade.js";import{M as h}from"./index-46e73bcd.js";import"./CalendarOutlined-8ff6678f.js";import"./context-cb88fb1e.js";import"./statusUtils-b010cbea.js";import"./index-177532f7.js";import"./pickAttrs-1cd23dfa.js";import"./CheckOutlined-f0d55485.js";import"./SearchOutlined-03c63d28.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./getScrollBarSize-c6833c2b.js";const x={getDataByStore:s=>e({url:"service_api/product_station_time",method:"get",params:s}),getDataByField:s=>e({url:"service_api/product_station_list",method:"get",params:s}),getFieldByStore:s=>e({url:"service_api/statione_select",method:"get",params:s}),upField:s=>e({url:"service_api/station_up",method:"post",data:s}),downField:s=>e({url:"service_api/station_down",method:"post",data:s}),delServe:s=>e({url:"service_api/edit_product_status",method:"post",data:s})};function j(){document.title="运营管理";const e=s(),j=a((e=>e.app.powersCode)),v=a((e=>e.app.agentOpts)),[y,N]=m({proxy:void 0,store:void 0,field:void 0,date:void 0}),[w,g]=t.useState(!0),f=async e=>{N({store:e});const s=(await x.getFieldByStore({provideruuid:e})).data.map((e=>({label:e.stationname,value:e.uuid})));S(s)},[C,S]=t.useState([]),[B,b]=t.useState([]),[k,$]=t.useState(i()),[_,F]=t.useState([]),[D,T]=t.useState({}),[Y,O]=t.useState({}),[A,M]=m({reson:"",desc:""}),[E,H]=t.useState(24),[z,P]=t.useState(!1),[U,q]=t.useState(!1),[G,I]=t.useState([]),J=async()=>{let e;if(e=w?await x.getDataByStore({storeuuid:y.store,time:y.date}):await x.getDataByField({stationuuid:y.field,time:y.date}),200===e.code){const s=e.data;I(s),F([]),T({})}},K=["","周一","周二","周三","周四","周五","周六","周日"];return t.useEffect((()=>{(async()=>{const e=v[0].value,s=await o.getStores({agenuuid:e}),a=s.data.map((e=>({label:e.providername,value:e.uuid})));b(a);const t=s.data[0].uuid;f(t);const l=i().format("YYYY-MM-DD");N({proxy:e,store:t,date:l});const d=await x.getDataByStore({storeuuid:t,time:l});if(200===d.code){const e=d.data;I(e),F([]),T({})}})()}),[]),l.jsxs("div",{className:"runBox",children:[l.jsxs("div",{className:"g-search",children:[j.includes("run:search")&&l.jsxs("ul",{className:"search-ul",children:[l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择代理:"}),l.jsx(p,{placeholder:"请选择代理",allowClear:!0,style:{width:"180px"},onChange:async e=>{N({proxy:e,store:""});const s=(await o.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));b(s)},value:y.proxy,options:v})]}),l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择门店:"}),l.jsx(p,{placeholder:"请选择门店",allowClear:!0,style:{width:"180px"},onChange:f,value:y.store,options:B})]})]}),l.jsxs("ul",{className:"search-func",children:[j.includes("run:search")&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("run:search"),className:"searchBtn",onClick:()=>g(!0),children:"按日期展示"})}),j.includes("run:search")&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("run:search"),className:"addBtn",onClick:()=>g(!1),children:"按场地展示"})})]})]}),l.jsxs("div",{className:"syncSearch",children:[j.includes("run:search")&&l.jsxs("ul",{className:"search-ul",children:[!w&&l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择场地:"}),l.jsx(p,{placeholder:"请选择场地",allowClear:!0,style:{width:"180px"},onChange:async e=>{N({field:e})},value:y.field,options:C})]}),l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择日期:"}),l.jsx(c,{onChange:(e,s)=>{N({date:s}),$(e)},value:k,format:"YYYY-MM-DD"})]}),j.includes("run:search")&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("run:search"),className:"searchBtn",onClick:J,children:"查询"})})]}),l.jsxs("ul",{className:"search-func",children:[j.includes("run:switch")&&3===D.status&&l.jsx("li",{children:l.jsx(d,{type:"primary",className:"addBtn",onClick:async()=>{const e={produuid:D.produuid,status:0},s=await x.upField(e);s&&200===s.code&&(n.success("操作成功"),J())},children:"上架"})}),j.includes("run:switch")&&0===D.status&&"0"!==D.explain&&l.jsxs("li",{children:[l.jsx(d,{type:"primary",className:"addBtn",onClick:()=>{e("/store/run/server/add")},children:"新增服务"}),l.jsx(d,{type:"primary",disabled:!j.includes("run:switch"),className:"addBtn",onClick:()=>{q(!0)},children:"下架"})]}),j.includes("license:search")&&2===D.status&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("license:search"),className:"addBtn",onClick:()=>{e(`/store/run/server/edit?id=${D.produuid}&model=2`)},children:"编辑服务"})}),j.includes("run:del")&&2===D.status&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("run:del"),className:"addBtn",onClick:()=>{P(!0)},children:"删除服务"})}),j.includes("run:detail")&&1===D.status&&l.jsx("li",{children:l.jsx(d,{type:"primary",disabled:!j.includes("run:detail"),className:"addBtn",onClick:()=>{e(`/order/detail?order=${null==D?void 0:D.produuid}`)},children:"查看订单"})})]})]}),l.jsxs("div",{className:"tableBox",children:[l.jsxs("div",{className:"labelBox",children:[l.jsx("div",{className:"labelTxt"}),Array.from({length:E},((e,s)=>l.jsxs("div",{className:"labelTxt",children:[s>9?s:"0"+s,":00"]},s)))]}),l.jsx("div",{className:"dataBox",children:null==G?void 0:G.map(((e,s)=>l.jsxs("div",{className:"playground",children:[l.jsx("div",{className:"Dataheader",children:e.stationname?e.stationname:l.jsxs("div",{className:0===s?"dateHeader red":"dateHeader",children:[l.jsx("div",{className:"week",children:K[e.week]}),l.jsx("div",{className:"date",children:e.time})]})}),e.weekarr.map(((a,t)=>{return l.jsx("div",{className:r(_,[t+1,s+1])?"data active":"data cell",style:{backgroundColor:(i=a.explain,d=a.status,"0"!==i&&0===d?"#baddf4":0===d?"#F7F7F7":1===d?"#EA9092":2===d?"#8EE1B0":3===d?"#FDFDC3":void 0)},onClick:()=>{return i=t+1,l=s+1,n=e,void("0"===(d=a).explain&&0===d.status||(T(d),O(w?n:{stationuuid:y.field,time:n.time}),r(_,[i,l])?F([]):F([i,l])));var i,l,d,n},children:"0"===a.explain&&0===a.status?"无服务":0===a.status&&"0"!==a.explain?"¥"+a.explain:a.explain},t);var i,d}))]},s)))})]}),l.jsx(h,{title:"删除服务",open:z,okText:"确认删除",onOk:async()=>{P(!1);const e=await x.delServe({produuid:D.produuid,status:2});e&&200===e.code?(n.success("操作成功"),J()):n.error(e.msg)},centered:!0,onCancel:()=>{P(!1)},children:l.jsx("div",{children:"服务删除后将无法恢复，是否确认删除该服务！"})}),l.jsx(h,{title:"下架场地",open:U,okText:"确认",onOk:()=>{(async()=>{const e=D.hour-1<10?`0${D.hour-1}:00:00`:D.hour-1+":00:00",s=D.hour<10?`0${D.hour}:00:00`:`${D.hour}:00:00`;let a="",t="";w?(a=`${y.date} ${e}`,t=`${y.date} ${s}`):(a=`${Y.time} ${e}`,t=`${Y.time} ${s}`);const i={provideruuid:y.proxy,storeuuid:y.store,stationuuid:Y.stationuuid,property:A.reson,prodintro:A.desc,regtime:a,offtime:t},l=await x.downField(i);l&&200===l.code&&(n.success("操作成功"),J())})(),q(!1)},centered:!0,onCancel:()=>{q(!1)},children:l.jsxs("div",{className:"downBox",children:[l.jsxs("div",{className:"reson",children:[l.jsx("span",{children:"下架原因"}),l.jsx(p,{style:{width:120},onChange:e=>{M({reson:e})},options:[{value:"94",label:"下架:维护"},{value:"95",label:"下架:占用"},{value:"96",label:"下架:其他"}]})]}),l.jsxs("div",{className:"desc",children:[l.jsx("div",{children:"说明原因(选填)"}),l.jsx(u,{className:"descTxt",onChange:e=>{M({desc:e.target.value})},rows:6,placeholder:"请填写具体原因"})]})]})})]})}export{j as default};
