import{u as e,d as s,r as a,j as t,B as i,m as n,h as l,e as r}from"./index-efa3a32c.js";import{F as o}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as p}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as c}from"./index-65748fb5.js";/* empty css              */import{P as u}from"./index-94ed3db3.js";import{I as m}from"./index-9bf69a37.js";import{D as x}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{h as g}from"./hado-a6960cf0.js";import{u as j}from"./useSetState-78ffd672.js";import{S as h}from"./index-1c1deade.js";import{M as f}from"./index-46e73bcd.js";import{U as v}from"./index-dff1ae8b.js";import{S as y}from"./SearchOutlined-24304577.js";import{P as b}from"./PlusCircleOutlined-176a31dc.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./CalendarOutlined-8ff6678f.js";import"./CheckOutlined-f0d55485.js";import"./DeleteOutlined-6b999003.js";function k(){document.title="通行证管理";const k=e(),S=s((e=>e.app.powersCode)),[C]=o.useForm(),[w,I]=a.useState([]),[N,T]=a.useState(!1),[Y,D]=j({pageNum:1,pageSize:10,total:0}),[F,L]=j({status:void 0}),P=async e=>{const s={page:e.pageNum,limit:e.pageSize,status:F.status};T(!0);try{const a=await g.passList(s);a&&200===a.code?(I(a.data),D({pageNum:e.pageNum,pageSize:e.pageSize,total:a.count})):n.error((null==a?void 0:a.message)??"数据获取失败")}finally{T(!1)}};a.useState();const[M,z]=j({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[O,q]=j({}),_=(e,s)=>{if(z({modalShow:!0,nowData:e,operateType:s}),e){const s={uid:Date.now(),name:e.passconfig.substring(e.passconfig.lastIndexOf("/")+1),status:"done",url:e.passconfig};U([s]);const a={uid:Date.now(),name:e.banner.substring(e.banner.lastIndexOf("/")+1),status:"done",url:e.banner};J([a]);const t={uid:Date.now(),name:e.goods.substring(e.goods.lastIndexOf("/")+1),status:"done",url:e.goods};H([t]),q(e),C.setFieldsValue({passportName:e.passCheck,startTime:l(e.startTime),endTime:l(e.endTime),activatePrice:e.activatePrice,price:e.price,renewalFee:e.renewalFee,store:e.storeUuid.split(","),payee:e.payee,task:e.task,banner:e.banner,goods:e.goods,passconfig:e.passconfig})}else C.setFieldsValue({...$})},$={passportName:"",startTime:"",endTime:"",activatePrice:"",price:"",renewalFee:"",store:[],payee:0,task:"",banner:null,goods:null,passconfig:null},B=()=>{z({modalShow:!1}),C.setFieldsValue({...$}),U([]),J([]),H([])},[E,U]=a.useState([]),V={accept:".csv",action:`${r}/service_api/file_upload`,onChange({file:e,fileList:s}){e.status,U(s)},fileList:E,maxCount:1},[A,J]=a.useState([]),Q={accept:".jpg,.png,",action:`${r}/service_api/file_upload`,onChange({file:e,fileList:s}){e.status,J(s)},fileList:A,maxCount:1},[G,H]=a.useState([]),K={accept:".jpg,.png,",action:`${r}/service_api/file_upload`,onChange({file:e,fileList:s}){e.status,H(s)},fileList:G,maxCount:1},R=[{title:"通行证",dataIndex:"passCheck",key:"passCheck"},{title:"开始时间",dataIndex:"startTime",key:"startTime"},{title:"结束时间",dataIndex:"endTime",key:"endTime"},{title:"状态",dataIndex:"seasonstatus",key:"seasonstatus"},{title:"激活价格",dataIndex:"activatePrice",key:"activatePrice"},{title:"原价",dataIndex:"price",key:"price"},{title:"续费价格",dataIndex:"renewalFee",key:"renewalFee"},{title:"门店",dataIndex:"store",key:"store"},{title:"收款方",dataIndex:"payee",key:"payee",render:e=>0==e?"星荟":1==e?"郑州Arena":void 0},{title:"任务",dataIndex:"task",key:"task",render:e=>0==e?"未配置":"已配置"},{title:"banner",dataIndex:"banner",key:"banner",render:(e,s)=>t.jsx("span",{className:"control-btn blue",onClick:()=>ae(s),children:"点击查看"},"1")},{title:"商品图",dataIndex:"goods",key:"goods",render:(e,s)=>t.jsx("span",{className:"control-btn blue",onClick:()=>re(s),children:"点击查看"},"1")},{title:"操作",key:"control",render:(e,s)=>{const a=[];S.includes("passCheck:edit")&&a.push(t.jsx("span",{className:"control-btn blue",onClick:()=>_(s,"edit"),children:t.jsx(i,{type:"primary",disabled:2==s.status,children:"编辑"})},"passCheck:edit")),S.includes("passCheck:tasklist")&&a.push(t.jsx("span",{className:"control-btn blue",onClick:()=>{k("/applet/passcheck/tasklist?uuid="+s.uuid)},children:t.jsx(i,{type:"primary",disabled:2==s.status,children:"任务配置"})},"passCheck:tasklist")),S.includes("passCheck:del")&&a.push(t.jsx(u,{title:"是否删除该新闻?",onConfirm:()=>(async e=>{try{const s={spassuuid:e.uuid},a=await g.deletePass(s);a&&200===a.code?(n.success("删除成功"),1===w.length&&Y.pageNum>1?P({pageNum:Y.pageNum-1,pageSize:Y.pageSize}):P(Y)):n.error((null==a?void 0:a.message)??"操作失败")}finally{T(!1)}})(s),okText:"确定",cancelText:"取消",children:t.jsx("span",{className:"control-btn red",children:t.jsx(i,{type:"primary",danger:!0,disabled:2==s.status,children:"删除"})})},"passCheck:del"));const l=[];return a.forEach(((e,s)=>{s&&l.push(t.jsx(c,{type:"vertical"},`line${s}`)),l.push(e)})),l}}],W=a.useMemo((()=>w.map(((e,s)=>({key:e.id,uuid:e.uuid,passCheck:e.spassname,startTime:e.starttime,endTime:e.endtime,seasonstatus:e.seasonstatus,status:e.status,activatePrice:e.activeprice,price:e.orignalprice,renewalFee:e.extendingprice,store:e.providernames.join("，"),storeUuid:e.provideruuids.join(","),payee:e.payfor,task:e.status,banner:e.passbannerurl,goods:e.passpicurl,passconfig:e.passconfigurl})))),[Y,w]),[X,Z]=a.useState(!1),[ee,se]=a.useState(""),ae=e=>{Z(!0),se(e.banner)},[te,ie]=a.useState(!1),[ne,le]=a.useState(""),re=e=>{ie(!0),le(e.goods)},[oe,de]=a.useState([]);return a.useEffect((()=>{P(Y),(async()=>{const e=await g.allShopSelect({});e&&200===e.code&&de(e.data.map((e=>({value:e.uuid,label:e.providername}))))})()}),[]),t.jsxs("div",{className:"gameList",children:[S.includes("applet:add")?t.jsxs("div",{className:"btnBox",children:[t.jsxs("div",{className:"btnBoxItem",children:[t.jsxs("div",{children:[t.jsx("span",{className:"item-lable",style:{width:"60px"},children:"状态："}),t.jsx(h,{placeholder:"请选择状态",style:{width:"150px"},onChange:e=>{L({status:e})},allowClear:!0,options:[{value:1,label:"未开始"},{value:2,label:"赛季中"},{value:3,label:"已结束"}]})]}),S.includes("applet:search")&&t.jsx(i,{type:"primary",icon:t.jsx(y,{}),onClick:()=>{P(Y)},className:"btn",children:"查看"})]}),t.jsx("div",{children:t.jsxs(i,{type:"primary",className:"btn",onClick:()=>_(null,"add"),children:[t.jsx(b,{}),"创建通行证"]})})]}):t.jsx(t.Fragment,{}),t.jsx("div",{className:"diy-table",children:t.jsx(p,{columns:R,loading:N,dataSource:W,pagination:{total:Y.total,current:Y.pageNum,pageSize:Y.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{P({pageNum:e,pageSize:s||Y.pageSize})})(e,s)}})}),t.jsx(f,{title:{add:"新增通行证",edit:"编辑通行证"}[M.operateType],open:M.modalShow,onOk:async()=>{var e,s,a,t,i,l,r,o,d,p,c,u,m,x,j,h,f,v,y,b,k,S,w,I,N,T,D;try{const L=await C.validateFields();if(z({modalLoading:!0}),"add"===M.operateType)try{const p={spassname:L.passportName,starttime:L.startTime.format("YYYY-MM-DD"),endtime:L.endTime.format("YYYY-MM-DD"),activeprice:L.activatePrice,orignalprice:L.price,extendingprice:L.renewalFee,provideruuids:L.store.toString(),payfor:L.payee.toString(),passbannerurl:null==(a=null==(s=null==(e=L.banner)?void 0:e.file)?void 0:s.response)?void 0:a.data[0],passpicurl:null==(l=null==(i=null==(t=L.goods)?void 0:t.file)?void 0:i.response)?void 0:l.data[0],detailconfig:null==(d=null==(o=null==(r=L.passconfig)?void 0:r.file)?void 0:o.response)?void 0:d.data[0]},c=await g.addPass(p);c&&200===c.code?(n.success("添加成功"),P(Y),B()):n.error((null==c?void 0:c.message)??"操作失败")}finally{z({modalLoading:!1})}else try{const e={spassuuid:O.uuid,spassname:L.passportName,starttime:L.startTime.format("YYYY-MM-DD"),endtime:L.endTime.format("YYYY-MM-DD"),activeprice:L.activatePrice,orignalprice:L.price,extendingprice:L.renewalFee,provideruuids:L.store.toString(),payfor:L.payee.toString(),passbannerurl:(null==(u=null==(c=null==(p=L.banner)?void 0:p.file)?void 0:c.response)?void 0:u.data[0])?null==(j=null==(x=null==(m=L.banner)?void 0:m.file)?void 0:x.response)?void 0:j.data[0]:L.banner,passpicurl:(null==(v=null==(f=null==(h=L.goods)?void 0:h.file)?void 0:f.response)?void 0:v.data[0])?null==(k=null==(b=null==(y=L.goods)?void 0:y.file)?void 0:b.response)?void 0:k.data[0]:L.goods,detailconfig:(null==(I=null==(w=null==(S=L.passconfig)?void 0:S.file)?void 0:w.response)?void 0:I.data[0])?null==(D=null==(T=null==(N=L.passconfig)?void 0:N.file)?void 0:T.response)?void 0:D.data[0]:L.passconfig},s=await g.editPass(e);200===(null==s?void 0:s.code)?(n.success("修改成功"),B()):n.error((null==s?void 0:s.message)??"修改失败")}catch(F){}finally{z({modalLoading:!1})}P(Y)}catch{}},onCancel:B,okText:"确定",cancelText:"取消",children:t.jsxs(o,{labelCol:{span:8},wrapperCol:{span:16},form:C,children:[t.jsx(o.Item,{name:"passportName",label:"通行证名称",rules:[{required:!0,message:"通行证名称"}],children:t.jsx(d,{placeholder:"请输入"})}),t.jsx(o.Item,{name:"startTime",label:"开始时间",rules:[{required:!0,message:"请选择开始时间"}],children:t.jsx(x,{format:"YYYY-MM-DD"})}),t.jsx(o.Item,{name:"endTime",label:"结束时间",rules:[{required:!0,message:"请选择结束时间"}],children:t.jsx(x,{format:"YYYY-MM-DD"})}),t.jsx(o.Item,{name:"activatePrice",label:"激活价格",rules:[{required:!0,message:"请输入激活价格"}],children:t.jsx(d,{placeholder:"请输入激活价格"})}),t.jsx(o.Item,{name:"price",label:"原价",children:t.jsx(d,{placeholder:"请输入原价"})}),t.jsx(o.Item,{name:"renewalFee",label:"续费价格",children:t.jsx(d,{placeholder:"请输入续费价格"})}),t.jsx(o.Item,{name:"store",label:"门店",rules:[{required:!0,message:"请选择门店"}],children:t.jsx(h,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"请选择",onChange:e=>{},options:oe})}),t.jsx(o.Item,{name:"payee",label:"收款方",rules:[{required:!0,message:"请选择收款方"}],children:t.jsx(h,{style:{width:120},placeholder:"请选择",allowClear:!0,options:[{value:0,label:"星荟"},{value:1,label:"郑州Arena"}]})}),t.jsx(o.Item,{name:"passconfig",label:"通行证配置",rules:[{required:!0,message:"请上传通行证配置"}],children:t.jsxs(v,{...V,children:[t.jsx(i,{children:"上传文件"}),t.jsx("span",{style:{marginLeft:10},children:"（csv文件）"})]})}),t.jsx(o.Item,{name:"banner",label:"通行证banner",rules:[{required:!0,message:"请上传通行证banner"}],children:t.jsxs(v,{...Q,children:[t.jsx(i,{children:"上传文件"}),t.jsx("span",{style:{marginLeft:10},children:"（jpg/png）"})]})}),t.jsx(o.Item,{name:"goods",label:"通行证商品图",rules:[{required:!0,message:"请上传通行证商品图"}],children:t.jsxs(v,{...K,children:[t.jsx(i,{children:"上传文件"}),t.jsx("span",{style:{marginLeft:10},children:"（jpg/png）"})]})})]})}),t.jsx(m,{style:{display:"none"},src:ee,preview:{visible:X,onVisibleChange:e=>{Z(e)}}}),t.jsx(m,{style:{display:"none"},src:ne,preview:{visible:te,onVisibleChange:e=>{ie(e)}}})]})}export{k as default};
