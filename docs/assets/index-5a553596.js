import{o as e,u as l,r as i,j as s,t as n,B as a,h as o,e as t,m as r}from"./index-efa3a32c.js";import{C as d}from"./index-b686cec5.js";import{D as u}from"./index-1acfbbfd.js";import"./index-47693ae2.js";/* empty css              */import{T as m}from"./index-bf31a83e.js";/* empty css              */import{F as c}from"./index-ae2d5997.js";import{I as v}from"./index-8c8b720f.js";import{u as p}from"./user-66ba9e41.js";import{s as j}from"./store-7211fed8.js";import{I as x}from"./antd-img-crop.esm-33921adc.js";import{S as h}from"./index-1c1deade.js";import{U as f}from"./index-dff1ae8b.js";import{U as b}from"./UploadOutlined-030aecab.js";import"./CalendarOutlined-8ff6678f.js";import"./context-cb88fb1e.js";import"./statusUtils-b010cbea.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./index-46e73bcd.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./getScrollBarSize-c6833c2b.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./CheckOutlined-f0d55485.js";import"./useForceUpdate-9ad39bdf.js";import"./DeleteOutlined-6b999003.js";function g(){const[g]=c.useForm(),[y]=c.useForm();let[N,S]=e();const C=N.get("store"),P=l();document.title="add"===C?"新增门店":"编辑门店",document.querySelector("#root > section > section > div > nav > ol > li:nth-child(2) > span.ant-breadcrumb-link").innerHTML="add"===C?"新增门店":"编辑门店";const[F,I]=i.useState([]),[D,w]=i.useState({label:"",value:""}),[L,_]=i.useState({label:"",value:0}),[M,$]=i.useState([]),[Y,k]=i.useState(0),[T,O]=i.useState({label:"",value:""}),[H,q]=i.useState([]),[E,W]=i.useState({label:"",value:""}),[A,U]=i.useState([]),B=async e=>{const l=(await j.getCity({provinceuuid:e})).data.map((e=>({label:e.cityname,value:e.uuid})));U(l)},[V,G]=i.useState({label:"",value:""}),[z,J]=i.useState([]),K=async e=>{const l=(await j.getCounty({cityuuid:e})).data.map((e=>({label:e.countyname,value:e.uuid})));J(l)},R=e=>{},Q=e=>{},[X,Z]=i.useState(),[ee,le]=i.useState([]),ie={accept:".pdf",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){le([...l])},fileList:ee,maxCount:2,multiple:!0},[se,ne]=i.useState([]),ae={accept:"image/*",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){e.status,ne(l)},fileList:se,maxCount:1},[oe,te]=i.useState([]),re={accept:"image/*",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){e.status,te(l)},fileList:oe,maxCount:5,multiple:!0},[de,ue]=i.useState([]),me={accept:"video/*",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){e.status,ue(l)},fileList:de,maxCount:1},[ce,ve]=i.useState([]),pe={accept:"video/*",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){e.status,ve(l)},fileList:ce,maxCount:1},[je,xe]=i.useState(""),[he,fe]=i.useState([]),be={accept:"image/*",action:`${t}/service_api/file_upload`,onChange({file:e,fileList:l}){e.status,fe(l)},fileList:he,maxCount:1};return i.useEffect((()=>{(async()=>{const e=(await p.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));I(e)})(),(async()=>{const e=(await j.getStoreType()).data.map((e=>({label:e.name,value:e.id})));$(e)})(),(async()=>{const e=(await j.getProvince()).data.map((e=>({label:e.provincename,value:e.uuid})));q(e)})(),"add"!==C&&(async()=>{var e,l,i,s,n,a,t,r,d,u,m,c,v,p,x,h,f,b,N,S,P,F,I,D,L,M,$,Y,k,T,H,q,E,A,U,B,V,z,J,K,R,Q,X,ee,ie,se,ae,oe,re,de,me,ce,pe;const je=(await j.getStoreDetail({uuid:C})).data,he=null==(i=null==(l=null==(e=null==je?void 0:je.detileinfor)?void 0:e.comments)?void 0:l.businesstime)?void 0:i.split("-"),be=null==he?void 0:he.map((e=>o(e,"HH:mm"))),ge={storename:null==je?void 0:je.providername,company:null==(n=null==(s=null==je?void 0:je.detileinfor)?void 0:s.comments)?void 0:n.companyname,proxyname:null==(a=null==je?void 0:je.agentinfor)?void 0:a.providername,storetype:null==je?void 0:je.providerlevel_name,storepath:"1",pathDetail:null==(r=null==(t=null==je?void 0:je.detileinfor)?void 0:t.comments)?void 0:r.providaddr,pathDesc:null==(u=null==(d=null==je?void 0:je.detileinfor)?void 0:d.comments)?void 0:u.addrremark,storePhone:null==je?void 0:je.mob,storeTime:be},ye={label:null==je?void 0:je.providerlevel_name,value:null==je?void 0:je.provideragentuuid};w(ye);const Ne={label:null==je?void 0:je.providerlevel_name,value:null==je?void 0:je.providerlevel};_(Ne);const Se=null==(c=null==(m=null==je?void 0:je.detileinfor)?void 0:m.comments)?void 0:c.provincename,Ce=null==(p=null==(v=null==je?void 0:je.detileinfor)?void 0:v.comments)?void 0:p.provinceuuid,Pe=null==(h=null==(x=null==je?void 0:je.detileinfor)?void 0:x.comments)?void 0:h.cityname,Fe=null==(b=null==(f=null==je?void 0:je.detileinfor)?void 0:f.comments)?void 0:b.cityuuid,Ie=null==(S=null==(N=null==je?void 0:je.detileinfor)?void 0:N.comments)?void 0:S.countyname,De=null==(F=null==(P=null==je?void 0:je.detileinfor)?void 0:P.comments)?void 0:F.countyuuid;O({label:Se,value:Ce}),W({label:Pe,value:Fe}),G({label:Ie,value:De});const we={personName:null==(I=null==je?void 0:je.providercontact)?void 0:I.username,personPhone:null==(D=null==je?void 0:je.providercontact)?void 0:D.usermob,personEmail:null==(L=null==je?void 0:je.providercontact)?void 0:L.email,personNum:null==je?void 0:je.providerid},Le=null==($=null==(M=null==je?void 0:je.detileinfor)?void 0:M.contracturl)?void 0:$.contractime;Z(o(Le));const _e=null==(H=null==(T=null==(k=null==(Y=null==je?void 0:je.detileinfor)?void 0:Y.contracturl)?void 0:k.contractimg)?void 0:T.split(","))?void 0:H.map(((e,l)=>({name:`文件${l+1}.pdf`,url:e})));le(_e);const Me=null==(U=null==(A=null==(E=null==(q=null==je?void 0:je.detileinfor)?void 0:q.businesspic)?void 0:E.businessimg)?void 0:A.split(","))?void 0:U.map(((e,l)=>({name:`营业执照${l+1}`,url:e})));ne(Me);const $e=null==(J=null==(z=null==(V=null==(B=null==je?void 0:je.detileinfor)?void 0:B.providerpic)?void 0:V.providerimg)?void 0:z.split(","))?void 0:J.map(((e,l)=>({name:`门店照片${l+1}`,url:e})));te($e);const Ye=null==(X=null==(Q=null==(R=null==(K=null==je?void 0:je.detileinfor)?void 0:K.providerpic)?void 0:R.providerimg)?void 0:Q.split(","))?void 0:X.map(((e,l)=>({name:`免责视频${l+1}`,url:e})));ue(Ye);const ke=null==(ae=null==(se=null==(ie=null==(ee=null==je?void 0:je.detileinfor)?void 0:ee.providerpic)?void 0:ie.sitevido)?void 0:se.split(","))?void 0:ae.map(((e,l)=>({name:`场地视频${l+1}`,url:e})));ve(ke);const Te=null==(re=null==(oe=null==je?void 0:je.detileinfor)?void 0:oe.providerpic)?void 0:re.providercode;xe(Te);const Oe=null==(pe=null==(ce=null==(me=null==(de=null==je?void 0:je.detileinfor)?void 0:de.providerpic)?void 0:me.providerlogo)?void 0:ce.split(","))?void 0:pe.map(((e,l)=>({name:`logo${l+1}`,url:e})));fe(Oe),g.setFieldsValue(ge),y.setFieldsValue(we)})()}),[]),s.jsxs("div",{className:"store-edit",children:[s.jsx("div",{className:"item",children:s.jsx(d,{title:"门店信息",bordered:!0,children:s.jsxs(c,{form:g,name:"storeInfo",wrapperCol:{span:16},onFinish:R,labelAlign:"left",onFinishFailed:Q,autoComplete:"off",children:[s.jsxs("div",{className:"first",children:[s.jsx(c.Item,{label:"门店名称",name:"storename",rules:[{required:!0,message:"请输入门店名称"},()=>({validator:(e,l)=>l&&l.length>=20?Promise.reject("门店名称最长20个字符"):Promise.resolve()})],children:s.jsx(v,{})}),s.jsx(c.Item,{label:"公司名称",name:"company",rules:[{message:"请输入公司名称",max:20}],children:s.jsx(v,{})})]}),s.jsxs("div",{className:"first",children:[s.jsx(c.Item,{label:"门店类型",name:"storetype",rules:[{required:!0,message:"请输入门店类型"}],children:s.jsx(h,{options:M,value:L,onSelect:async e=>{const l=M.find((l=>l.value===e));_(l),k(e)}})}),5!==Y&&s.jsx(c.Item,{label:"所属代理",name:"proxyname",rules:[{required:!0,message:"请输入所属代理"}],children:s.jsx(h,{options:F,value:D,onSelect:async e=>{const l=F.find((l=>l.value===e));w(l)}})})]}),s.jsx("div",{className:"first path",children:s.jsx(c.Item,{label:"门店地址",name:"storepath",rules:[{required:!0,message:"请输入门店地址",validateTrigger:"onChange"}],children:s.jsxs("div",{className:"path-city-field",children:[s.jsx(h,{options:H,value:T,onSelect:async e=>{W("");const l=H.find((l=>l.value===e));O(l),B(e)}}),s.jsx(h,{options:A,value:E,onSelect:async e=>{const l=A.find((l=>l.value===e));G(""),W(l),K(e)}}),s.jsx(h,{value:V,options:z,onSelect:async e=>{const l=z.find((l=>l.value===e));G(l),g.setFieldValue("storepath",e),g.setFields([{name:"storepath",errors:null}])}})]})})}),s.jsx(c.Item,{label:"详细地址",name:"pathDetail",style:{maxWidth:1e3},rules:[{message:"请输入详细地址",max:100}],children:s.jsx(v,{})}),s.jsx(c.Item,{label:"地址描述",name:"pathDesc",style:{maxWidth:1e3},rules:[{message:"请输入地址描述",max:100}],children:s.jsx(v,{})}),s.jsxs("div",{className:"first",children:[s.jsx(c.Item,{label:"门店电话",name:"storePhone",style:{maxWidth:1e3},rules:[()=>({validator:(e,l)=>{const i=l;return i&&!n.checkPhone(i)?Promise.reject("请输入有效的手机号码"):Promise.resolve()}})],children:s.jsx(v,{})}),s.jsx(c.Item,{label:"营业时间",name:"storeTime",style:{maxWidth:1e3},rules:[{type:"array",message:"请选择营业时间!"}],children:s.jsx(m.RangePicker,{format:"HH:mm"})})]})]})})}),s.jsx("div",{className:"item",children:s.jsx(d,{title:"门店负责人信息",bordered:!0,children:s.jsxs(c,{name:"storePerson",form:y,wrapperCol:{span:16},onFinish:R,labelAlign:"right",onFinishFailed:Q,autoComplete:"off",children:[s.jsxs("div",{className:"first",children:[s.jsx(c.Item,{label:"姓名",name:"personName",rules:[{required:!0,message:"请输入姓名",max:20}],children:s.jsx(v,{})}),s.jsx(c.Item,{label:"电话",name:"personPhone",labelCol:{span:4},rules:[()=>({validator:(e,l)=>{const i=l;return i&&!n.checkPhone(i)?Promise.reject("请输入有效的手机号码"):Promise.resolve()}}),{required:!0,message:"请输入电话号"}],children:s.jsx(v,{})})]}),s.jsxs("div",{className:"first",children:[s.jsx(c.Item,{label:"邮箱",name:"personEmail",labelCol:{span:3},style:{maxWidth:1e3},rules:[()=>({validator:(e,l)=>{const i=l;return i&&!n.checkEmail(i)?Promise.reject("请输入有效的邮箱地址"):Promise.resolve()}})],children:s.jsx(v,{})}),s.jsx(c.Item,{label:"身份证号",name:"personNum",labelCol:{span:4},style:{maxWidth:1e3},rules:[()=>({validator:(e,l)=>{const i=l;return i&&!n.checkIdCard(i)?Promise.reject("请输入有效的身份证号"):Promise.resolve()}})],children:s.jsx(v,{})})]})]})})}),s.jsx("div",{className:"item",children:s.jsxs(d,{title:"其他信息",bordered:!0,children:[s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"合同上传："}),s.jsx("div",{className:"file-upload",children:s.jsx(f,{...ie,children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})}),s.jsx("div",{className:"tips",children:"最多可上传2份，大小不超过10M，格式：PDF"})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"合同到期日："}),s.jsx(u,{style:{width:200},placeholder:"请选择合同到期时间",format:"YYYY-MM-DD",value:X,onChange:(e,l)=>{null==e||e.format("YYYY-MM-DD");Z(e)}})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"营业执照："}),s.jsx("div",{className:"file-upload",children:s.jsx(f,{...ae,children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})}),s.jsx("div",{className:"tips",children:"最多可上传1份，大小不超过10M"})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"门店照片："}),s.jsx("div",{className:"file-upload",children:s.jsx(f,{...re,listType:"picture",children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})}),s.jsx("div",{className:"tips",children:"最多可上传5份，大小不超过10M"})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"门店免责视频："}),s.jsx("div",{className:"file-upload",children:s.jsx(f,{...me,children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})}),s.jsx("div",{className:"tips",children:"最多可上传1份，大小不超过10M"})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"场地视频："}),s.jsx("div",{className:"file-upload",children:s.jsx(f,{...pe,children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})}),s.jsx("div",{className:"tips",children:"最多可上传1份，大小不超过10M"})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"商户号："}),s.jsx(v,{style:{width:"200px"},placeholder:"请输入商户号",value:je,onChange:e=>{xe(e.target.value)}})]}),s.jsxs("div",{className:"inline",children:[s.jsx("span",{className:"inline-label",children:"店铺LOGO："}),s.jsx("div",{className:"file-upload",children:s.jsx(x,{children:s.jsx(f,{...be,listType:"picture",children:s.jsx(a,{icon:s.jsx(b,{}),children:"上传文件"})})})}),s.jsx("div",{className:"tips",children:"最多可上传1份，大小不超过10M"})]})]})}),s.jsx("div",{className:"submit-btn",children:s.jsx(a,{type:"primary",onClick:async()=>{try{const e=await g.validateFields(),l=await y.validateFields();let i,s={addrremark:e.pathDesc,businessimg:null==se?void 0:se.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),businesstime:e.storeTime?o(e.storeTime[0]).format("HH:mm")+"-"+o(e.storeTime[1]).format("HH:mm"):"",businessvido:null==de?void 0:de.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),cityname:null==E?void 0:E.label,cityuuid:null==E?void 0:E.value,companyname:e.company,contractime:null==X?void 0:X.format("YYYY-MM-DD"),contractimg:null==ee?void 0:ee.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),countyname:V.label,countyuuid:V.value,email:l.personEmail,mob:l.personPhone,providaddr:e.pathDetail,provideragentuuid:D.value,providercode:je,providerid:l.personNum?l.personNum:"",providerimg:null==oe?void 0:oe.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),providerlevel:L.value,providerlogo:null==he?void 0:he.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),providername:e.storename,provincename:T.label,provinceuuid:T.value,sitevido:null==ce?void 0:ce.map((e=>{var l;return e.response?null==(l=null==e?void 0:e.response)?void 0:l.data[0]:e.url})).join(","),usermob:l.personPhone,username:l.personName};"add"===C?i=await j.saveStore(s):(s.uuid=C,i=await j.updateStore(s)),i&&200===i.code?(r.success("创建成功"),P("/store/list")):r.error((null==i?void 0:i.message)??"操作失败")}catch(e){}},children:"保存"})})]})}export{g as default};
