import{d as e,u as a,r as i,j as t,B as o,e as l,m as n,h as s}from"./index-efa3a32c.js";import{F as r}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as c}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as u}from"./index-65748fb5.js";import{P as p}from"./index-94ed3db3.js";/* empty css              */import{a as m}from"./v1api-f78cc73a.js";import{u as g}from"./useSetState-78ffd672.js";import{S as h}from"./index-1c1deade.js";import{M as x}from"./index-46e73bcd.js";import{U as j}from"./index-dff1ae8b.js";import{S as v}from"./SearchOutlined-24304577.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./CheckOutlined-f0d55485.js";import"./Portal-08554165.js";import"./DeleteOutlined-6b999003.js";function f(){document.title="俱乐部管理";const f=e((e=>e.app.powersCode)),y=a(),[b]=r.useForm(),[w,S]=i.useState([]),[I,k]=i.useState(!1),[L,N]=g({pageNum:1,pageSize:10,total:0}),[C,F]=g({legionname:void 0,id:void 0,contactinfor:void 0,provideruuid:void 0}),O={clubname:"",contactinfor:"",provideruuid:"",legionboard:"",legionheadurl:""},[T,z]=i.useState([]),[D,B]=g({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),P=async e=>{const a={page:e.pageNum,limit:e.pageSize,legionname:C.legionname,id:C.id,contactinfor:C.contactinfor,provideruuid:C.provideruuid};k(!0);try{const i=await m.clubList(a);i&&200===i.code?(S(i.data),N({pageNum:e.pageNum,pageSize:e.pageSize,total:i.count})):n.error((null==i?void 0:i.message)??"数据获取失败")}finally{k(!1)}},[V,_]=i.useState([]),E=[{title:"ID",dataIndex:"id",key:"id"},{title:"俱乐部名称",dataIndex:"legionname",key:"legionname"},{title:"联系方式",dataIndex:"contactinfor",key:"contactinfor",render:e=>e&&11===e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):e},{title:"俱乐部公告",dataIndex:"legionboard",key:"legionboard"},{title:"俱乐部人数",dataIndex:"member_count",key:"member_count"},{title:"俱乐部主场名称",dataIndex:"providname",key:"providname"},{title:"队长名称",dataIndex:"captain",key:"captain"},{title:"联赛积分",dataIndex:"leaguepoints",key:"leaguepoints"},{title:"活力值",dataIndex:"activefactor",key:"activefactor"},{title:"俱乐部等级",dataIndex:"level",key:"level"},{title:"挑战分",dataIndex:"challengepoints",key:"challengepoints"},{title:"状态",dataIndex:"status",key:"status",render:e=>0===e?"正常":"解散"},{title:"创建时间",dataIndex:"addtime",key:"addtime",render:e=>s(e).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"control",fixed:"right",width:200,render:(e,a)=>{const i=[];f.includes("club:edit")&&i.push(t.jsx("span",{style:{color:"#1890ff",cursor:"pointer"},onClick:()=>q(a),children:"编辑"},"1")),f.includes("club:seeScore")&&i.push(t.jsx("span",{style:{color:"#1890ff",cursor:"pointer"},onClick:()=>M(a),children:"查看积分"},"2")),f.includes("club:dissolve")&&i.push(t.jsx(p,{title:0===a.status?"确定解散该俱乐部吗？":"该俱乐部已解散，确定恢复吗？",onConfirm:()=>U(a),okText:"确定",cancelText:"取消",children:t.jsx("span",{style:{color:"#1890ff",cursor:"pointer"},children:0===a.status?"解散":"恢复"})},"3"));const o=[];return i.forEach(((e,a)=>{a&&o.push(t.jsx(u,{type:"vertical"},`line${a}`)),o.push(e)})),o}}],$=i.useMemo((()=>w.map(((e,a)=>({key:a,id:e.id,uuid:e.uuid,legionname:e.legionname,contactinfor:e.contactinfor,legionboard:e.legionboard,member_count:e.member_count,providname:e.providname,provideruuid:e.provideruuid,legionheadurl:e.legionheadurl,captain:e.captain,leaguepoints:e.leaguepoints,activefactor:e.activefactor,level:e.level,challengepoints:e.challengepoints,status:e.status,addtime:e.addtime})))),[w]),q=e=>{z([]),B({operateType:"edit",nowData:e,modalShow:!0,modalLoading:!1}),b.setFieldsValue({clubname:e.legionname,contactinfor:e.contactinfor,provideruuid:e.provideruuid,legionboard:e.legionboard,legionheadurl:e.legionheadurl}),z([{uid:"1",name:e.legionheadurl,status:"done",url:e.legionheadurl}])},M=e=>{y(`/applet/clubs/points?clubId=${e.uuid}`)},U=async e=>{let a;a=0===e.status?await m.disbandClub({uuid:e.uuid}):await m.restoreClub({uuid:e.uuid}),a&&200===a.code?(n.success(0===e.status?"解散成功":"恢复成功"),P(L)):n.error((null==a?void 0:a.message)??"操作失败")};return i.useEffect((()=>{P(L),(async()=>{const e=await m.clubShopList({});e&&200===e.code&&_(e.data.map((e=>({label:e.Providername,value:e.Provideruuid}))))})()}),[]),t.jsxs("div",{className:"clubList",children:[t.jsxs("div",{className:"searchBox",children:[t.jsxs("div",{className:"searchBoxItem",children:[t.jsxs("div",{children:[t.jsx("span",{className:"item-label",children:"俱乐部名称："}),t.jsx(d,{placeholder:"请输入",style:{width:"150px"},value:C.legionname,onChange:e=>F({legionname:e.target.value})})]}),t.jsxs("div",{style:{marginLeft:30},children:[t.jsx("span",{className:"item-label",children:"ID："}),t.jsx(d,{placeholder:"请输入数字",style:{width:"150px"},value:C.id,onChange:e=>{const a=e.target.value.replace(/[^0-9]/g,"");F({id:a})}})]}),t.jsxs("div",{style:{marginLeft:30},children:[t.jsx("span",{className:"item-label",children:"联系方式："}),t.jsx(d,{placeholder:"请输入",maxLength:11,style:{width:"150px"},value:C.contactinfor,onChange:e=>{const a=e.target.value.replace(/[^0-9]/g,"");F({contactinfor:a})}})]}),t.jsxs("div",{style:{marginLeft:30},children:[t.jsx("span",{className:"item-label",children:"主场："}),t.jsx(h,{placeholder:"请选择",style:{width:"150px"},value:C.provideruuid,onChange:e=>F({provideruuid:e}),options:V})]})]}),t.jsx("div",{children:t.jsx(o,{type:"primary",icon:t.jsx(v,{}),onClick:()=>{P(L)},className:"searchBtn",children:"搜索"})})]}),t.jsx("div",{className:"diy-table",children:t.jsx(c,{columns:E,loading:I,dataSource:$,scroll:{x:"max-content"},pagination:{total:L.total,current:L.pageNum,pageSize:L.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,a)=>((e,a)=>{P({pageNum:e,pageSize:a||L.pageSize})})(e,a)}})}),t.jsx(x,{title:{edit:"编辑俱乐部"}[D.operateType],open:D.modalShow,cancelText:"取消",okText:"确认",onOk:async()=>{var e;B({modalLoading:!0});const a={contactinfor:b.getFieldValue("contactinfor"),legionboard:b.getFieldValue("legionboard"),legionheadurl:b.getFieldValue("legionheadurl"),legionname:b.getFieldValue("clubname"),provideruuid:b.getFieldValue("provideruuid"),uuid:null==(e=D.nowData)?void 0:e.uuid};try{const e=await m.editClub(a);e&&200===e.code?(n.success("编辑成功"),B({modalShow:!1,modalLoading:!1}),P(L)):n.error((null==e?void 0:e.message)??"编辑失败")}catch(i){n.error("编辑失败，请重试")}finally{B({modalLoading:!1})}},onCancel:()=>(b.setFieldsValue({...O}),void B({modalShow:!1})),confirmLoading:D.modalLoading,children:t.jsxs(r,{form:b,labelCol:{span:6},children:[t.jsx(r.Item,{label:"俱乐部名称",name:"clubname",rules:[{required:!0,whitespace:!0,message:"请输入俱乐部名称"},{validator:(e,a)=>{if(a){if(a.split("").reduce(((e,a)=>e+(a.match(/[\u4e00-\u9fa5]/)?2:1)),0)>14)return Promise.reject("俱乐部名称最多输入14个字符（中文算2个字符，英文或数字算1个字符）")}return Promise.resolve()}}],children:t.jsx(d,{style:{width:"300px"},placeholder:"请输入",onChange:e=>{const a=e.target.value;if(a.split("").reduce(((e,a)=>e+(a.match(/[\u4e00-\u9fa5]/)?2:1)),0)>14){let e="",i=0;for(const t of a){const a=t.match(/[\u4e00-\u9fa5]/)?2:1;if(i+a>14)break;e+=t,i+=a}b.setFieldsValue({clubname:e})}}})}),t.jsx(r.Item,{name:"contactinfor",label:"联系方式",rules:[{required:!0,message:"请输入联系方式"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码"}],children:t.jsx(d,{style:{width:"300px"},placeholder:"请输入"})}),t.jsx(r.Item,{label:"主场",name:"provideruuid",rules:[{required:!0,message:"请选择主场"}],children:t.jsx(h,{style:{width:"300px"},placeholder:"请选择",options:V})}),t.jsx(r.Item,{label:"俱乐部公告",name:"legionboard",rules:[{required:!0,message:"请输入俱乐部公告"}],children:t.jsx(d.TextArea,{style:{width:"300px"},placeholder:"请输入"})}),t.jsx(r.Item,{label:"俱乐部LOGO",name:"matchchampionurl",rules:[{required:!0,message:"请上传俱乐部LOGO"}],children:t.jsx(j,{action:`${l}/service_api/file_upload`,accept:"image/jpeg, image/png",fileList:T,maxCount:1,beforeUpload:e=>{if(e.size>1048576)return n.error("图片尺寸不符合要求，请重新上传"),j.LIST_IGNORE;const a="image/png"===e.type||"image/jpeg"===e.type||"image/bmp"===e.type;return a||j.LIST_IGNORE},onChange:({file:e,fileList:a})=>{if(z(a),"uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");b.setFieldsValue({legionheadurl:e})}},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const i=new FileReader;i.readAsDataURL(e.originFileObj),i.onload=()=>a(i.result)})));const i=new Image;i.src=a;const t=window.open(a);null==t||t.document.write(i.outerHTML)},children:t.jsxs("div",{className:"uploadBox",children:[t.jsx("span",{className:"uploadBtn",children:"点击上传"}),t.jsx("span",{className:"uploadTips",onClick:e=>{e.stopPropagation()},children:"jpg/png，大小不超过1MB"})]})})})]})})]})}export{f as default};
