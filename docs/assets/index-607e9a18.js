import{u as e,o as t,d as a,r as s,j as i,B as o,m as n,e as l,bM as r}from"./index-efa3a32c.js";import{F as d}from"./index-ae2d5997.js";import{I as c}from"./index-8c8b720f.js";import{a as m}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as p}from"./index-65748fb5.js";import{P as u}from"./index-94ed3db3.js";/* empty css              */import{h as A}from"./hado-a6960cf0.js";import{u as g}from"./useSetState-78ffd672.js";import{M as f}from"./index-46e73bcd.js";import{U as x}from"./index-dff1ae8b.js";import{U as h}from"./UploadOutlined-030aecab.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./index-1c1deade.js";import"./CheckOutlined-f0d55485.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./Portal-08554165.js";import"./DeleteOutlined-6b999003.js";const j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAANVJREFUKFNjZCASMPLz86cwMjLGMTAw7MOhx+n///+LGBkYGBgFBAR2cXFx+T979uwbsmIpKSmub9++bfzw4YMbSCEDHx+fGTMzc/D79+/LkRUKCgp2/v37d+2nT59OgRWCgICAwDxGRsaG9+/fPwLxBQUF5f7//9/w4cOHJBAfrlBERETy79+//e/fv4+AKlzBzMxc+ObNm+coCkEcfn5+kNXnoJYYffz4sRNmI9xEqACbgIDAGhD7w4cPIQwMDL9wKQS5zRsk+f79+63IHkM3EWfwAwAFSkOd6BJM9AAAAABJRU5ErkJggg==",y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAJpJREFUKFON0DsOwjAMBuA/kdjt7Ews3IJyDEbKMWCEY9CVY1BuwcLEHmevlNBUSQWIAJn8+GRbUURE+OMpIloDaH7YWkVARGcAVQG3zrllhosetgVY9fAywDT1CKB+w41zbhNrIzTGTL33NwCThDut9cxae3+BMWHmbQhhPzSU2onIIW8YJ+YCM19jLCLz5zM+wVWCp6+w9J8P0AAp3PN+ijYAAAAASUVORK5CYII=",{TextArea:w}=c;function S(){document.title="游戏配置";const c=e();let[S,N]=t();const C=S.get("id"),b=S.get("title"),k=a((e=>e.app.powersCode)),[I]=d.useForm(),[z,T]=s.useState([]),[U,v]=s.useState(!1),[E,M]=s.useState(1),[L,O]=s.useState(0),[R,B]=g({pageNum:1,pageSize:10,total:0}),[D,F]=g({operateType:"up",nowData:null,modalShow:!1,modalLoading:!1});document.querySelector("#root > section > section > div > nav > ol > li:nth-child(2) > span.ant-breadcrumb-link").innerHTML=b;const Y={fileUp:[],fileInfo:""},G=()=>{F({modalShow:!1}),I.setFieldsValue({...Y}),Q([])},J=async(e,t,a)=>{const s={page:e.pageNum,limit:e.pageSize,filetype:C,addtimesort:t,updatedsort:a};v(!0);try{const t=await A.editConfig(s);t&&200===t.code?(T(t.data),B({total:t.cont,pageNum:e.pageNum,pageSize:e.pageSize})):n.error((null==t?void 0:t.message)??"获取失败")}finally{v(!1)}},K=[{title:"编号",dataIndex:"serial",key:"serial"},{title:"文件名",dataIndex:"fileName",key:"fileName",render:(e,t)=>i.jsxs(i.Fragment,{children:[t.fileName,1==t.status?i.jsx("span",{style:{color:"red",paddingLeft:"5px"},children:"(最新同步)"}):i.jsx(i.Fragment,{})]})},{title:"文件描述",dataIndex:"tableDesc",key:"tableDesc"},{title:i.jsxs("div",{onClick:()=>{M((e=>e?0:1))},children:["创建时间",i.jsx("img",{src:E?y:j,alt:"",style:{marginLeft:"5px"}})]}),dataIndex:"createTime",key:"createTime"},{title:i.jsxs("div",{onClick:()=>{O((e=>e?0:1))},children:["同步时间",i.jsx("img",{src:L?y:j,alt:"",style:{marginLeft:"5px"}})]}),dataIndex:"syncTime",key:"syncTime"},{title:"操作",key:"control",width:200,render:(e,t)=>{const a=[];k.includes("hado:sync")&&a.push(i.jsx("span",{className:"control-btn blue",onClick:()=>(async e=>{v(!0);try{const t=await A.syncConfig({id:e.key});t&&200===t.code?(n.success("同步成功"),J(R,E,L)):n.error("校验失败，无法完成同步")}finally{v(!1)}})(t),children:"同步"},"1")),k.includes("hado:download")&&a.push(i.jsx("span",{children:i.jsx("a",{href:t.url,download:t.fileName,className:"control-btn blue",children:"下载CSV"})},"2")),k.includes("hado:del")&&a.push(i.jsx(u,{title:"确定删除吗？",onConfirm:()=>(async e=>{v(!0);try{const t=await A.deleteConfig({id:e.key});t&&200===t.code?(n.success("删除成功"),1===z.length&&R.pageNum>1?J({pageNum:R.pageNum-1,pageSize:R.pageSize},E,L):J(R,E,L)):n.error((null==t?void 0:t.message)??"操作失败")}finally{v(!1)}})(t),okText:"确定",cancelText:"取消",children:i.jsx("span",{className:"control-btn blue",children:"删除"})},"3"));const s=[];return a.forEach(((e,t)=>{t&&s.push(i.jsx(p,{type:"vertical"},`line${t}`)),s.push(e)})),s}}],V=s.useMemo((()=>z.map(((e,t)=>({key:e.id,uuid:e.useruuid,serial:t+1+(R.pageNum-1)*R.pageSize,fileName:e.filename,tableDesc:e.filedescription,createTime:e.addtime,syncTime:e.updated,status:e.status,url:e.filelocation})))),[R,z]),[P,Q]=s.useState([]),W={accept:".csv",action:l+"/service_api/hadoworld_upload_file",onRemove:e=>{const t=P.indexOf(e),a=P.slice();a.splice(t,1),Q(a)},beforeUpload:e=>(Q([...P,e]),!1),fileList:P,maxCount:1};return s.useEffect((()=>{1===E&&O(0)}),[E]),s.useEffect((()=>{1===L&&M(0)}),[L]),s.useEffect((()=>{J(R,E,L)}),[E,L]),i.jsxs("div",{className:"gameList",children:[i.jsxs("div",{className:"btnBox",children:[k.includes("hado:upload")?i.jsx(o,{type:"primary",ghost:!0,className:"btn",onClick:()=>{F({modalShow:!0,nowData:null,operateType:"up"})},children:"上传文件"}):i.jsx(i.Fragment,{}),i.jsx(o,{type:"primary",ghost:!0,className:"btn",onClick:()=>{c("/game/list")},children:"返回上级"})]}),i.jsx("div",{className:"diy-table",children:i.jsx(m,{columns:K,loading:U,dataSource:V,pagination:{total:R.total,current:R.pageNum,pageSize:R.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>((e,t)=>{J({pageNum:e,pageSize:t||R.pageSize},E,L)})(e,t)}})}),i.jsx(f,{title:"上传文件",open:D.modalShow,onOk:async()=>{try{const e=await I.validateFields();if(F({modalLoading:!0}),"up"===D.operateType)try{const t=P[0],a=await(e=>new Promise(((t,a)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(s.result),s.onerror=e=>a(e)})))(t),s=((e,t)=>{const a=e.split(","),s=a[0].match(/:(.*?);/)[1],i=atob(a[1]),o=i.length,n=new Uint8Array(o);for(let c=0;c<o;c++)n[c]=i.charCodeAt(c);const l=t.lastIndexOf("."),r=t.slice(0,l),d=t.slice(l+1);return new File([n],`${r}.${d}`,{type:s})})(a,t.name);let i=new FormData;i.append("file",s),i.append("filetype",C),i.append("filedescription",e.fileInfo),(e=>{var t={method:"post",url:l+"/service_api/hadoworld_upload_file",headers:{Authorization:localStorage.getItem("token")},data:e};return r(t)})(i).then((e=>{const t=e.data;t&&200===t.code?(n.success("添加成功"),J(R,E,L),G()):n.error((null==t?void 0:t.msg)??"获取失败")})).catch((e=>(n.error(e.message),Promise.reject(e))))}finally{F({modalLoading:!1})}J(R,E,L)}catch{}},onCancel:G,okText:"上传",children:i.jsxs(d,{form:I,children:[i.jsx(d.Item,{name:"fileUp",label:"上传文件",rules:[{required:!0,message:"请上传配置文件"}],children:i.jsx(x,{...W,children:0===P.length?i.jsx(o,{icon:i.jsx(h,{}),children:"上传文件"}):null})}),i.jsx(d.Item,{name:"fileInfo",label:"文件描述",rules:[{required:!0,message:"请输入文件描述"}],children:i.jsx(w,{})})]})})]})}export{S as default};
