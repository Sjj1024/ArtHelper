import{d as e,u as a,r as t,j as i,B as l,e as n,m as s,a_ as d}from"./index-efa3a32c.js";import{F as o}from"./index-ae2d5997.js";import{a as r}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as c}from"./index-65748fb5.js";/* empty css              */import{I as m}from"./index-9bf69a37.js";import{a as u}from"./v1api-f78cc73a.js";import{u as p}from"./useSetState-78ffd672.js";import{M as h}from"./index-46e73bcd.js";import{S as x}from"./index-1c1deade.js";import{U as g}from"./index-dff1ae8b.js";import{P as j}from"./PlusCircleOutlined-176a31dc.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./Portal-08554165.js";import"./ActionButton-e012fb99.js";import"./CheckOutlined-f0d55485.js";import"./DeleteOutlined-6b999003.js";function y(){document.title="比赛列表";const y=e((e=>e.app.powersCode)),v=a(),[f]=o.useForm(),[k,S]=t.useState([]),[w,I]=t.useState(!1),[b,C]=p({pageNum:1,pageSize:10,total:0}),[L,T]=p({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),z={leagueName:"",pointType:void 0,count:0,startTime:"",endTime:""},N=[{key:"1",label:y.includes("match:del")?i.jsx("span",{style:{color:"#1890ff"},children:"删除"}):null}],[O,F]=t.useState([]),P={accept:".csv,",action:`${n}/service_api/file_upload`,onChange({file:e,fileList:a}){F(a),"done"===e.status?f.setFieldsValue({pointType:a[0]}):"error"===e.status&&(F([]),s.error("文件上传失败"))},fileList:O,maxCount:1},U=(e,a)=>{"add"===a?v("/applet/match/edit?model=1"):"edit"===a?v(`/applet/match/edit?model=2&id=${e.uuid}`):"see"===a&&v(`/applet/match/signup?matchuuid=${e.uuid}`)},D=()=>{f.setFieldsValue({...z}),T({modalShow:!1})},$=async e=>{const a={page:e.pageNum,limit:e.pageSize};I(!0);try{const t=await u.matchList(a);t&&200===t.code?(S(t.data),C({total:t.count,pageNum:e.pageNum,pageSize:e.pageSize})):s.error((null==t?void 0:t.message)??"获取失败")}finally{I(!1)}},[B,E]=t.useState([]),M=async e=>{const a=await u.matchSignList({matchuuid:e});if(a&&200===a.code){const e=a.data.map((e=>({label:e.legionname,value:e.legionuuid})));E(e)}},V=async e=>{var a,t,i;const l=await u.matchHistoryList({uuid:e});if(l&&200===l.code){const e=l.data.champions.map((e=>({label:e.legionname,value:e.legionuuid}))),n=l.data.runnerUps.map((e=>({label:e.legionname,value:e.legionuuid}))),s=l.data.thirdPlaces.map((e=>({label:e.legionname,value:e.legionuuid})));f.setFieldsValue({champion:null==(a=e[0])?void 0:a.value,runnerUp:null==(t=n[0])?void 0:t.value,thirdPlace:null==(i=s[0])?void 0:i.value})}},A=[{title:"ID",dataIndex:"id",key:"id"},{title:"比赛名称",dataIndex:"matchname",key:"matchname"},{title:"所属联赛",dataIndex:"leaguename",key:"leaguename"},{title:"比赛等级",dataIndex:"level",key:"level",render:e=>e+"级"},{title:"比赛简介",dataIndex:"matchintro",key:"matchintro"},{title:"比赛地址",dataIndex:"matchaddr",key:"matchaddr"},{title:"封面图",dataIndex:"matchpicurl",key:"matchpicurl",render:(e,a)=>i.jsx("span",{style:{color:" rgb( 66,149,229)",cursor:"pointer"},onClick:()=>K(a),children:"点击查看"})},{title:"报名开始时间",dataIndex:"matchreg",key:"matchreg"},{title:"报名截止时间",dataIndex:"matchregend",key:"matchregend"},{title:"比赛时间",dataIndex:"matchstart",key:"matchstart"},{title:"报名数量",dataIndex:"alreadymatchvolume",key:"alreadymatchvolume",render:(e,a)=>a.alreadymatchvolume+"/"+a.matchvolume},{title:"状态",dataIndex:"matchstatus",key:"matchstatus",render:e=>["未开始","报名中","报名截止","比赛中","已结束"][e]},{title:"上下架",dataIndex:"status",key:"status",render:e=>0===e?"上架":1===e?"下架":"已删除"},{title:"创建时间",dataIndex:"addtime",key:"addtime"},{title:"操作",key:"control",fixed:"right",width:260,render:(e,a)=>{const t=[];y.includes("match:edit")&&t.push(i.jsx("span",{style:{color:" rgb( 66,149,229)",cursor:"pointer"},onClick:()=>U(a,"edit"),children:"编辑"},"1")),y.includes("match:see")&&t.push(i.jsx("span",{style:{color:" rgb( 66,149,229)",cursor:"pointer"},onClick:()=>U(a,"see"),children:"查看报名"},"2")),y.includes("match:end")&&t.push(i.jsx("span",{style:{color:" rgb( 66,149,229)",cursor:"pointer"},onClick:()=>{return T({operateType:"edit",nowData:e=a,modalShow:!0,modalLoading:!1}),M(e.uuid),void V(e.uuid);var e},children:"结束比赛"},"3")),y.includes("match:del")&&t.push(i.jsx(d,{menu:{items:N,onClick:({key:e})=>{"1"===e&&h.confirm({title:"确定要删除吗?",okText:"确定",cancelText:"取消",async onOk(){(async e=>{const a=await u.delMatch({uuid:e});a&&200===a.code?(s.success("删除比赛成功"),$(b)):s.error((null==a?void 0:a.message)??"删除比赛失败")})(a.uuid)}})}},className:"controlBtn",children:i.jsx("span",{style:{color:" rgb( 66,149,229)",cursor:"pointer"},children:"更多"})},"4"));const l=[];return t.forEach(((e,a)=>{a&&l.push(i.jsx(c,{type:"vertical"},`line${a}`)),l.push(e)})),l}}],[_,q]=t.useState(!1),[H,J]=t.useState(""),K=e=>{q(!0),J(e.matchpicurl)},Q=t.useMemo((()=>k.map(((e,a)=>({key:e.uuid,uuid:e.uuid,serial:a+1+(b.pageNum-1)*b.pageSize,id:e.id,matchname:e.matchname,leaguename:e.leaguename,level:e.level,matchintro:e.matchintro,matchaddr:e.matchaddr,matchpicurl:e.matchpicurl,matchreg:e.matchreg,matchregend:e.matchregend,matchstart:e.matchstart,alreadymatchvolume:e.alreadymatchvolume,matchvolume:e.matchvolume,matchstatus:e.matchstatus,status:e.status,addtime:e.addtime})))),[b,k]);return t.useEffect((()=>{$(b)}),[]),i.jsxs("div",{children:[i.jsx("div",{children:i.jsx("ul",{style:{textAlign:"right"},children:y.includes("match:add")&&i.jsx("li",{children:i.jsx(l,{type:"primary",icon:i.jsx(j,{}),disabled:!y.includes("match:add"),onClick:()=>U(null,"add"),children:"新建比赛"})})})}),i.jsx("div",{children:i.jsx(r,{columns:A,loading:w,dataSource:Q,scroll:{x:"max-content"},rowKey:e=>e.id,pagination:{total:b.total,current:b.pageNum,pageSize:b.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,a)=>((e,a)=>{$({pageNum:e,pageSize:a||b.pageSize})})(e,a)}})}),i.jsx(h,{title:"结束比赛",open:L.modalShow,cancelText:"取消",okText:"确认",onOk:async()=>{var e,a,t;T({modalLoading:!0});try{const i=await f.validateFields(),l={matchuuid:L.nowData.uuid,championuuid:i.champion,runnerupuuid:i.runnerUp,thirdplaceuuid:i.thirdPlace,file:null==(t=null==(a=null==(e=i.pointType)?void 0:e.file)?void 0:a.response)?void 0:t.data[0]},n=await u.endMatch(l);n&&200===n.code?(s.success("比赛结束成功"),D(),$(b)):s.error((null==n?void 0:n.message)??"比赛结束失败")}finally{T({modalLoading:!1})}},onCancel:()=>D(),confirmLoading:L.modalLoading,children:i.jsxs(o,{form:f,labelCol:{span:6},children:[i.jsx(o.Item,{name:"champion",label:"冠军",children:i.jsx(x,{style:{width:"300px"},placeholder:"请选择",allowClear:!0,options:B})}),i.jsx(o.Item,{name:"runnerUp",label:"亚军",children:i.jsx(x,{style:{width:"300px"},placeholder:"请选择",allowClear:!0,options:B})}),i.jsx(o.Item,{name:"thirdPlace",label:"季军",children:i.jsx(x,{style:{width:"300px"},placeholder:"请选择",allowClear:!0,options:B})}),i.jsx(o.Item,{name:"pointType",label:"提交积分",children:i.jsxs(g,{...P,children:[i.jsx(l,{children:"上传文件"}),i.jsx("span",{style:{marginLeft:10},children:"(csv格式)"})]})})]})}),i.jsx(m,{style:{display:"none"},src:H,preview:{visible:_,onVisibleChange:e=>{q(e)}}})]})}export{y as default};
