import{r as e,b as t,l as i,j as r}from"./index-efa3a32c.js";import{S as s,a as n}from"./index-639ffc53.js";import{C as d}from"./index-0373e759.js";/* empty css              */import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{M as a}from"./index-46e73bcd.js";function o(o){const[l,c]=e.useState([]),[p,u]=e.useState([]);e.useEffect((()=>{c(o.defaultChecked.menus||[]),u(o.defaultChecked.powers||[])}),[o.defaultChecked]);const m=e.useCallback((()=>{var e;null==(e=o.onOk)||e.call(o,{menus:l,powers:p})}),[o,p,l]),f=e.useCallback((()=>{o.onClose()}),[o]),x=e.useCallback((e=>!!p.find((t=>t===e))),[p]),h=e.useCallback(((e,i,r)=>{const s=[...p];let n=[...l];const d=t.getPowerById({id:i}),a=d.data[0].urlId?d.data[0].urlId:-1;if(e.target.checked)s.push(i),n=Array.from(new Set(-1!==a?[r.id,a,...l]:[r.id,...l]));else{s.splice(s.indexOf(i),1);const e=r.powers.map((e=>e.id));p.some((t=>t!==i&&e.indexOf(t)>=0))||(n.splice(n.indexOf(r.id),1),-1!==a&&n.splice(n.indexOf(a),1))}u(s),c(n)}),[p,l]),w=e.useCallback(((e,t)=>{let i;return i=e?t.filter((t=>t.parent===e.id)):t.filter((e=>!e.parent)),i.forEach((e=>{e.children=w(e,t),e.key=e.id})),i.length?i:void 0}),[]),k=e.useCallback((e=>{const t=[];for(let i=0;i<e.length;i++){const r={...e[i]};r.children&&(r.children=k(r.children));const s={...r,key:r.id};!r.hidden&&t.push(s)}return t}),[]),j=e.useMemo((()=>{const e=i.cloneDeep(o.data),t=k(e);t.sort(((e,t)=>e.sorts-t.sorts));return w(void 0,t)||[]}),[o.data,w]),y=e.useMemo((()=>({onSelect:(e,t)=>{const i=o.data.find((t=>t.id===e.id));if(t){if(i&&Array.isArray(i.powers)){const e=Array.from(new Set([...i.powers.map((e=>e.id)),...p]));u(e);const t=Array.from(new Set([...i.powers.map((e=>e.urlId?e.urlId:-1)),i.id,...l]));c(t)}}else if(i&&Array.isArray(i.powers)){const e=i.powers.map((e=>e.id)),t=p.filter((t=>e.indexOf(t)<0));u(t);const r=Array.from(new Set([...i.powers.map((e=>e.urlId?e.urlId:-1)),i.id])),s=l.filter((e=>r.indexOf(e)<0));c(s)}},selectedRowKeys:l})),[o.data,l,p]),C=e.useMemo((()=>[{title:"菜单",dataIndex:"title",key:"title",width:"30%"},{title:"权限",dataIndex:"powers",key:"powers",width:"70%",render:(e,t)=>e?e.map(((e,i)=>r.jsx(d,{checked:x(e.id),onChange:i=>h(i,e.id,t),children:r.jsx("span",{className:"powerText",children:e.title})},i+e.id))):null}]),[x,h]);return r.jsx(a,{className:"menu-tree-table",zIndex:1001,width:750,title:o.title||"请选择",open:o.modalShow,okText:"确定",cancelText:"取消",onOk:m,onCancel:f,confirmLoading:o.loading,children:o.initloading?r.jsx("div",{style:{textAlign:"center"},children:r.jsx(s,{tip:"加载中…"})}):r.jsx(n,{columns:C,rowSelection:y,dataSource:j,pagination:!1})})}export{o as T};
