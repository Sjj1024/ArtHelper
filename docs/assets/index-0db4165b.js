import{u as e,d as s,r as t,m as i,j as a,B as l,T as r}from"./index-efa3a32c.js";import{a as o}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-8c8b720f.js";import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{D as n}from"./index-65748fb5.js";import{u as d}from"./user-66ba9e41.js";import{s as p}from"./store-7211fed8.js";import{u as c}from"./useSetState-78ffd672.js";import{S as u}from"./index-1c1deade.js";import{S as m}from"./SearchOutlined-24304577.js";import{E as x}from"./EyeOutlined-a014c032.js";import{E as h}from"./EditOutlined-e081177a.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./SearchOutlined-03c63d28.js";import"./index-0a1440ec.js";import"./context-cb88fb1e.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./responsiveObserve-b13564d4.js";import"./CheckOutlined-f0d55485.js";const{Option:j}=u;function v(){document.title="序列号管理";const v=e(),y=s((e=>e.app.powersCode)),[g,S]=t.useState([]),[w,N]=t.useState(!1),[f,k]=c({pageNum:1,pageSize:10,total:0}),[b,C]=c({proxy:void 0,store:void 0,status:void 0,type:void 0});t.useEffect((()=>{I(f),$(),U()}),[]);const I=async e=>{const s={page:e.pageNum,limit:e.pageSize,provideragentuuid:b.proxy,provideruuid:b.store,status:b.status,providerlevel:b.type};N(!0);try{const t=await p.getLicense(s);t&&200===t.code?(S(t.data),k({total:t.cont,pageNum:e.pageNum,pageSize:e.pageSize})):i.error((null==t?void 0:t.message)??"获取失败")}finally{N(!1)}},z=(e,s)=>{v("see"===s?`/store/license/detail?license=${e.uuid}`:`/store/license/edit?license=${e.uuid}`)},[E,O]=t.useState([]),$=async()=>{const e=(await d.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));O(e)},[A,T]=t.useState([]),[q,B]=t.useState([]),U=async()=>{const e=(await p.getStoreType()).data.map((e=>({label:e.name,value:e.id})));B(e)},D=[{title:"序列号",dataIndex:"license",key:"license"},{title:"产品(版本)",dataIndex:"product",key:"product",width:170,render:(e,s)=>a.jsx("span",{children:s.product.map((e=>a.jsx("div",{children:e},e)))})},{title:"所属门店",dataIndex:"store",key:"store"},{title:"所属代理",dataIndex:"proxy",key:"proxy"},{title:"门店类型",dataIndex:"type",key:"type"},{title:"所属场地",dataIndex:"field",key:"field"},{title:"激活状态",dataIndex:"status",key:"status",render:(e,s)=>a.jsx("span",{children:0===s.status?"待激活":1===s.status?"激活":"冻结"})},{title:"状态详情",dataIndex:"express",key:"express"},{title:"操作",key:"control",width:200,render:(e,s)=>{const t=[];y.includes("license:see")&&t.push(a.jsx("span",{className:"control-btn blue",onClick:()=>z(s,"see"),children:a.jsx(r,{placement:"top",title:"查看序列号",children:a.jsx(x,{})})},"1")),y.includes("license:edit")&&t.push(a.jsx("span",{className:"control-btn blue",onClick:()=>z(s,"up"),children:a.jsx(r,{placement:"top",title:"编辑序列号",children:a.jsx(h,{})})},"2"));const i=[];return t.forEach(((e,s)=>{s&&i.push(a.jsx(n,{type:"vertical"},`line${s}`)),i.push(e)})),i}}],F=t.useMemo((()=>g.map(((e,s)=>{var t,i,a;const l=null==(t=null==e?void 0:e.version)?void 0:t.map((e=>`${e.prodname}(${e.versioncode})`));return{key:e.uuid,uuid:e.uuid,license:null==(i=null==e?void 0:e.codetoprovider)?void 0:i.regcode,product:l,store:(null==e?void 0:e.providername)||"-",storeId:(null==e?void 0:e.provideruuid)||"-",proxy:(null==e?void 0:e.agentinname)||"-",proxyId:(null==e?void 0:e.provideragentuuid)||"-",type:(null==e?void 0:e.providerlevel_name)||"",field:(null==e?void 0:e.stationname)||"",status:null==e?void 0:e.status,express:null==(a=null==e?void 0:e.codetoprovider)?void 0:a.statusreamk}}))),[f,g]);return a.jsxs("div",{className:"role-box",children:[a.jsxs("div",{className:"g-search",children:[y.includes("license:search")&&a.jsxs("ul",{className:"search-ul",children:[a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",style:{width:"40px"},children:"代理:"}),a.jsx(u,{placeholder:"请选择代理",allowClear:!0,style:{width:"120px"},onChange:async e=>{C({proxy:e,store:void 0});const s=(await d.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));T(s)},value:b.proxy,options:E})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",style:{width:"50px"},children:"门店:"}),a.jsx(u,{placeholder:"请选择门店",allowClear:!0,style:{width:"120px"},onChange:e=>{C({store:e})},value:b.store,options:A})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",style:{width:"70px"},children:"激活状态:"}),a.jsxs(u,{placeholder:"请选择状态",allowClear:!0,style:{width:"120px"},onChange:e=>{C({status:e})},value:b.status,children:[a.jsx(j,{value:"",children:"全部"}),a.jsx(j,{value:1,children:"激活"}),a.jsx(j,{value:2,children:"终止"})]})]}),a.jsxs("li",{className:"search-item",children:[a.jsx("span",{className:"item-lable",style:{width:"70px"},children:"门店类型:"}),a.jsx(u,{placeholder:"请选择门店类型",allowClear:!0,style:{width:"120px"},onChange:async e=>{C({type:e})},options:q,value:b.type})]})]}),a.jsx("ul",{className:"search-func",children:y.includes("license:search")&&a.jsx("li",{children:a.jsx(l,{type:"primary",icon:a.jsx(m,{}),disabled:!y.includes("license:search"),onClick:()=>{I(f)},children:"搜索"})})})]}),a.jsx("div",{className:"diy-table",children:a.jsx(o,{columns:D,loading:w,dataSource:F,pagination:{total:f.total,current:f.pageNum,pageSize:f.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{I({pageNum:e,pageSize:s||f.pageSize})})(e,s)}})})]})}export{v as default};
