import{d as e,r as t,o as a,j as s,B as i,h as l,m as o,T as n}from"./index-efa3a32c.js";import{F as r}from"./index-ae2d5997.js";import{I as d}from"./index-8c8b720f.js";import{a as m}from"./index-639ffc53.js";import"./index-0373e759.js";/* empty css              */import"./index-9b480cfe.js";import"./index-9b8a3313.js";import{P as c}from"./index-94ed3db3.js";import{D as u}from"./index-65748fb5.js";import{D as p}from"./index-1acfbbfd.js";import"./index-47693ae2.js";import{t as j}from"./teacher-ae538df4.js";import{u as h}from"./useSetState-78ffd672.js";import{u as x}from"./useMount-5c373398.js";import{M as y}from"./index-46e73bcd.js";import{S as f}from"./index-1c1deade.js";import{P as v}from"./PlusCircleOutlined-176a31dc.js";import{E as g}from"./EditOutlined-e081177a.js";import{D}from"./DeleteOutlined-866c7b58.js";import"./context-cb88fb1e.js";import"./responsiveObserve-b13564d4.js";import"./index-177532f7.js";import"./statusUtils-b010cbea.js";import"./EyeOutlined-319494bf.js";import"./SearchOutlined-03c63d28.js";import"./pickAttrs-1cd23dfa.js";import"./index-40784afc.js";import"./getScrollBarSize-c6833c2b.js";import"./isEqual-8ee5b3ce.js";import"./useForceUpdate-9ad39bdf.js";import"./index-0a1440ec.js";import"./ActionButton-e012fb99.js";import"./CalendarOutlined-8ff6678f.js";import"./Portal-08554165.js";import"./CheckOutlined-f0d55485.js";import"./DeleteOutlined-6b999003.js";function S(){document.title="教练管理";const S=e((e=>e.app.powersCode)),[T]=r.useForm(),[Y,w]=t.useState([]),[b,k]=t.useState(!1);let[M,C]=a();const O=M.get("teacher"),[L,N]=h({pageNum:1,pageSize:10,total:0}),[H,I]=h({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),z=async e=>{const t={coachuuid:O,page:e.pageNum,limit:e.pageSize};k(!0);try{const a=await j.getTeacherLeaveList(t);a&&200===a.code?(w(a.data),N({pageNum:e.pageNum,pageSize:e.pageSize,total:a.cont})):o.error((null==a?void 0:a.message)??"数据获取失败")}finally{k(!1)}},F={leaveType:"",startDate:"",endDate:"",desc:"",id:""},E=(e,t)=>{I({modalShow:!0,nowData:e,operateType:t}),e&&T.setFieldsValue({leaveType:e.type,startDate:l(e.startDate),endDate:l(e.endDate),desc:e.desc,id:e.id})},[q,P]=t.useState("1"),[A,B]=t.useState(null),[V,U]=t.useState(null),$=[{value:1,label:"休假"},{value:2,label:"事假"},{value:3,label:"病假"},{value:4,label:"其他"}],J=e=>{const t=$.find((t=>t.value===e));return t?t.label:""},Q=e=>{const t=$.find((t=>t.label===e));return t?t.value:null},G=()=>{T.setFieldsValue({...F}),I({modalShow:!1})},K=[{title:"编号",dataIndex:"serial",key:"serial"},{title:"请假类型",dataIndex:"type",key:"type"},{title:"开始时间",dataIndex:"startDate",key:"startDate"},{title:"结束时间",dataIndex:"endDate",key:"endDate"},{title:"请假说明",dataIndex:"desc",key:"desc"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"control",width:200,render:(e,t)=>{const a=[];S.includes("teacher:edit")&&a.push(s.jsx("span",{className:"control-btn blue",onClick:()=>E(t,"edit"),children:s.jsx(n,{placement:"top",title:"编辑",children:s.jsx(g,{})})},"1")),S.includes("teacher:leave")&&a.push(s.jsx(c,{title:"确定删除吗？",onConfirm:()=>(async e=>{k(!0);try{const t=await j.deleteTeacherLeave({coachid:e.id});t&&200===t.code?(o.success("删除成功"),z(L)):o.error((null==t?void 0:t.message)??"操作失败")}finally{k(!1)}})(t),okText:"确定",cancelText:"取消",children:s.jsx("span",{className:"control-btn red",children:s.jsx(n,{placement:"top",title:"删除",children:s.jsx(D,{})})})},"3"));const i=[];return a.forEach(((e,t)=>{t&&i.push(s.jsx(u,{type:"vertical"},`line${t}`)),i.push(e)})),i}}],R=t.useMemo((()=>Y.map(((e,t)=>({key:t,id:e.id,uuid:e.uuid,serial:t+1+(L.pageNum-1)*L.pageSize,type:J(e.status),startDate:e.timestart,endDate:e.timeend,desc:e.comments,createTime:e.addtime})))),[L,Y]);return x((()=>{z(L)})),s.jsxs("div",{className:"user-box",children:[s.jsx("div",{className:"user-search",children:s.jsx("ul",{className:"search-func",children:S.includes("teacher:add")&&s.jsx("li",{children:s.jsx(i,{type:"primary",icon:s.jsx(v,{}),disabled:!S.includes("teacher:add"),onClick:()=>E(null,"add"),children:"新增休假"})})})}),s.jsx("div",{className:"diy-table",children:s.jsx(m,{columns:K,loading:b,dataSource:R,pagination:{total:L.total,current:L.pageNum,pageSize:L.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,t)=>{z({pageNum:e,pageSize:t})}}})}),s.jsx(y,{title:{add:"新增休假",edit:"教练请假",see:"查看"}[H.operateType],open:H.modalShow,cancelText:"取消",okText:"提交",onOk:async()=>{try{const e=await T.validateFields();if(I({modalLoading:!0}),"add"===H.operateType)try{const t={coachuuid:O,status:e.leaveType,timestart:null==A?void 0:A.format("YYYY-MM-DD HH:mm:ss"),timeend:null==V?void 0:V.format("YYYY-MM-DD HH:mm:ss"),comments:e.desc},a=await j.addTeacherLeave(t);a&&200===a.code?(o.success("添加成功"),z(L),G()):o.error((null==a?void 0:a.message)??"操作失败")}finally{I({modalLoading:!1})}else try{const t={coachid:H.nowData.id,coachuuid:O,timestart:(null==A?void 0:A.format("YYYY-MM-DD HH:mm:ss"))?null==A?void 0:A.format("YYYY-MM-DD HH:mm:ss"):H.nowData.startDate,timeend:(null==V?void 0:V.format("YYYY-MM-DD HH:mm:ss"))?null==V?void 0:V.format("YYYY-MM-DD HH:mm:ss"):H.nowData.endDate,status:Q(e.leaveType),comments:e.desc},a=await j.editTeacherLeave(t);200===(null==a?void 0:a.code)?(o.success("修改成功"),G()):o.error((null==a?void 0:a.message)??"修改失败")}finally{I({modalLoading:!1})}z(L)}catch{}},onCancel:G,confirmLoading:H.modalLoading,children:s.jsxs(r,{form:T,initialValues:{formConditions:1},children:[s.jsx(r.Item,{label:"休假类型",name:"leaveType",style:{marginLeft:10,width:220},rules:[{required:!0}],children:s.jsxs(f,{onChange:e=>{P(e)},children:[s.jsx(f.Option,{value:"1",children:"休假"}),s.jsx(f.Option,{value:"2",children:"事假"}),s.jsx(f.Option,{value:"3",children:"病假"}),s.jsx(f.Option,{value:"4",children:"其他"})]})}),s.jsx(r.Item,{label:"开始时间",name:"startDate",rules:[{required:!0}],children:s.jsx(p,{showTime:!0,onChange:(e,t)=>{B(e)}})}),s.jsx(r.Item,{label:"结束时间",name:"endDate",rules:[{required:!0}],children:s.jsx(p,{showTime:!0,onChange:(e,t)=>{U(e)}})}),s.jsx(r.Item,{label:"说明",name:"desc",style:{width:400,marginLeft:10},children:s.jsx(d,{placeholder:"请输入"})})]})})]})}export{S as default};
